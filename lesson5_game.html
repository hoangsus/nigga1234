<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game Luy·ªán T·∫≠p Ti·∫øng ƒê·ª©c - T·ª´ V·ª±ng & Chia ƒê·ªông T·ª´</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        text-align: center;
        margin-bottom: 30px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        position: relative;
      }

      .header h1 {
        color: #4a47a3;
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }

      .header p {
        color: #666;
        font-size: 1.2em;
        margin-bottom: 20px;
      }

      .stats {
        display: flex;
        justify-content: center;
        gap: 30px;
        flex-wrap: wrap;
      }

      .stat-item {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 25px;
        border-radius: 15px;
        text-align: center;
        min-width: 120px;
      }

      .stat-number {
        font-size: 2em;
        font-weight: bold;
        display: block;
      }

      .game-modes {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .game-mode {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 25px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border: 3px solid transparent;
      }

      .game-mode:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        border-color: #667eea;
      }

      .game-mode.active {
        border-color: #4a47a3;
        background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
      }

      .game-mode.conjugation {
        border-color: #ff6b6b;
      }

      .game-mode.conjugation:hover {
        border-color: #ff5252;
      }

      .mode-icon {
        font-size: 3em;
        margin-bottom: 15px;
        display: block;
      }

      .mode-title {
        font-size: 1.4em;
        font-weight: bold;
        color: #4a47a3;
        margin-bottom: 10px;
      }

      .game-mode.conjugation .mode-title {
        color: #ff6b6b;
      }

      .mode-description {
        color: #666;
        font-size: 0.9em;
        line-height: 1.4;
      }

      .mode-progress {
        margin-top: 10px;
        font-size: 0.8em;
        color: #666;
        font-weight: bold;
      }

      .mode-progress.has-progress {
        color: #4a47a3;
      }

      .game-mode.conjugation .mode-progress.has-progress {
        color: #ff6b6b;
      }

      .game-area {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        display: none;
      }

      .game-area.active {
        display: block;
      }

      .game-header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 3px solid #667eea;
      }

      .game-header.conjugation {
        border-bottom-color: #ff6b6b;
      }

      .game-title {
        font-size: 2em;
        color: #4a47a3;
        margin-bottom: 10px;
      }

      .game-title.conjugation {
        color: #ff6b6b;
      }

      .game-progress {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f8f9fa;
        padding: 15px 20px;
        border-radius: 15px;
        margin-bottom: 20px;
      }

      .progress-bar {
        flex: 1;
        height: 10px;
        background: #e9ecef;
        border-radius: 5px;
        margin: 0 20px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        width: 0%;
        transition: width 0.3s ease;
      }

      .progress-fill.conjugation {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
      }

      .question-area {
        background: #fff8e1;
        border: 3px solid #ffc107;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
        text-align: center;
      }

      .question-area.conjugation {
        background: #ffebee;
        border-color: #ff6b6b;
      }

      .question {
        font-size: 1.5em;
        color: #2c3e50;
        margin-bottom: 20px;
        line-height: 1.4;
      }

      .example-sentence {
        background: #e8f5e8;
        border: 2px solid #28a745;
        border-radius: 10px;
        padding: 15px;
        margin-top: 15px;
        text-align: left;
      }

      .example-sentence h4 {
        color: #155724;
        margin-bottom: 8px;
        font-size: 1.1em;
      }

      .example-sentence p {
        color: #155724;
        margin: 5px 0;
        font-size: 1.05em;
        line-height: 1.4;
      }

      .sentence-type-selector {
        background: #fff;
        border: 2px solid #ff6b6b;
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
      }

      .sentence-types {
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
        margin-bottom: 15px;
      }

      .sentence-type-btn {
        padding: 10px 20px;
        border: 2px solid #ff6b6b;
        background: white;
        color: #ff6b6b;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: bold;
      }

      .sentence-type-btn:hover {
        background: #ff6b6b;
        color: white;
      }

      .sentence-type-btn.active {
        background: #ff6b6b;
        color: white;
      }

      .sentence-preview {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-top: 10px;
        border-left: 4px solid #ff6b6b;
      }

      .conjugation-display {
        background: white;
        border: 2px solid #ff6b6b;
        border-radius: 15px;
        padding: 25px;
        margin: 20px 0;
        text-align: center;
      }

      .pronoun {
        font-size: 1.8em;
        font-weight: bold;
        color: #ff6b6b;
        margin-bottom: 10px;
      }

      .verb-infinitive {
        font-size: 1.4em;
        color: #666;
        margin-bottom: 15px;
        font-style: italic;
      }

      .conjugation-example {
        background: #f8f9fa;
        border-left: 4px solid #ff6b6b;
        padding: 15px;
        margin: 15px 0;
        border-radius: 8px;
      }

      .conjugation-example h4 {
        color: #ff6b6b;
        margin-bottom: 10px;
      }

      .conjugation-table {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 15px;
      }

      .conjugation-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background: white;
        border-radius: 8px;
        border: 1px solid #dee2e6;
      }

      .conjugation-row .pronoun-small {
        font-weight: bold;
        color: #ff6b6b;
      }

      .conjugation-row .verb-form {
        color: #495057;
        font-weight: bold;
      }

      .german-word-display {
        font-size: 2.5em;
        font-weight: bold;
        color: #4a47a3;
        margin: 20px 0;
        cursor: pointer;
        padding: 15px;
        border-radius: 10px;
        transition: background-color 0.3s ease;
      }

      .german-word-display:hover {
        background-color: rgba(102, 126, 234, 0.1);
      }

      .options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 25px;
      }

      .option {
        padding: 15px 20px;
        background: white;
        border: 2px solid #667eea;
        border-radius: 15px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s ease;
        font-size: 1.1em;
      }

      .option:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
      }

      .option.conjugation {
        border-color: #ff6b6b;
      }

      .option.conjugation:hover {
        background: #ff6b6b;
      }

      .option.correct {
        background: #28a745;
        color: white;
        border-color: #28a745;
      }

      .option.wrong {
        background: #dc3545;
        color: white;
        border-color: #dc3545;
      }

      .option.disabled {
        pointer-events: none;
        opacity: 0.6;
      }

      .input-area {
        margin-bottom: 25px;
      }

      .text-input {
        width: 100%;
        padding: 15px 20px;
        font-size: 1.2em;
        border: 2px solid #667eea;
        border-radius: 15px;
        outline: none;
        transition: border-color 0.3s ease;
      }

      .text-input:focus {
        border-color: #4a47a3;
        box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
      }

      .text-input.conjugation {
        border-color: #ff6b6b;
      }

      .text-input.conjugation:focus {
        border-color: #ff5252;
        box-shadow: 0 0 10px rgba(255, 107, 107, 0.3);
      }

      .controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
        margin-bottom: 25px;
      }

      .btn {
        padding: 12px 25px;
        font-size: 1.1em;
        font-weight: bold;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
      }

      .btn-conjugation {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        color: white;
      }

      .btn-conjugation:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-success {
        background: #28a745;
        color: white;
      }

      .btn-warning {
        background: #ffc107;
        color: #333;
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .feedback {
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        text-align: center;
        font-size: 1.1em;
        font-weight: bold;
      }

      .feedback.correct {
        background: #d4edda;
        border: 2px solid #28a745;
        color: #155724;
      }

      .feedback.wrong {
        background: #f8d7da;
        border: 2px solid #dc3545;
        color: #721c24;
      }

      .results {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        border: 2px solid #28a745;
        border-radius: 20px;
        padding: 30px;
        text-align: center;
        margin-top: 30px;
      }

      .results h3 {
        color: #155724;
        font-size: 2em;
        margin-bottom: 20px;
      }

      .results-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .result-item {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .result-number {
        font-size: 2.5em;
        font-weight: bold;
        color: #4a47a3;
        display: block;
      }

      .result-number.conjugation {
        color: #ff6b6b;
      }

      .result-label {
        color: #666;
        font-size: 0.9em;
        margin-top: 5px;
      }

      .back-btn {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.95);
        border: 2px solid #667eea;
        color: #4a47a3;
        padding: 12px 25px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
        z-index: 1000;
        display: none;
        text-decoration: none;
        font-size: 1.1em;
      }

      .back-btn:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
      }

      .back-btn:active {
        transform: translateY(0);
      }

      .back-btn.show {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .speech-recognition {
        background: #e3f2fd;
        border: 2px solid #2196f3;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        text-align: center;
      }

      .mic-button {
        background: #f44336;
        color: white;
        border: none;
        border-radius: 50%;
        width: 80px;
        height: 80px;
        font-size: 2em;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 10px;
      }

      .mic-button:hover {
        transform: scale(1.1);
      }

      .mic-button.recording {
        background: #4caf50;
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }

      .pronunciation-feedback {
        margin-top: 15px;
        padding: 15px;
        border-radius: 10px;
        font-weight: bold;
      }

      /* Audio visualizer */
      .audio-visualizer {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 3px;
        margin: 10px 0;
        height: 40px;
      }

      .audio-bar {
        width: 4px;
        background: #667eea;
        border-radius: 2px;
        transition: height 0.1s ease;
      }

      .audio-bar.conjugation {
        background: #ff6b6b;
      }

      /* Translation help for conjugation */
      .translation-help {
        background: #e8f5e8;
        border: 2px solid #28a745;
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
        text-align: left;
      }

      .translation-help h4 {
        color: #155724;
        margin-bottom: 15px;
        font-size: 1.2em;
      }

      .translation-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        margin: 5px 0;
        background: white;
        border-radius: 8px;
        border-left: 4px solid #28a745;
      }

      .german-text {
        font-weight: bold;
        color: #2c3e50;
      }

      .vietnamese-text {
        color: #155724;
        font-style: italic;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .container {
          padding: 10px;
        }

        .header h1 {
          font-size: 2em;
        }

        .header p {
          font-size: 1em;
        }

        .stats {
          gap: 15px;
        }

        .stat-item {
          padding: 10px 15px;
          min-width: 100px;
        }

        .stat-number {
          font-size: 1.5em;
        }

        .game-modes {
          grid-template-columns: 1fr;
        }

        .german-word-display {
          font-size: 2em;
        }

        .options {
          grid-template-columns: 1fr;
        }

        .controls {
          flex-direction: column;
        }

        .back-btn {
          position: static;
          margin-bottom: 20px;
          align-self: flex-start;
        }

        .conjugation-table {
          grid-template-columns: 1fr;
        }

        .translation-item {
          flex-direction: column;
          align-items: flex-start;
          gap: 5px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Back Button -->
      <a href="index.html" class="back-btn" id="backButton">
        ‚Üê V·ªÅ Menu Ch√≠nh
      </a>

      <!-- Main Menu -->
      <div id="mainMenu">
        <div class="header">
          <h1>üéÆ Game Luy·ªán T·∫≠p Ti·∫øng ƒê·ª©c</h1>
          <p>Luy·ªán t·∫≠p t·ª´ v·ª±ng + chia ƒë·ªông t·ª´ v·ªõi 185 t·ª´ v·ª±ng t·ª´ 4 bu·ªïi h·ªçc</p>
          <div class="stats">
            <div class="stat-item">
              <span class="stat-number">185</span>
              <span>T·ª´ v·ª±ng</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">5</span>
              <span>K·ªπ nƒÉng</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">3</span>
              <span>Ng·ªØ ph√°p</span>
            </div>
          </div>
        </div>

        <div class="game-modes">
          <div class="game-mode" onclick="startGame('listening')">
            <span class="mode-icon">üëÇ</span>
            <div class="mode-title">Luy·ªán Nghe</div>
            <div class="mode-description">
              Nghe t·∫•t c·∫£ 185 t·ª´ v·ª±ng ti·∫øng ƒê·ª©c v√† ch·ªçn nghƒ©a ƒë√∫ng b·∫±ng ti·∫øng
              Vi·ªát + Xem c√¢u v√≠ d·ª• th·ª±c t·∫ø
            </div>
            <div id="listeningProgress" class="mode-progress"></div>
          </div>

          <div class="game-mode" onclick="startGame('speaking')">
            <span class="mode-icon">üó£Ô∏è</span>
            <div class="mode-title">Luy·ªán N√≥i</div>
            <div class="mode-description">
              Ph√°t √¢m t·∫•t c·∫£ 185 t·ª´ v·ª±ng ti·∫øng ƒê·ª©c theo g·ª£i √Ω v·ªõi AI nh·∫≠n di·ªán
              gi·ªçng n√≥i
            </div>
            <div id="speakingProgress" class="mode-progress"></div>
          </div>

          <div class="game-mode" onclick="startGame('reading')">
            <span class="mode-icon">üëÅÔ∏è</span>
            <div class="mode-title">Luy·ªán ƒê·ªçc</div>
            <div class="mode-description">
              ƒê·ªçc t·∫•t c·∫£ 185 t·ª´ v·ª±ng ti·∫øng ƒê·ª©c v√† ch·ªçn nghƒ©a ti·∫øng Vi·ªát + Xem
              c√¢u v√≠ d·ª• th·ª±c t·∫ø
            </div>
            <div id="readingProgress" class="mode-progress"></div>
          </div>

          <div class="game-mode" onclick="startGame('writing')">
            <span class="mode-icon">‚úçÔ∏è</span>
            <div class="mode-title">Luy·ªán Vi·∫øt</div>
            <div class="mode-description">
              <strong>‚å®Ô∏è Nh·∫≠p t·ª´ b√†n ph√≠m:</strong> G√µ t·ª´ ti·∫øng ƒê·ª©c theo nghƒ©a
              ti·∫øng Vi·ªát v·ªõi ki·ªÉm tra ch√≠nh t·∫£ t·ª± ƒë·ªông
            </div>
            <div id="writingProgress" class="mode-progress"></div>
          </div>

          <div class="game-mode conjugation" onclick="startGame('conjugation')">
            <span class="mode-icon">üìù</span>
            <div class="mode-title">Chia ƒê·ªông T·ª´</div>
            <div class="mode-description">
              <strong>üí° H·ªçc c√≥ h·ªá th·ªëng:</strong> Quy t·∫Øc chia + m·∫πo ghi nh·ªõ +
              luy·ªán t·∫≠p c√¢u kh·∫≥ng ƒë·ªãnh, ph·ªß ƒë·ªãnh, nghi v·∫•n v·ªõi sein, kommen,
              hei√üen, sprechen + D·ªãch sang ti·∫øng Vi·ªát + Ph√°t √¢m
            </div>
            <div id="conjugationProgress" class="mode-progress"></div>
          </div>
        </div>
      </div>

      <!-- Game Area -->
      <div id="gameArea" class="game-area">
        <div class="game-header" id="gameHeader">
          <div class="game-title" id="gameTitle">Luy·ªán Nghe</div>
          <div class="game-progress">
            <span>C√¢u <span id="currentQuestion">1</span></span>
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <span>T·ªïng: <span id="totalQuestions">185</span></span>
          </div>
          <div>
            <span style="color: #28a745"
              >‚úì ƒê√∫ng: <span id="correctCount">0</span></span
            >
            |
            <span style="color: #dc3545"
              >‚úó Sai: <span id="wrongCount">0</span></span
            >
            |
            <span style="color: #ffc107"
              >‚≠ê ƒêi·ªÉm: <span id="score">0</span></span
            >
          </div>
        </div>

        <div class="question-area" id="questionArea">
          <div class="question" id="question">
            Nghe t·ª´ v·ª±ng v√† ch·ªçn nghƒ©a ƒë√∫ng:
          </div>

          <!-- Sentence Type Selector for Conjugation -->
          <div
            class="sentence-type-selector"
            id="sentenceTypeSelector"
            style="display: none"
          >
            <h4 style="text-align: center; margin-bottom: 15px; color: #ff6b6b">
              üéØ Ch·ªçn lo·∫°i c√¢u:
            </h4>
            <div class="sentence-types">
              <button class="sentence-type-btn active" data-type="statement">
                Kh·∫≥ng ƒë·ªãnh
              </button>
              <button class="sentence-type-btn" data-type="negative">
                Ph·ªß ƒë·ªãnh
              </button>
              <button class="sentence-type-btn" data-type="question">
                Nghi v·∫•n
              </button>
            </div>
            <div class="sentence-preview" id="sentencePreview">
              <strong>V√≠ d·ª•:</strong>
              <span id="previewText">Ich bin Lara.</span>
            </div>
          </div>

          <!-- Conjugation Display Area -->
          <div
            class="conjugation-display"
            id="conjugationDisplay"
            style="display: none"
          >
            <div class="pronoun" id="pronounDisplay">ich</div>
            <div class="verb-infinitive" id="verbInfinitive">sein (l√†)</div>
            <div class="conjugation-example">
              <h4>üìö B·∫£ng chia ƒë·ªông t·ª´:</h4>
              <div class="conjugation-table" id="conjugationTable">
                <!-- Will be populated by JavaScript -->
              </div>
            </div>
          </div>

          <!-- Translation Help for Conjugation -->
          <div
            class="translation-help"
            id="translationHelp"
            style="display: none"
          >
            <h4>üåç D·ªãch nghƒ©a c√¢u:</h4>
            <div id="translationContent">
              <!-- Will be populated by JavaScript -->
            </div>
          </div>

          <div
            class="german-word-display"
            id="germanWord"
            onclick="speakWord(currentWord.german)"
            style="display: none"
          >
            Klicken Sie hier zum Anh√∂ren üîä
          </div>

          <!-- Example Sentence Display -->
          <div
            class="example-sentence"
            id="exampleSentence"
            style="display: none"
          >
            <h4>üìñ C√¢u v√≠ d·ª•:</h4>
            <p>
              <strong>üá©üá™ Ti·∫øng ƒê·ª©c:</strong> <span id="germanSentence"></span>
            </p>
            <p>
              <strong>üáªüá≥ Ti·∫øng Vi·ªát:</strong>
              <span id="vietnameseSentence"></span>
            </p>
            <button
              class="btn btn-primary"
              style="margin-top: 10px; font-size: 0.9em"
              onclick="speakSentence()"
            >
              üîä Nghe c√¢u v√≠ d·ª•
            </button>
          </div>

          <!-- Speech Recognition Area -->
          <div class="speech-recognition" id="speechArea" style="display: none">
            <p>Ph√°t √¢m t·ª´ ti·∫øng ƒê·ª©c sau:</p>
            <div class="german-word-display" id="speakingWord"></div>
            <div class="audio-visualizer" id="audioVisualizer">
              <div class="audio-bar"></div>
              <div class="audio-bar"></div>
              <div class="audio-bar"></div>
              <div class="audio-bar"></div>
              <div class="audio-bar"></div>
            </div>
            <button
              class="mic-button"
              id="micButton"
              onclick="toggleRecording()"
            >
              üé§
            </button>
            <p id="recognitionStatus">Nh·∫•n v√†o micro ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
            <div
              class="pronunciation-feedback"
              id="pronunciationFeedback"
              style="display: none"
            ></div>
          </div>

          <!-- Input Area for Writing and Conjugation -->
          <div class="input-area" id="inputArea" style="display: none">
            <input
              type="text"
              class="text-input"
              id="textInput"
              placeholder="Nh·∫≠p t·ª´ ti·∫øng ƒê·ª©c..."
              maxlength="100"
            />
          </div>
        </div>

        <div class="options" id="options">
          <!-- Options will be generated by JavaScript -->
        </div>

        <div class="feedback" id="feedback" style="display: none"></div>

        <div class="controls">
          <button
            class="btn btn-primary"
            id="playButton"
            onclick="playCurrentWord()"
          >
            üîä Ph√°t √¢m
          </button>
          <button
            class="btn btn-success"
            id="submitButton"
            onclick="submitAnswer()"
            style="display: none"
          >
            ‚úì Ki·ªÉm tra
          </button>
          <button
            class="btn btn-primary"
            id="nextButton"
            onclick="nextQuestion()"
            style="display: none"
          >
            ‚û°Ô∏è C√¢u ti·∫øp theo
          </button>
          <button class="btn btn-warning" onclick="skipQuestion()">
            ‚è≠Ô∏è B·ªè qua (<span id="remainingCount">185</span> c√≤n l·∫°i)
          </button>
          <button class="btn btn-secondary" onclick="showMainMenu()">
            üè† Menu ch√≠nh
          </button>
        </div>
      </div>

      <!-- Results -->
      <div id="results" class="results" style="display: none">
        <h3>üéâ K·∫øt qu·∫£ luy·ªán t·∫≠p</h3>
        <div class="results-stats">
          <div class="result-item">
            <span class="result-number" id="finalScore">0</span>
            <div class="result-label">ƒêi·ªÉm s·ªë</div>
          </div>
          <div class="result-item">
            <span class="result-number" id="finalCorrect">0</span>
            <div class="result-label">C√¢u ƒë√∫ng</div>
          </div>
          <div class="result-item">
            <span class="result-number" id="finalWrong">0</span>
            <div class="result-label">C√¢u sai</div>
          </div>
          <div class="result-item">
            <span class="result-number" id="finalAccuracy">0%</span>
            <div class="result-label">ƒê·ªô ch√≠nh x√°c</div>
          </div>
        </div>
        <div class="controls">
          <button class="btn btn-primary" onclick="restartGame()">
            üîÑ Ch∆°i l·∫°i
          </button>
          <button class="btn btn-secondary" onclick="showMainMenu()">
            üè† V·ªÅ menu ch√≠nh
          </button>
        </div>
      </div>
    </div>

    <script>
      // Vocabulary database with 185 words from 4 lessons
      const vocabulary = [
        // Bu·ªïi 1: Gi·ªõi thi·ªáu b·∫£n th√¢n (73 t·ª´)
        { german: "ich", vietnamese: "t√¥i", lesson: 1 },
        { german: "bin", vietnamese: "l√†", lesson: 1 },
        { german: "ist", vietnamese: "l√†", lesson: 1 },
        { german: "hei√üe", vietnamese: "t√™n l√†", lesson: 1 },
        { german: "Hallo", vietnamese: "xin ch√†o", lesson: 1 },
        { german: "Guten Tag", vietnamese: "ch√†o bu·ªïi chi·ªÅu", lesson: 1 },
        { german: "Tsch√ºs", vietnamese: "t·∫°m bi·ªát", lesson: 1 },
        { german: "komme", vietnamese: "ƒë·∫øn", lesson: 1 },
        { german: "spreche", vietnamese: "n√≥i", lesson: 1 },
        { german: "aus", vietnamese: "t·ª´", lesson: 1 },
        { german: "und", vietnamese: "v√†", lesson: 1 },
        { german: "ein bisschen", vietnamese: "m·ªôt ch√∫t", lesson: 1 },
        { german: "mein", vietnamese: "c·ªßa t√¥i", lesson: 1 },
        { german: "Name", vietnamese: "t√™n", lesson: 1 },
        { german: "ja", vietnamese: "c√≥", lesson: 1 },
        { german: "nein", vietnamese: "kh√¥ng", lesson: 1 },
        { german: "okay", vietnamese: "ƒë∆∞·ª£c r·ªìi", lesson: 1 },
        { german: "bitte", vietnamese: "l√†m ∆°n", lesson: 1 },
        { german: "Deutschland", vietnamese: "n∆∞·ªõc ƒê·ª©c", lesson: 1 },
        { german: "Englisch", vietnamese: "ti·∫øng Anh", lesson: 1 },
        { german: "Mama", vietnamese: "m·∫π", lesson: 1 },
        { german: "Opa", vietnamese: "√¥ng", lesson: 1 },
        { german: "du", vietnamese: "b·∫°n", lesson: 1 },
        { german: "Wie", vietnamese: "nh∆∞ th·∫ø n√†o", lesson: 1 },
        { german: "Woher", vietnamese: "t·ª´ ƒë√¢u", lesson: 1 },
        { german: "Was", vietnamese: "c√°i g√¨", lesson: 1 },
        { german: "oder", vietnamese: "ho·∫∑c", lesson: 1 },
        { german: "Auf Wiedersehen", vietnamese: "t·∫°m bi·ªát", lesson: 1 },
        { german: "doch", vietnamese: "th·∫≠t ra", lesson: 1 },
        { german: "ganz", vietnamese: "ho√†n to√†n", lesson: 1 },
        { german: "einfach", vietnamese: "ƒë∆°n gi·∫£n", lesson: 1 },
        { german: "super", vietnamese: "tuy·ªát v·ªùi", lesson: 1 },
        { german: "gut", vietnamese: "t·ªët", lesson: 1 },
        { german: "richtig", vietnamese: "ƒë√∫ng", lesson: 1 },
        { german: "eins", vietnamese: "m·ªôt", lesson: 1 },
        { german: "zwei", vietnamese: "hai", lesson: 1 },
        { german: "drei", vietnamese: "ba", lesson: 1 },
        { german: "zuerst", vietnamese: "tr∆∞·ªõc ti√™n", lesson: 1 },
        { german: "nochmal", vietnamese: "m·ªôt l·∫ßn n·ªØa", lesson: 1 },
        { german: "Oh", vietnamese: "√¥i", lesson: 1 },
        { german: "Hey", vietnamese: "n√†y", lesson: 1 },
        { german: "Ach", vietnamese: "√¥i", lesson: 1 },
        { german: "Na los", vietnamese: "n√†o th√¥i", lesson: 1 },
        { german: "komm", vietnamese: "ƒë·∫øn", lesson: 1 },
        { german: "hast", vietnamese: "c√≥", lesson: 1 },
        { german: "vergessen", vietnamese: "qu√™n", lesson: 1 },
        { german: "das", vietnamese: "ƒëi·ªÅu ƒë√≥", lesson: 1 },
        { german: "dann", vietnamese: "sau ƒë√≥", lesson: 1 },
        { german: "jetzt", vietnamese: "b√¢y gi·ªù", lesson: 1 },
        { german: "hier", vietnamese: "ƒë√¢y", lesson: 1 },
        { german: "√Ñhm", vietnamese: "·ª´m", lesson: 1 },
        { german: "Puh", vietnamese: "ph√π", lesson: 1 },
        { german: "Halli hallo", vietnamese: "ch√†o ch√†o", lesson: 1 },
        { german: "tut mir leid", vietnamese: "xin l·ªói", lesson: 1 },
        { german: "Keine Zeit", vietnamese: "kh√¥ng c√≥ th·ªùi gian", lesson: 1 },
        { german: "Lara", vietnamese: "Lara", lesson: 1 },
        { german: "Walter", vietnamese: "Walter", lesson: 1 },
        { german: "Sofia", vietnamese: "Sofia", lesson: 1 },
        { german: "Polen", vietnamese: "Ba Lan", lesson: 1 },
        { german: "Polnisch", vietnamese: "ti·∫øng Ba Lan", lesson: 1 },
        { german: "Spanisch", vietnamese: "ti·∫øng T√¢y Ban Nha", lesson: 1 },
        { german: "sehen", vietnamese: "nh√¨n", lesson: 1 },
        { german: "sie", vietnamese: "h·ªç", lesson: 1 },
        { german: "die", vietnamese: "nh·ªØng", lesson: 1 },
        { german: "Fotos", vietnamese: "nh·ªØng b·ª©c ·∫£nh", lesson: 1 },
        { german: "an", vietnamese: "t·∫°i", lesson: 1 },
        { german: "h√∂ren", vietnamese: "nghe", lesson: 1 },
        { german: "noch einmal", vietnamese: "m·ªôt l·∫ßn n·ªØa", lesson: 1 },
        { german: "kreuzen", vietnamese: "ƒë√°nh d·∫•u X", lesson: 1 },
        { german: "So", vietnamese: "v·∫≠y", lesson: 1 },
        { german: "aber", vietnamese: "nh∆∞ng", lesson: 1 },
        { german: "noch", vietnamese: "c√≤n", lesson: 1 },
        { german: "Also", vietnamese: "v·∫≠y th√¨", lesson: 1 },
        { german: "Foto", vietnamese: "·∫£nh", lesson: 1 },
        { german: "Wartet", vietnamese: "ch·ªù ƒë√£", lesson: 1 },

        // Bu·ªïi 2: Giao ti·∫øp h√†ng ng√†y (34 t·ª´)
        { german: "danke", vietnamese: "c·∫£m ∆°n", lesson: 2 },
        { german: "Entschuldigung", vietnamese: "xin l·ªói", lesson: 2 },
        { german: "Guten Morgen", vietnamese: "ch√†o bu·ªïi s√°ng", lesson: 2 },
        { german: "Guten Abend", vietnamese: "ch√†o bu·ªïi t·ªëi", lesson: 2 },
        { german: "Gute Nacht", vietnamese: "ch√∫c ng·ªß ngon", lesson: 2 },
        {
          german: "Ich wei√ü es nicht",
          vietnamese: "t√¥i kh√¥ng bi·∫øt",
          lesson: 2,
        },
        { german: "Willkommen", vietnamese: "ch√†o m·ª´ng", lesson: 2 },
        { german: "sprechen", vietnamese: "n√≥i", lesson: 2 },
        { german: "Herr", vietnamese: "√¥ng", lesson: 2 },
        { german: "Frau", vietnamese: "b√†", lesson: 2 },
        {
          german: "Damen und Herren",
          vietnamese: "qu√Ω b√† v√† qu√Ω √¥ng",
          lesson: 2,
        },
        { german: "Kinder", vietnamese: "tr·∫ª em", lesson: 2 },
        { german: "bei", vietnamese: "·ªü", lesson: 2 },
        { german: "freut", vietnamese: "vui m·ª´ng", lesson: 2 },
        { german: "herzlich", vietnamese: "ch√¢n th√†nh", lesson: 2 },
        { german: "suchen", vietnamese: "t√¨m ki·∫øm", lesson: 2 },
        { german: "morgen", vietnamese: "ng√†y mai", lesson: 2 },
        { german: "Vormittag", vietnamese: "bu·ªïi s√°ng mu·ªôn", lesson: 2 },
        { german: "Mittag", vietnamese: "bu·ªïi tr∆∞a", lesson: 2 },
        { german: "Nachmittag", vietnamese: "bu·ªïi chi·ªÅu", lesson: 2 },
        { german: "Ordnen Sie zu", vietnamese: "h√£y s·∫Øp x·∫øp", lesson: 2 },
        { german: "Erg√§nzen", vietnamese: "b·ªï sung", lesson: 2 },
        { german: "lesen", vietnamese: "ƒë·ªçc", lesson: 2 },
        { german: "K√§rtchen", vietnamese: "th·∫ª nh·ªè", lesson: 2 },
        { german: "Kurs", vietnamese: "kh√≥a h·ªçc", lesson: 2 },
        { german: "im", vietnamese: "trong", lesson: 2 },
        { german: "international", vietnamese: "qu·ªëc t·∫ø", lesson: 2 },
        { german: "Musik", vietnamese: "√¢m nh·∫°c", lesson: 2 },
        { german: "Klinikum", vietnamese: "b·ªánh vi·ªán", lesson: 2 },
        { german: "Namen", vietnamese: "nh·ªØng c√°i t√™n", lesson: 2 },
        { german: "Bekannte", vietnamese: "ng∆∞·ªùi quen", lesson: 2 },
        { german: "Personen", vietnamese: "nh·ªØng ng∆∞·ªùi", lesson: 2 },
        { german: "zeigen", vietnamese: "ch·ªâ", lesson: 2 },
        { german: "fragen", vietnamese: "h·ªèi", lesson: 2 },

        // Bu·ªïi 3: Ho·∫°t ƒë·ªông h·ªçc t·∫≠p v√† giao ti·∫øp (35 t·ª´)
        { german: "erste", vietnamese: "ƒë·∫ßu ti√™n", lesson: 3 },
        { german: "stimmt", vietnamese: "ƒë√∫ng", lesson: 3 },
        { german: "schon", vietnamese: "ƒë√£", lesson: 3 },
        { german: "fertig", vietnamese: "xong", lesson: 3 },
        { german: "alle", vietnamese: "t·∫•t c·∫£", lesson: 3 },
        { german: "mit", vietnamese: "v·ªõi", lesson: 3 },
        { german: "wer", vietnamese: "ai", lesson: 3 },
        { german: "nur", vietnamese: "ch·ªâ", lesson: 3 },
        { german: "toll", vietnamese: "tuy·ªát v·ªùi", lesson: 3 },
        { german: "interessant", vietnamese: "th√∫ v·ªã", lesson: 3 },
        { german: "bist", vietnamese: "l√†", lesson: 3 },
        { german: "sprichst", vietnamese: "n√≥i", lesson: 3 },
        { german: "auch", vietnamese: "c≈©ng", lesson: 3 },
        { german: "einen Moment", vietnamese: "m·ªôt ch√∫t", lesson: 3 },
        { german: "Stunde", vietnamese: "gi·ªù", lesson: 3 },
        { german: "Lektion", vietnamese: "b√†i h·ªçc", lesson: 3 },
        { german: "schreiben", vietnamese: "vi·∫øt", lesson: 3 },
        { german: "markieren", vietnamese: "ƒë√°nh d·∫•u", lesson: 3 },
        { german: "Gespr√§che", vietnamese: "cu·ªôc tr√≤ chuy·ªán", lesson: 3 },
        {
          german: "Telefongespr√§ch",
          vietnamese: "cu·ªôc g·ªçi ƒëi·ªán tho·∫°i",
          lesson: 3,
        },
        { german: "antworten", vietnamese: "tr·∫£ l·ªùi", lesson: 3 },
        { german: "Beispiel", vietnamese: "v√≠ d·ª•", lesson: 3 },
        { german: "W√∂rter", vietnamese: "t·ª´ v·ª±ng", lesson: 3 },
        { german: "Sprachen", vietnamese: "ng√¥n ng·ªØ", lesson: 3 },
        { german: "Buchstaben", vietnamese: "ch·ªØ c√°i", lesson: 3 },
        { german: "buchstabieren", vietnamese: "ƒë√°nh v·∫ßn", lesson: 3 },
        { german: "buchstabiere", vietnamese: "t√¥i ƒë√°nh v·∫ßn", lesson: 3 },
        { german: "machen", vietnamese: "l√†m", lesson: 3 },
        { german: "vergleichen", vietnamese: "so s√°nh", lesson: 3 },
        { german: "raten", vietnamese: "ƒëo√°n", lesson: 3 },
        { german: "Spiel", vietnamese: "tr√≤ ch∆°i", lesson: 3 },
        { german: "ihrer", vietnamese: "c·ªßa h·ªç", lesson: 3 },
        { german: "ihrem", vietnamese: "c·ªßa h·ªç", lesson: 3 },
        { german: "Firma", vietnamese: "c√¥ng ty", lesson: 3 },
        { german: "Buchstabenmaus", vietnamese: "chu·ªôt ch·ªØ c√°i", lesson: 3 },

        // Bu·ªïi 4: Th√¥ng tin c√° nh√¢n v√† ƒêƒÉng k√Ω (43 t·ª´)
        { german: "Vorname", vietnamese: "t√™n", lesson: 4 },
        { german: "Familienname", vietnamese: "h·ªç", lesson: 4 },
        { german: "Adresse", vietnamese: "ƒë·ªãa ch·ªâ", lesson: 4 },
        { german: "Land", vietnamese: "ƒë·∫•t n∆∞·ªõc", lesson: 4 },
        { german: "m√∂chten", vietnamese: "mu·ªën", lesson: 4 },
        { german: "mehr", vietnamese: "nhi·ªÅu h∆°n", lesson: 4 },
        { german: "f√ºr", vietnamese: "cho", lesson: 4 },
        { german: "nach", vietnamese: "sau", lesson: 4 },
        { german: "Nachname", vietnamese: "h·ªç", lesson: 4 },
        { german: "Visitenkarten", vietnamese: "danh thi·∫øp", lesson: 4 },
        { german: "Herkunft", vietnamese: "xu·∫•t x·ª©", lesson: 4 },
        { german: "Heimatland", vietnamese: "qu√™ h∆∞∆°ng", lesson: 4 },
        { german: "L√§nder", vietnamese: "c√°c n∆∞·ªõc", lesson: 4 },
        { german: "Stra√üe", vietnamese: "ƒë∆∞·ªùng", lesson: 4 },
        { german: "Hausnummer", vietnamese: "s·ªë nh√†", lesson: 4 },
        { german: "Stadt", vietnamese: "th√†nh ph·ªë", lesson: 4 },
        { german: "Postleitzahl", vietnamese: "m√£ b∆∞u ch√≠nh", lesson: 4 },
        { german: "Anmeldung", vietnamese: "ƒëƒÉng k√Ω", lesson: 4 },
        {
          german: "Anmeldeformular",
          vietnamese: "bi·ªÉu m·∫´u ƒëƒÉng k√Ω",
          lesson: 4,
        },
        { german: "ausf√ºllen", vietnamese: "ƒëi·ªÅn v√†o", lesson: 4 },
        {
          german: "Sprachschule",
          vietnamese: "tr∆∞·ªùng d·∫°y ngo·∫°i ng·ªØ",
          lesson: 4,
        },
        { german: "Anf√§nger", vietnamese: "ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu", lesson: 4 },
        { german: "Lernziele", vietnamese: "m·ª•c ti√™u h·ªçc t·∫≠p", lesson: 4 },
        { german: "Fremdsprache", vietnamese: "ngo·∫°i ng·ªØ", lesson: 4 },
        { german: "Grammatik", vietnamese: "ng·ªØ ph√°p", lesson: 4 },
        { german: "Konjugation", vietnamese: "chia ƒë·ªông t·ª´", lesson: 4 },
        { german: "merke", vietnamese: "ghi nh·ªõ", lesson: 4 },
        { german: "tauschen", vietnamese: "trao ƒë·ªïi", lesson: 4 },
        { german: "Karten", vietnamese: "th·∫ª", lesson: 4 },
        { german: "Kommunikation", vietnamese: "giao ti·∫øp", lesson: 4 },
        { german: "√ºben", vietnamese: "luy·ªán t·∫≠p", lesson: 4 },
        { german: "wiederholen", vietnamese: "l·∫∑p l·∫°i", lesson: 4 },
        { german: "Begr√º√üung", vietnamese: "l·ªùi ch√†o", lesson: 4 },
        { german: "Abschied", vietnamese: "l·ªùi t·∫°m bi·ªát", lesson: 4 },
        { german: "verabschieden", vietnamese: "n√≥i t·∫°m bi·ªát", lesson: 4 },
        { german: "als", vietnamese: "nh∆∞", lesson: 4 },
        { german: "dem", vietnamese: "c√°i ƒë√≥", lesson: 4 },
        { german: "welchen", vietnamese: "n√†o", lesson: 4 },
        { german: "nun", vietnamese: "b√¢y gi·ªù", lesson: 4 },
        { german: "Aussage", vietnamese: "c√¢u kh·∫≥ng ƒë·ªãnh", lesson: 4 },
        { german: "Frage", vietnamese: "c√¢u h·ªèi", lesson: 4 },
        { german: "Strategien", vietnamese: "c√°c chi·∫øn l∆∞·ª£c", lesson: 4 },
        { german: "sagen", vietnamese: "n√≥i", lesson: 4 },
      ];

      // Enhanced example sentences with realistic usage contexts
      const exampleSentences = {
        ich: {
          german: "Ich arbeite in einem B√ºro in der Stadt.",
          vietnamese: "T√¥i l√†m vi·ªác trong m·ªôt vƒÉn ph√≤ng ·ªü th√†nh ph·ªë.",
        },
        bin: {
          german: "Ich bin sehr m√ºde nach der langen Reise.",
          vietnamese: "T√¥i r·∫•t m·ªát sau chuy·∫øn ƒëi d√†i.",
        },
        ist: {
          german: "Das Wetter ist heute wundersch√∂n.",
          vietnamese: "Th·ªùi ti·∫øt h√¥m nay th·∫≠t ƒë·∫πp.",
        },
        hei√üe: {
          german: "Ich hei√üe Anna und komme aus Berlin.",
          vietnamese: "T√¥i t√™n Anna v√† ƒë·∫øn t·ª´ Berlin.",
        },
        Hallo: {
          german: "Hallo Maria! Wie geht es dir heute?",
          vietnamese: "Ch√†o Maria! H√¥m nay b·∫°n c√≥ kh·ªèe kh√¥ng?",
        },
        "Guten Tag": {
          german: "Guten Tag, Herr Schmidt! Freut mich, Sie zu sehen.",
          vietnamese: "Ch√†o bu·ªïi chi·ªÅu, √¥ng Schmidt! R·∫•t vui ƒë∆∞·ª£c g·∫∑p √¥ng.",
        },
        komme: {
          german: "Ich komme jeden Morgen um acht Uhr zur Arbeit.",
          vietnamese: "T√¥i ƒë·∫øn l√†m vi·ªác m·ªói s√°ng l√∫c t√°m gi·ªù.",
        },
        spreche: {
          german:
            "Ich spreche drei Sprachen: Deutsch, Englisch und Franz√∂sisch.",
          vietnamese: "T√¥i n√≥i ba th·ª© ti·∫øng: ƒê·ª©c, Anh v√† Ph√°p.",
        },
        aus: {
          german: "Der Zug aus M√ºnchen kommt um 15:30 an.",
          vietnamese: "Chuy·∫øn t√†u t·ª´ Munich ƒë·∫øn l√∫c 15:30.",
        },
        und: {
          german: "Meine Hobbys sind Lesen und Musik h√∂ren.",
          vietnamese: "S·ªü th√≠ch c·ªßa t√¥i l√† ƒë·ªçc s√°ch v√† nghe nh·∫°c.",
        },
        danke: {
          german: "Danke f√ºr deine Hilfe bei der Hausarbeit!",
          vietnamese: "C·∫£m ∆°n b·∫°n ƒë√£ gi√∫p t√¥i l√†m vi·ªác nh√†!",
        },
        bitte: {
          german: "K√∂nnen Sie bitte langsamer sprechen?",
          vietnamese: "B·∫°n c√≥ th·ªÉ n√≥i ch·∫≠m h∆°n ƒë∆∞·ª£c kh√¥ng?",
        },
        ja: {
          german: "Ja, ich m√∂chte gerne einen Kaffee bestellen.",
          vietnamese: "V√¢ng, t√¥i mu·ªën g·ªçi m·ªôt ly c√† ph√™.",
        },
        nein: {
          german: "Nein, ich habe heute leider keine Zeit.",
          vietnamese: "Kh√¥ng, h√¥m nay t√¥i kh√¥ng c√≥ th·ªùi gian.",
        },
        gut: {
          german: "Das Restaurant hat sehr gutes Essen.",
          vietnamese: "Nh√† h√†ng ƒë√≥ c√≥ ƒë·ªì ƒÉn r·∫•t ngon.",
        },
        Name: {
          german: "Wie ist Ihr Name? Mein Name ist Thomas.",
          vietnamese: "T√™n c·ªßa anh/ch·ªã l√† g√¨? T√™n t√¥i l√† Thomas.",
        },
        Deutschland: {
          german: "Deutschland liegt in der Mitte von Europa.",
          vietnamese: "N∆∞·ªõc ƒê·ª©c n·∫±m ·ªü gi·ªØa ch√¢u √Çu.",
        },
        Englisch: {
          german: "In der Schule lernen wir Englisch und Franz√∂sisch.",
          vietnamese: "·ªû tr∆∞·ªùng ch√∫ng t√¥i h·ªçc ti·∫øng Anh v√† ti·∫øng Ph√°p.",
        },
        Mama: {
          german: "Meine Mama kocht jeden Sonntag f√ºr die ganze Familie.",
          vietnamese: "M·∫π t√¥i n·∫•u ƒÉn cho c·∫£ gia ƒë√¨nh m·ªói ch·ªß nh·∫≠t.",
        },
        du: {
          german: "Wo wohnst du? Ich wohne in der Stadtmitte.",
          vietnamese: "B·∫°n s·ªëng ·ªü ƒë√¢u? T√¥i s·ªëng ·ªü trung t√¢m th√†nh ph·ªë.",
        },
        hier: {
          german: "Hier ist mein Lieblingsrestaurant in der Stadt.",
          vietnamese: "ƒê√¢y l√† nh√† h√†ng y√™u th√≠ch c·ªßa t√¥i trong th√†nh ph·ªë.",
        },
        morgen: {
          german: "Morgen fahre ich mit dem Zug nach Hamburg.",
          vietnamese: "Ng√†y mai t√¥i ƒëi t√†u ƒë·∫øn Hamburg.",
        },
        Zeit: {
          german: "Ich habe leider keine Zeit f√ºr ein langes Gespr√§ch.",
          vietnamese: "T√¥i kh√¥ng c√≥ th·ªùi gian ƒë·ªÉ tr√≤ chuy·ªán l√¢u.",
        },
        Arbeit: {
          german: "Nach der Arbeit gehe ich oft ins Fitnessstudio.",
          vietnamese: "Sau khi l√†m vi·ªác t√¥i th∆∞·ªùng ƒëi ph√≤ng gym.",
        },
        Haus: {
          german: "Unser Haus steht in einer ruhigen Stra√üe.",
          vietnamese: "Nh√† c·ªßa ch√∫ng t√¥i ·ªü tr√™n m·ªôt con ƒë∆∞·ªùng y√™n tƒ©nh.",
        },
        Wasser: {
          german: "K√∂nnen Sie mir bitte ein Glas Wasser bringen?",
          vietnamese: "B·∫°n c√≥ th·ªÉ mang cho t√¥i m·ªôt ly n∆∞·ªõc ƒë∆∞·ª£c kh√¥ng?",
        },
        Geld: {
          german: "F√ºr diese Reise brauche ich noch mehr Geld.",
          vietnamese: "ƒê·ªÉ ƒëi du l·ªãch n√†y t√¥i c·∫ßn th√™m ti·ªÅn.",
        },
        Familie: {
          german: "Am Wochenende besuche ich immer meine Familie.",
          vietnamese: "Cu·ªëi tu·∫ßn t√¥i lu√¥n thƒÉm gia ƒë√¨nh.",
        },
        Freund: {
          german: "Mein bester Freund wohnt in einer anderen Stadt.",
          vietnamese: "B·∫°n th√¢n nh·∫•t c·ªßa t√¥i s·ªëng ·ªü th√†nh ph·ªë kh√°c.",
        },
        Schule: {
          german: "Die Schule beginnt jeden Tag um acht Uhr.",
          vietnamese: "Tr∆∞·ªùng h·ªçc b·∫Øt ƒë·∫ßu m·ªói ng√†y l√∫c t√°m gi·ªù.",
        },
        Auto: {
          german: "Mein Auto steht vor dem Supermarkt.",
          vietnamese: "Xe c·ªßa t√¥i ƒë·∫≠u tr∆∞·ªõc si√™u th·ªã.",
        },
        Stadt: {
          german: "Diese Stadt hat viele interessante Museen.",
          vietnamese: "Th√†nh ph·ªë n√†y c√≥ nhi·ªÅu b·∫£o t√†ng th√∫ v·ªã.",
        },
        Land: {
          german: "Deutschland ist ein sch√∂nes Land in Europa.",
          vietnamese: "ƒê·ª©c l√† m·ªôt ƒë·∫•t n∆∞·ªõc ƒë·∫πp ·ªü ch√¢u √Çu.",
        },
      };

      // Pronoun data
      const pronouns = [
        { german: "ich", vietnamese: "t√¥i", type: "1st_singular" },
        { german: "du", vietnamese: "b·∫°n", type: "2nd_singular_informal" },
        {
          german: "Sie",
          vietnamese: "b·∫°n/anh/ch·ªã",
          type: "2nd_singular_formal",
        },
        { german: "er", vietnamese: "anh ·∫•y", type: "3rd_singular_masculine" },
        { german: "sie", vietnamese: "c√¥ ·∫•y", type: "3rd_singular_feminine" },
        { german: "es", vietnamese: "n√≥", type: "3rd_singular_neuter" },
        { german: "wir", vietnamese: "ch√∫ng t√¥i", type: "1st_plural" },
        { german: "ihr", vietnamese: "c√°c b·∫°n", type: "2nd_plural_informal" },
        {
          german: "Sie",
          vietnamese: "c√°c b·∫°n/qu√Ω v·ªã",
          type: "2nd_plural_formal",
        },
        { german: "sie", vietnamese: "h·ªç", type: "3rd_plural" },
      ];

      // Verb conjugation data
      const verbConjugations = {
        sein: {
          infinitive: "sein",
          vietnamese: "l√†",
          conjugations: {
            ich: "bin",
            du: "bist",
            Sie_formal: "sind",
            er: "ist",
            sie_fem: "ist",
            es: "ist",
            wir: "sind",
            ihr: "seid",
            sie_plural: "sind",
          },
          sentences: {
            statement: {
              ich: "Ich bin Studentin an der Universit√§t.",
              du: "Du bist sehr nett und hilfsbereit.",
              Sie_formal: "Sie sind unser neuer Lehrer.",
              er: "Er ist mein √§lterer Bruder.",
              sie_fem: "Sie ist eine ausgezeichnete √Ñrztin.",
              es: "Es ist heute sehr warm drau√üen.",
              wir: "Wir sind gute Freunde seit Jahren.",
              ihr: "Ihr seid die besten Sch√ºler der Klasse.",
              sie_plural: "Sie sind alle aus verschiedenen L√§ndern.",
            },
            negative: {
              ich: "Ich bin nicht m√ºde, ich bin voller Energie.",
              du: "Du bist nicht allein, wir sind hier f√ºr dich.",
              Sie_formal: "Sie sind nicht zu sp√§t, Sie sind p√ºnktlich.",
              er: "Er ist nicht zu Hause, er ist bei der Arbeit.",
              sie_fem: "Sie ist nicht krank, sie f√ºhlt sich gut.",
              es: "Es ist nicht kalt, es ist angenehm warm.",
              wir: "Wir sind nicht m√ºde von der langen Reise.",
              ihr: "Ihr seid nicht die Ersten, die das versuchen.",
              sie_plural: "Sie sind nicht aus Deutschland, sie sind Touristen.",
            },
            question: {
              ich: "Bin ich zu fr√ºh f√ºr unser Treffen?",
              du: "Bist du fertig mit deinen Hausaufgaben?",
              Sie_formal: "Sind Sie zufrieden mit dem Service?",
              er: "Ist er schon vom Einkaufen zur√ºck?",
              sie_fem: "Ist sie die neue Kollegin aus Berlin?",
              es: "Ist es m√∂glich, das Fenster zu √∂ffnen?",
              wir: "Sind wir auf dem richtigen Weg zum Bahnhof?",
              ihr: "Seid ihr bereit f√ºr die Pr√ºfung morgen?",
              sie_plural:
                "Sind sie mit dem Flugzeug oder mit dem Zug gekommen?",
            },
          },
          translations: {
            statement: {
              ich: "T√¥i l√† sinh vi√™n ·ªü tr∆∞·ªùng ƒë·∫°i h·ªçc.",
              du: "B·∫°n r·∫•t t·ªët b·ª•ng v√† hay gi√∫p ƒë·ª°.",
              Sie_formal: "Anh/ch·ªã l√† gi√°o vi√™n m·ªõi c·ªßa ch√∫ng t√¥i.",
              er: "Anh ·∫•y l√† anh trai c·ªßa t√¥i.",
              sie_fem: "C√¥ ·∫•y l√† m·ªôt b√°c sƒ© xu·∫•t s·∫Øc.",
              es: "H√¥m nay tr·ªùi r·∫•t ·∫•m.",
              wir: "Ch√∫ng t√¥i l√† b·∫°n t·ªët t·ª´ nhi·ªÅu nƒÉm nay.",
              ihr: "C√°c b·∫°n l√† nh·ªØng h·ªçc sinh gi·ªèi nh·∫•t l·ªõp.",
              sie_plural: "H·ªç ƒë·ªÅu ƒë·∫øn t·ª´ nh·ªØng n∆∞·ªõc kh√°c nhau.",
            },
            negative: {
              ich: "T√¥i kh√¥ng m·ªát, t√¥i ƒë·∫ßy nƒÉng l∆∞·ª£ng.",
              du: "B·∫°n kh√¥ng c√¥ ƒë∆°n, ch√∫ng t√¥i ·ªü ƒë√¢y v√¨ b·∫°n.",
              Sie_formal: "Anh/ch·ªã kh√¥ng mu·ªôn, anh/ch·ªã ƒë√∫ng gi·ªù.",
              er: "Anh ·∫•y kh√¥ng ·ªü nh√†, anh ·∫•y ƒëang l√†m vi·ªác.",
              sie_fem: "C√¥ ·∫•y kh√¥ng b·ªánh, c√¥ ·∫•y c·∫£m th·∫•y kh·ªèe.",
              es: "Tr·ªùi kh√¥ng l·∫°nh, tr·ªùi ·∫•m d·ªÖ ch·ªãu.",
              wir: "Ch√∫ng t√¥i kh√¥ng m·ªát v√¨ chuy·∫øn ƒëi d√†i.",
              ihr: "C√°c b·∫°n kh√¥ng ph·∫£i l√† nh·ªØng ng∆∞·ªùi ƒë·∫ßu ti√™n th·ª≠ ƒëi·ªÅu n√†y.",
              sie_plural: "H·ªç kh√¥ng ph·∫£i ng∆∞·ªùi ƒê·ª©c, h·ªç l√† kh√°ch du l·ªãch.",
            },
            question: {
              ich: "T√¥i c√≥ ƒë·∫øn s·ªõm cho cu·ªôc h·∫πn kh√¥ng?",
              du: "B·∫°n ƒë√£ l√†m xong b√†i t·∫≠p v·ªÅ nh√† ch∆∞a?",
              Sie_formal: "Anh/ch·ªã c√≥ h√†i l√≤ng v·ªõi d·ªãch v·ª• kh√¥ng?",
              er: "Anh ·∫•y ƒë√£ mua s·∫Øm v·ªÅ ch∆∞a?",
              sie_fem: "C√¥ ·∫•y c√≥ ph·∫£i l√† ƒë·ªìng nghi·ªáp m·ªõi t·ª´ Berlin kh√¥ng?",
              es: "C√≥ th·ªÉ m·ªü c·ª≠a s·ªï ƒë∆∞·ª£c kh√¥ng?",
              wir: "Ch√∫ng ta c√≥ ƒëi ƒë√∫ng ƒë∆∞·ªùng ƒë·∫øn ga t√†u kh√¥ng?",
              ihr: "C√°c b·∫°n ƒë√£ s·∫µn s√†ng cho k·ª≥ thi ng√†y mai ch∆∞a?",
              sie_plural: "H·ªç ƒë·∫øn b·∫±ng m√°y bay hay t√†u h·ªèa?",
            },
          },
        },
        kommen: {
          infinitive: "kommen",
          vietnamese: "ƒë·∫øn",
          conjugations: {
            ich: "komme",
            du: "kommst",
            Sie_formal: "kommen",
            er: "kommt",
            sie_fem: "kommt",
            es: "kommt",
            wir: "kommen",
            ihr: "kommt",
            sie_plural: "kommen",
          },
          sentences: {
            statement: {
              ich: "Ich komme jeden Tag um acht Uhr zur Arbeit.",
              du: "Du kommst immer p√ºnktlich zu unseren Treffen.",
              Sie_formal: "Sie kommen aus einer sehr sch√∂nen Stadt.",
              er: "Er kommt heute Abend zu unserer Party.",
              sie_fem: "Sie kommt aus dem Norden von Deutschland.",
              es: "Es kommt mir bekannt vor, aber ich bin nicht sicher.",
              wir: "Wir kommen gerne zu euch zu Besuch.",
              ihr: "Ihr kommt doch morgen zum Picknick, oder?",
              sie_plural: "Sie kommen alle aus verschiedenen L√§ndern.",
            },
            negative: {
              ich: "Ich komme heute nicht zur Schule, ich bin krank.",
              du: "Du kommst nicht mit uns ins Kino, schade.",
              Sie_formal: "Sie kommen nicht aus Berlin, sondern aus M√ºnchen.",
              er: "Er kommt nicht rechtzeitig zum Termin.",
              sie_fem: "Sie kommt nicht zur Hochzeit, sie ist verreist.",
              es: "Es kommt nicht in Frage, dass wir das machen.",
              wir: "Wir kommen nicht vor sieben Uhr nach Hause.",
              ihr: "Ihr kommt nicht zu sp√§t, das ist wichtig.",
              sie_plural: "Sie kommen nicht aus Europa, sondern aus Asien.",
            },
            question: {
              ich: "Komme ich zu sp√§t zur Besprechung?",
              du: "Kommst du morgen zu meinem Geburtstag?",
              Sie_formal: "Kommen Sie oft in dieses Restaurant?",
              er: "Kommt er mit seinem Auto oder mit dem Bus?",
              sie_fem: "Kommt sie aus derselben Stadt wie wir?",
              es: "Kommt es h√§ufig vor, dass der Zug Versp√§tung hat?",
              wir: "Kommen wir rechtzeitig am Flughafen an?",
              ihr: "Kommt ihr alle zusammen oder getrennt?",
              sie_plural: "Kommen sie jeden Tag in dieses Caf√©?",
            },
          },
          translations: {
            statement: {
              ich: "T√¥i ƒë·∫øn l√†m vi·ªác m·ªói ng√†y l√∫c t√°m gi·ªù.",
              du: "B·∫°n lu√¥n ƒë·∫øn ƒë√∫ng gi·ªù cho c√°c cu·ªôc h·∫πn c·ªßa ch√∫ng ta.",
              Sie_formal: "Anh/ch·ªã ƒë·∫øn t·ª´ m·ªôt th√†nh ph·ªë r·∫•t ƒë·∫πp.",
              er: "Anh ·∫•y ƒë·∫øn b·ªØa ti·ªác c·ªßa ch√∫ng ta t·ªëi nay.",
              sie_fem: "C√¥ ·∫•y ƒë·∫øn t·ª´ ph√≠a b·∫Øc n∆∞·ªõc ƒê·ª©c.",
              es: "N√≥ c√≥ v·∫ª quen thu·ªôc v·ªõi t√¥i, nh∆∞ng t√¥i kh√¥ng ch·∫Øc.",
              wir: "Ch√∫ng t√¥i th√≠ch ƒë·∫øn thƒÉm c√°c b·∫°n.",
              ihr: "C√°c b·∫°n ƒë·∫øn d√£ ngo·∫°i ng√†y mai nh√©?",
              sie_plural: "H·ªç ƒë·ªÅu ƒë·∫øn t·ª´ nh·ªØng n∆∞·ªõc kh√°c nhau.",
            },
            negative: {
              ich: "T√¥i kh√¥ng ƒë·∫øn tr∆∞·ªùng h√¥m nay, t√¥i b·ªã ·ªëm.",
              du: "B·∫°n kh√¥ng ƒëi xem phim v·ªõi ch√∫ng t√¥i, ti·∫øc qu√°.",
              Sie_formal: "Anh/ch·ªã kh√¥ng ƒë·∫øn t·ª´ Berlin, m√† t·ª´ Munich.",
              er: "Anh ·∫•y kh√¥ng ƒë·∫øn ƒë√∫ng gi·ªù h·∫πn.",
              sie_fem: "C√¥ ·∫•y kh√¥ng ƒë·∫øn ƒë√°m c∆∞·ªõi, c√¥ ·∫•y ƒëi du l·ªãch.",
              es: "Kh√¥ng th·ªÉ n√†o ch√∫ng ta l√†m ƒëi·ªÅu ƒë√≥.",
              wir: "Ch√∫ng t√¥i kh√¥ng v·ªÅ nh√† tr∆∞·ªõc b·∫£y gi·ªù.",
              ihr: "C√°c b·∫°n kh√¥ng ƒë∆∞·ª£c ƒë·∫øn mu·ªôn, ƒëi·ªÅu ƒë√≥ quan tr·ªçng.",
              sie_plural: "H·ªç kh√¥ng ƒë·∫øn t·ª´ ch√¢u √Çu, m√† t·ª´ ch√¢u √Å.",
            },
            question: {
              ich: "T√¥i c√≥ ƒë·∫øn mu·ªôn cu·ªôc h·ªçp kh√¥ng?",
              du: "B·∫°n c√≥ ƒë·∫øn sinh nh·∫≠t c·ªßa t√¥i ng√†y mai kh√¥ng?",
              Sie_formal: "Anh/ch·ªã c√≥ th∆∞·ªùng ƒë·∫øn nh√† h√†ng n√†y kh√¥ng?",
              er: "Anh ·∫•y ƒë·∫øn b·∫±ng xe ri√™ng hay xe bus?",
              sie_fem: "C√¥ ·∫•y c√≥ ƒë·∫øn t·ª´ c√πng th√†nh ph·ªë v·ªõi ch√∫ng ta kh√¥ng?",
              es: "C√≥ th∆∞·ªùng xuy√™n x·∫£y ra vi·ªác t√†u b·ªã tr·ªÖ kh√¥ng?",
              wir: "Ch√∫ng ta c√≥ ƒë·∫øn s√¢n bay ƒë√∫ng gi·ªù kh√¥ng?",
              ihr: "C√°c b·∫°n ƒë·∫øn c√πng nhau hay ri√™ng l·∫ª?",
              sie_plural: "H·ªç c√≥ ƒë·∫øn qu√°n c√† ph√™ n√†y h√†ng ng√†y kh√¥ng?",
            },
          },
        },
        hei√üen: {
          infinitive: "hei√üen",
          vietnamese: "t√™n l√†",
          conjugations: {
            ich: "hei√üe",
            du: "hei√üt",
            Sie_formal: "hei√üen",
            er: "hei√üt",
            sie_fem: "hei√üt",
            es: "hei√üt",
            wir: "hei√üen",
            ihr: "hei√üt",
            sie_plural: "hei√üen",
          },
          sentences: {
            statement: {
              ich: "Ich hei√üe Maria und studiere Medizin.",
              du: "Du hei√üt Thomas, richtig?",
              Sie_formal: "Sie hei√üen Herr Schmidt, freut mich.",
              er: "Er hei√üt Peter und arbeitet als Ingenieur.",
              sie_fem: "Sie hei√üt Anna und kommt aus √ñsterreich.",
              es: "Es hei√üt, dass morgen sch√∂nes Wetter wird.",
              wir: "Wir hei√üen alle neuen Studenten willkommen.",
              ihr: "Ihr hei√üt beide Michael, das ist verwirrend.",
              sie_plural: "Sie hei√üen M√ºller und wohnen nebenan.",
            },
            negative: {
              ich: "Ich hei√üe nicht Anna, ich hei√üe Elena.",
              du: "Du hei√üt nicht Klaus, sondern Thomas.",
              Sie_formal: "Sie hei√üen nicht Schmidt, oder?",
              er: "Er hei√üt nicht Hans, er hei√üt Heinrich.",
              sie_fem: "Sie hei√üt nicht Lisa, sie hei√üt Lena.",
              es: "Es hei√üt nicht, dass wir aufgeben sollen.",
              wir: "Wir hei√üen nicht alle gleich in der Familie.",
              ihr: "Ihr hei√üt nicht beide Peter, das w√§re seltsam.",
              sie_plural: "Sie hei√üen nicht Wagner, sie hei√üen Weber.",
            },
            question: {
              ich: "Hei√üe ich Sie herzlich willkommen?",
              du: "Hei√üt du wirklich Sebastian?",
              Sie_formal: "Hei√üen Sie Frau M√ºller?",
              er: "Hei√üt er nicht eigentlich Andreas?",
              sie_fem: "Hei√üt sie nicht Sabine?",
              es: "Hei√üt es nicht, dass wir um zehn Uhr anfangen?",
              wir: "Hei√üen wir die G√§ste richtig willkommen?",
              ihr: "Hei√üt ihr wirklich beide Alexander?",
              sie_plural: "Hei√üen sie Brown oder Braun?",
            },
          },
          translations: {
            statement: {
              ich: "T√¥i t√™n l√† Maria v√† h·ªçc ng√†nh y.",
              du: "B·∫°n t√™n l√† Thomas, ƒë√∫ng kh√¥ng?",
              Sie_formal: "Anh t√™n l√† √¥ng Schmidt, r·∫•t vui ƒë∆∞·ª£c g·∫∑p.",
              er: "Anh ·∫•y t√™n l√† Peter v√† l√†m k·ªπ s∆∞.",
              sie_fem: "C√¥ ·∫•y t√™n l√† Anna v√† ƒë·∫øn t·ª´ √Åo.",
              es: "Ng∆∞·ªùi ta n√≥i r·∫±ng ng√†y mai th·ªùi ti·∫øt s·∫Ω ƒë·∫πp.",
              wir: "Ch√∫ng t√¥i ch√†o m·ª´ng t·∫•t c·∫£ sinh vi√™n m·ªõi.",
              ihr: "C√°c b·∫°n ƒë·ªÅu t√™n l√† Michael, th·∫≠t kh√≥ hi·ªÉu.",
              sie_plural: "H·ªç t√™n l√† M√ºller v√† s·ªëng b√™n c·∫°nh.",
            },
            negative: {
              ich: "T√¥i kh√¥ng t√™n l√† Anna, t√¥i t√™n l√† Elena.",
              du: "B·∫°n kh√¥ng t√™n l√† Klaus, m√† l√† Thomas.",
              Sie_formal: "Anh kh√¥ng t√™n l√† Schmidt, ph·∫£i kh√¥ng?",
              er: "Anh ·∫•y kh√¥ng t√™n l√† Hans, anh ·∫•y t√™n l√† Heinrich.",
              sie_fem: "C√¥ ·∫•y kh√¥ng t√™n l√† Lisa, c√¥ ·∫•y t√™n l√† Lena.",
              es: "Kh√¥ng c√≥ nghƒ©a l√† ch√∫ng ta ph·∫£i t·ª´ b·ªè.",
              wir: "Ch√∫ng t√¥i kh√¥ng ph·∫£i ƒë·ªÅu c√πng t√™n trong gia ƒë√¨nh.",
              ihr: "C√°c b·∫°n kh√¥ng c√πng t√™n l√† Peter, ƒëi·ªÅu ƒë√≥ s·∫Ω l·∫°.",
              sie_plural: "H·ªç kh√¥ng t√™n l√† Wagner, h·ªç t√™n l√† Weber.",
            },
            question: {
              ich: "T√¥i c√≥ ch√†o m·ª´ng anh/ch·ªã n·ªìng nhi·ªát kh√¥ng?",
              du: "B·∫°n c√≥ th·∫≠t s·ª± t√™n l√† Sebastian kh√¥ng?",
              Sie_formal: "Ch·ªã c√≥ ph·∫£i l√† b√† M√ºller kh√¥ng?",
              er: "Anh ·∫•y c√≥ th·∫≠t s·ª± t√™n l√† Andreas kh√¥ng?",
              sie_fem: "C√¥ ·∫•y c√≥ t√™n l√† Sabine kh√¥ng?",
              es: "C√≥ ph·∫£i ch√∫ng ta b·∫Øt ƒë·∫ßu l√∫c m∆∞·ªùi gi·ªù kh√¥ng?",
              wir: "Ch√∫ng ta c√≥ ch√†o m·ª´ng kh√°ch ƒë√∫ng c√°ch kh√¥ng?",
              ihr: "C√°c b·∫°n c√≥ th·∫≠t s·ª± ƒë·ªÅu t√™n l√† Alexander kh√¥ng?",
              sie_plural: "H·ªç t√™n l√† Brown hay Braun?",
            },
          },
        },
        sprechen: {
          infinitive: "sprechen",
          vietnamese: "n√≥i",
          conjugations: {
            ich: "spreche",
            du: "sprichst",
            Sie_formal: "sprechen",
            er: "spricht",
            sie_fem: "spricht",
            es: "spricht",
            wir: "sprechen",
            ihr: "sprecht",
            sie_plural: "sprechen",
          },
          sentences: {
            statement: {
              ich: "Ich spreche flie√üend Deutsch und Englisch.",
              du: "Du sprichst sehr gut Franz√∂sisch.",
              Sie_formal: "Sie sprechen mit einem sch√∂nen Akzent.",
              er: "Er spricht gerade mit seinem Chef.",
              sie_fem: "Sie spricht drei Sprachen perfekt.",
              es: "Es spricht f√ºr seine Qualit√§t, dass es so lange h√§lt.",
              wir: "Wir sprechen √ºber unsere Zukunftspl√§ne.",
              ihr: "Ihr sprecht immer so schnell miteinander.",
              sie_plural: "Sie sprechen alle sehr leise im Theater.",
            },
            negative: {
              ich: "Ich spreche nicht gerne vor vielen Menschen.",
              du: "Du sprichst nicht deutlich genug.",
              Sie_formal: "Sie sprechen nicht zu schnell, das ist perfekt.",
              er: "Er spricht nicht √ºber seine Probleme.",
              sie_fem: "Sie spricht nicht viel, aber sie h√∂rt gut zu.",
              es: "Es spricht nicht gegen ihn, dass er Fehler macht.",
              wir: "Wir sprechen nicht √ºber private Dinge.",
              ihr: "Ihr sprecht nicht laut genug f√ºr alle.",
              sie_plural: "Sie sprechen nicht dieselbe Sprache wie wir.",
            },
            question: {
              ich: "Spreche ich zu schnell f√ºr Sie?",
              du: "Sprichst du auch Italienisch?",
              Sie_formal: "Sprechen Sie regelm√§√üig mit Ihren Eltern?",
              er: "Spricht er immer noch mit seiner Ex-Freundin?",
              sie_fem: "Spricht sie auch Spanisch?",
              es: "Spricht es gegen uns, dass wir zu sp√§t sind?",
              wir: "Sprechen wir √ºber das richtige Thema?",
              ihr: "Sprecht ihr oft √ºber eure Tr√§ume?",
              sie_plural: "Sprechen sie miteinander oder mit uns?",
            },
          },
          translations: {
            statement: {
              ich: "T√¥i n√≥i ti·∫øng ƒê·ª©c v√† ti·∫øng Anh l∆∞u lo√°t.",
              du: "B·∫°n n√≥i ti·∫øng Ph√°p r·∫•t t·ªët.",
              Sie_formal: "Anh/ch·ªã n√≥i v·ªõi gi·ªçng ƒëi·ªáu r·∫•t hay.",
              er: "Anh ·∫•y ƒëang n√≥i chuy·ªán v·ªõi s·∫øp.",
              sie_fem: "C√¥ ·∫•y n√≥i ba th·ª© ti·∫øng ho√†n h·∫£o.",
              es: "ƒêi·ªÅu ƒë√≥ ch·ª©ng t·ªè ch·∫•t l∆∞·ª£ng khi n√≥ b·ªÅn l√¢u nh∆∞ v·∫≠y.",
              wir: "Ch√∫ng t√¥i n√≥i v·ªÅ k·∫ø ho·∫°ch t∆∞∆°ng lai.",
              ihr: "C√°c b·∫°n lu√¥n n√≥i chuy·ªán nhanh v·ªõi nhau.",
              sie_plural: "H·ªç ƒë·ªÅu n√≥i r·∫•t nh·ªè trong r·∫°p h√°t.",
            },
            negative: {
              ich: "T√¥i kh√¥ng th√≠ch n√≥i tr∆∞·ªõc ƒë√°m ƒë√¥ng.",
              du: "B·∫°n n√≥i kh√¥ng ƒë·ªß r√µ r√†ng.",
              Sie_formal: "Anh/ch·ªã kh√¥ng n√≥i qu√° nhanh, ƒëi·ªÅu ƒë√≥ ho√†n h·∫£o.",
              er: "Anh ·∫•y kh√¥ng n√≥i v·ªÅ v·∫•n ƒë·ªÅ c·ªßa m√¨nh.",
              sie_fem: "C√¥ ·∫•y kh√¥ng n√≥i nhi·ªÅu, nh∆∞ng c√¥ ·∫•y nghe t·ªët.",
              es: "ƒêi·ªÅu ƒë√≥ kh√¥ng c√≥ g√¨ b·∫•t l·ª£i cho anh ·∫•y khi m·∫Øc l·ªói.",
              wir: "Ch√∫ng t√¥i kh√¥ng n√≥i v·ªÅ chuy·ªán ri√™ng t∆∞.",
              ihr: "C√°c b·∫°n n√≥i kh√¥ng ƒë·ªß to cho m·ªçi ng∆∞·ªùi nghe.",
              sie_plural: "H·ªç kh√¥ng n√≥i c√πng ng√¥n ng·ªØ v·ªõi ch√∫ng ta.",
            },
            question: {
              ich: "T√¥i c√≥ n√≥i qu√° nhanh cho anh/ch·ªã kh√¥ng?",
              du: "B·∫°n c√≥ n√≥i ti·∫øng √ù kh√¥ng?",
              Sie_formal: "Anh/ch·ªã c√≥ th∆∞·ªùng xuy√™n n√≥i chuy·ªán v·ªõi b·ªë m·∫π kh√¥ng?",
              er: "Anh ·∫•y c√≥ c√≤n n√≥i chuy·ªán v·ªõi b·∫°n g√°i c≈© kh√¥ng?",
              sie_fem: "C√¥ ·∫•y c√≥ n√≥i ti·∫øng T√¢y Ban Nha kh√¥ng?",
              es: "C√≥ b·∫•t l·ª£i cho ch√∫ng ta khi ƒë·∫øn mu·ªôn kh√¥ng?",
              wir: "Ch√∫ng ta c√≥ ƒëang n√≥i ƒë√∫ng ch·ªß ƒë·ªÅ kh√¥ng?",
              ihr: "C√°c b·∫°n c√≥ th∆∞·ªùng n√≥i v·ªÅ ∆∞·ªõc m∆° kh√¥ng?",
              sie_plural: "H·ªç n√≥i chuy·ªán v·ªõi nhau hay v·ªõi ch√∫ng ta?",
            },
          },
        },
      };

      // Game state
      let currentGameMode = "";
      let currentQuestionIndex = 0;
      let currentWord = null;
      let currentConjugation = null;
      let currentSentenceType = "statement";
      let questionsData = [];
      let totalQuestions = 185;
      let isAnswered = false;

      // Game progress for each mode (separate tracking)
      let gameProgress = {
        listening: {
          correctAnswers: 0,
          wrongAnswers: 0,
          score: 0,
          currentIndex: 0,
          questionsData: [],
        },
        speaking: {
          correctAnswers: 0,
          wrongAnswers: 0,
          score: 0,
          currentIndex: 0,
          questionsData: [],
        },
        reading: {
          correctAnswers: 0,
          wrongAnswers: 0,
          score: 0,
          currentIndex: 0,
          questionsData: [],
        },
        writing: {
          correctAnswers: 0,
          wrongAnswers: 0,
          score: 0,
          currentIndex: 0,
          questionsData: [],
        },
        conjugation: {
          correctAnswers: 0,
          wrongAnswers: 0,
          score: 0,
          currentIndex: 0,
          questionsData: [],
        },
      };

      // Speech recognition variables
      let recognition = null;
      let isRecording = false;

      // Audio context for sound effects
      let audioContext = null;
      let gainNode = null;

      // Initialize audio context
      function initializeAudio() {
        try {
          audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
          gainNode = audioContext.createGain();
          gainNode.connect(audioContext.destination);
        } catch (error) {
          console.log("Audio context not supported");
        }
      }

      // Play sound effect
      function playSound(frequency, duration, type = "sine") {
        if (!audioContext) return;

        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        oscillator.frequency.value = frequency;
        oscillator.type = type;

        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(
          0.01,
          audioContext.currentTime + duration
        );

        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + duration);
      }

      // Play success sound
      function playSuccessSound() {
        playSound(523.25, 0.2); // C5
        setTimeout(() => playSound(659.25, 0.2), 100); // E5
        setTimeout(() => playSound(783.99, 0.3), 200); // G5
      }

      // Play error sound
      function playErrorSound() {
        playSound(220, 0.3, "sawtooth");
      }

      // Play click sound
      function playClickSound() {
        playSound(800, 0.1);
      }

      // Initialize speech recognition
      function initializeSpeechRecognition() {
        if (
          "webkitSpeechRecognition" in window ||
          "SpeechRecognition" in window
        ) {
          const SpeechRecognition =
            window.SpeechRecognition || window.webkitSpeechRecognition;
          recognition = new SpeechRecognition();
          recognition.lang = "de-DE";
          recognition.continuous = false;
          recognition.interimResults = false;

          recognition.onstart = function () {
            isRecording = true;
            document.getElementById("micButton").classList.add("recording");
            document.getElementById("recognitionStatus").textContent =
              "ƒêang nghe... H√£y ph√°t √¢m t·ª´ ti·∫øng ƒê·ª©c";
            animateAudioVisualizer();
          };

          recognition.onresult = function (event) {
            const transcript = event.results[0][0].transcript.toLowerCase();
            const targetWord = currentWord.german.toLowerCase();
            const progress = gameProgress[currentGameMode];

            document.getElementById(
              "recognitionStatus"
            ).textContent = `B·∫°n ƒë√£ n√≥i: "${transcript}"`;

            // Simple pronunciation check
            const similarity = calculateSimilarity(transcript, targetWord);
            const feedback = document.getElementById("pronunciationFeedback");
            feedback.style.display = "block";

            if (similarity > 0.7) {
              feedback.innerHTML = "üéâ Xu·∫•t s·∫Øc! Ph√°t √¢m r·∫•t t·ªët!";
              feedback.style.background = "#d4edda";
              feedback.style.color = "#155724";
              progress.correctAnswers++;
              progress.score += 10;
              playSuccessSound();
            } else if (similarity > 0.4) {
              feedback.innerHTML = "üëç T·ªët! H√£y th·ª≠ l·∫ßn n·ªØa ƒë·ªÉ ho√†n thi·ªán h∆°n.";
              feedback.style.background = "#fff3cd";
              feedback.style.color = "#856404";
              progress.score += 5;
              playClickSound();
            } else {
              feedback.innerHTML =
                "üí™ C·∫ßn luy·ªán t·∫≠p th√™m. H√£y nghe v√† th·ª≠ l·∫°i!";
              feedback.style.background = "#f8d7da";
              feedback.style.color = "#721c24";
              progress.wrongAnswers++;
              playErrorSound();
            }

            updateScore();
            showNextButton();
            stopAudioVisualizer();
          };

          recognition.onerror = function (event) {
            document.getElementById("recognitionStatus").textContent =
              "L·ªói nh·∫≠n di·ªán gi·ªçng n√≥i. Vui l√≤ng th·ª≠ l·∫°i.";
            stopAudioVisualizer();
            playErrorSound();
          };

          recognition.onend = function () {
            isRecording = false;
            document.getElementById("micButton").classList.remove("recording");
            stopAudioVisualizer();
          };
        }
      }

      // Animate audio visualizer
      function animateAudioVisualizer() {
        const bars = document.querySelectorAll(".audio-bar");
        const animateBar = () => {
          bars.forEach((bar) => {
            const height = Math.random() * 30 + 5;
            bar.style.height = height + "px";
          });
          if (isRecording) {
            setTimeout(animateBar, 100);
          }
        };
        animateBar();
      }

      // Stop audio visualizer
      function stopAudioVisualizer() {
        const bars = document.querySelectorAll(".audio-bar");
        bars.forEach((bar) => {
          bar.style.height = "5px";
        });
      }

      // Calculate similarity between two strings
      function calculateSimilarity(str1, str2) {
        const longer = str1.length > str2.length ? str1 : str2;
        const shorter = str1.length > str2.length ? str2 : str1;
        const editDistance = getEditDistance(longer, shorter);
        return (longer.length - editDistance) / longer.length;
      }

      // Calculate edit distance
      function getEditDistance(str1, str2) {
        const matrix = [];
        for (let i = 0; i <= str2.length; i++) {
          matrix[i] = [i];
        }
        for (let j = 0; j <= str1.length; j++) {
          matrix[0][j] = j;
        }
        for (let i = 1; i <= str2.length; i++) {
          for (let j = 1; j <= str1.length; j++) {
            if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
              matrix[i][j] = matrix[i - 1][j - 1];
            } else {
              matrix[i][j] = Math.min(
                matrix[i - 1][j - 1] + 1,
                matrix[i][j - 1] + 1,
                matrix[i - 1][j] + 1
              );
            }
          }
        }
        return matrix[str2.length][str1.length];
      }

      // Text-to-Speech function
      function speakWord(text) {
        if ("speechSynthesis" in window) {
          speechSynthesis.cancel();
          const utterance = new SpeechSynthesisUtterance(text);
          const voices = speechSynthesis.getVoices();
          const germanVoice = voices.find(
            (voice) =>
              voice.lang.includes("de") ||
              voice.name.toLowerCase().includes("german") ||
              voice.name.toLowerCase().includes("deutsch")
          );

          if (germanVoice) {
            utterance.voice = germanVoice;
          }

          utterance.lang = "de-DE";
          utterance.rate = 0.8;
          utterance.pitch = 1;
          utterance.volume = 1;

          speechSynthesis.speak(utterance);
          playClickSound();
        }
      }

      // Speak sentence
      function speakSentence() {
        const germanSentence =
          document.getElementById("germanSentence").textContent;
        if (germanSentence) {
          speakWord(germanSentence);
        }
      }

      // Speak conjugation sentence for conjugation mode
      function speakConjugationSentence() {
        if (currentConjugation) {
          const sentence = buildCorrectSentence(
            currentConjugation.verb,
            currentConjugation.pronounKey,
            currentSentenceType
          );
          speakWord(sentence);
        }
      }

      // Generate conjugation questions
      function generateConjugationQuestions() {
        const questions = [];
        const verbs = Object.keys(verbConjugations);
        const pronounKeys = [
          "ich",
          "du",
          "Sie_formal",
          "er",
          "sie_fem",
          "es",
          "wir",
          "ihr",
          "sie_plural",
        ];
        const sentenceTypes = ["statement", "negative", "question"];

        // Generate questions for each verb, pronoun, and sentence type combination
        verbs.forEach((verb) => {
          pronounKeys.forEach((pronounKey) => {
            sentenceTypes.forEach((sentenceType) => {
              const pronoun = getPronounDisplay(pronounKey);
              const correctAnswer = buildCorrectSentence(
                verb,
                pronounKey,
                sentenceType
              );

              questions.push({
                verb: verb,
                pronoun: pronoun,
                pronounKey: pronounKey,
                sentenceType: sentenceType,
                correctAnswer: correctAnswer,
                verbData: verbConjugations[verb],
              });
            });
          });
        });

        return questions.sort(() => 0.5 - Math.random());
      }

      // Build correct sentence based on verb, pronoun, and sentence type
      function buildCorrectSentence(verb, pronounKey, sentenceType) {
        const verbData = verbConjugations[verb];
        if (
          verbData.sentences &&
          verbData.sentences[sentenceType] &&
          verbData.sentences[sentenceType][pronounKey]
        ) {
          return verbData.sentences[sentenceType][pronounKey];
        }

        // Fallback to basic conjugation
        const pronoun = getPronounDisplay(pronounKey);
        const conjugatedVerb = verbData.conjugations[pronounKey];

        switch (sentenceType) {
          case "statement":
            return `${pronoun} ${conjugatedVerb}.`;
          case "negative":
            return `${pronoun} ${conjugatedVerb} nicht.`;
          case "question":
            return `${
              conjugatedVerb.charAt(0).toUpperCase() + conjugatedVerb.slice(1)
            } ${pronoun.toLowerCase()}?`;
          default:
            return `${pronoun} ${conjugatedVerb}.`;
        }
      }

      // Get pronoun display text
      function getPronounDisplay(pronounKey) {
        const pronounMap = {
          ich: "ich",
          du: "du",
          Sie_formal: "Sie",
          er: "er",
          sie_fem: "sie",
          es: "es",
          wir: "wir",
          ihr: "ihr",
          sie_plural: "sie",
        };
        return pronounMap[pronounKey] || pronounKey;
      }

      // Get Vietnamese translation for sentence
      function getVietnameseTranslation(verb, pronounKey, sentenceType) {
        const verbData = verbConjugations[verb];
        if (
          verbData.translations &&
          verbData.translations[sentenceType] &&
          verbData.translations[sentenceType][pronounKey]
        ) {
          return verbData.translations[sentenceType][pronounKey];
        }
        return "Ch∆∞a c√≥ b·∫£n d·ªãch";
      }

      // Setup sentence type selector
      function setupSentenceTypeSelector() {
        const buttons = document.querySelectorAll(".sentence-type-btn");
        buttons.forEach((button) => {
          button.addEventListener("click", () => {
            // Remove active class from all buttons
            buttons.forEach((btn) => btn.classList.remove("active"));

            // Add active class to clicked button
            button.classList.add("active");

            // Update current sentence type
            currentSentenceType = button.dataset.type;

            // Update preview and translation
            updateSentencePreview();
            updateTranslationHelp();

            playClickSound();
          });
        });
      }

      // Update sentence preview
      function updateSentencePreview() {
        if (!currentConjugation) return;

        const previewText = document.getElementById("previewText");
        const exampleSentence = buildCorrectSentence(
          currentConjugation.verb,
          currentConjugation.pronounKey,
          currentSentenceType
        );

        previewText.textContent = exampleSentence;
      }

      // Update translation help
      function updateTranslationHelp() {
        if (!currentConjugation) return;

        const translationContent =
          document.getElementById("translationContent");
        const germanSentence = buildCorrectSentence(
          currentConjugation.verb,
          currentConjugation.pronounKey,
          currentSentenceType
        );
        const vietnameseSentence = getVietnameseTranslation(
          currentConjugation.verb,
          currentConjugation.pronounKey,
          currentSentenceType
        );

        translationContent.innerHTML = `
          <div class="translation-item">
            <span class="german-text">${germanSentence}</span>
            <span class="vietnamese-text">${vietnameseSentence}</span>
          </div>
          <button class="btn btn-conjugation" style="margin-top: 10px; font-size: 0.9em" onclick="speakConjugationSentence()">
            üîä Nghe c√¢u v√≠ d·ª•
          </button>
        `;
      }

      // Display conjugation table with highlighting
      function displayConjugationTableWithHighlight(
        verbData,
        currentPronounKey
      ) {
        const table = document.getElementById("conjugationTable");
        table.innerHTML = "";

        const pronounKeys = [
          "ich",
          "du",
          "Sie_formal",
          "er",
          "sie_fem",
          "es",
          "wir",
          "ihr",
          "sie_plural",
        ];
        const pronounDisplays = [
          "ich",
          "du",
          "Sie",
          "er",
          "sie",
          "es",
          "wir",
          "ihr",
          "sie",
        ];

        pronounKeys.forEach((key, index) => {
          const row = document.createElement("div");
          row.className = "conjugation-row";

          // Highlight current pronoun
          if (key === currentPronounKey) {
            row.style.background = "#ffebee";
            row.style.border = "2px solid #ff6b6b";
            row.style.fontWeight = "bold";
          }

          const pronounSpan = document.createElement("span");
          pronounSpan.className = "pronoun-small";
          pronounSpan.textContent = pronounDisplays[index];

          const verbSpan = document.createElement("span");
          verbSpan.className = "verb-form";
          verbSpan.textContent = verbData.conjugations[key];

          row.appendChild(pronounSpan);
          row.appendChild(verbSpan);
          table.appendChild(row);
        });
      }

      // Get conjugation tips for memorization
      function getConjugationTip(verb, pronounKey) {
        const tips = {
          sein: {
            ich: "üë§ 'ich bin' - T√¥i l√†. Nh·ªõ: 'ich BIN' (bin = th√πng r√°c ti·∫øng Anh)",
            du: "üë• 'du bist' - B·∫°n l√†. Nh·ªõ: 'du BIST' (bist gi·ªëng 'best')",
            Sie_formal:
              "ü§ù 'Sie sind' - Anh/ch·ªã l√†. Nh·ªõ: 'Sie SIND' (l·ªãch s·ª± = s·ªë nhi·ªÅu)",
            er: "üë® 'er ist' - Anh ·∫•y l√†. Nh·ªõ: 'er IST' (ist = is trong ti·∫øng Anh)",
            sie_fem: "üë© 'sie ist' - C√¥ ·∫•y l√†. Nh·ªõ: 'sie IST' (gi·ªëng 'er ist')",
            es: "üì¶ 'es ist' - N√≥ l√†. Nh·ªõ: 'es IST' (v·∫≠t = 'ist')",
            wir: "üë´ 'wir sind' - Ch√∫ng t√¥i l√†. Nh·ªõ: 'wir SIND' (we = sind)",
            ihr: "üë• 'ihr seid' - C√°c b·∫°n l√†. Nh·ªõ: 'ihr SEID' (duy nh·∫•t c√≥ 'seid')",
            sie_plural: "üë• 'sie sind' - H·ªç l√†. Nh·ªõ: 'sie SIND' (they = sind)",
          },
          kommen: {
            ich: "üë§ 'ich komme' - T√¥i ƒë·∫øn. Nh·ªõ: 'ich KOMME' (th√™m 'e' v√†o cu·ªëi)",
            du: "üë• 'du kommst' - B·∫°n ƒë·∫øn. Nh·ªõ: 'du KOMMST' (th√™m 'st')",
            Sie_formal:
              "ü§ù 'Sie kommen' - Anh/ch·ªã ƒë·∫øn. Nh·ªõ: 'Sie KOMMEN' (gi·ªëng nguy√™n th·ªÉ)",
            er: "üë® 'er kommt' - Anh ·∫•y ƒë·∫øn. Nh·ªõ: 'er KOMMT' (th√™m 't')",
            sie_fem:
              "üë© 'sie kommt' - C√¥ ·∫•y ƒë·∫øn. Nh·ªõ: 'sie KOMMT' (gi·ªëng 'er')",
            es: "üì¶ 'es kommt' - N√≥ ƒë·∫øn. Nh·ªõ: 'es KOMMT' (v·∫≠t = 't')",
            wir: "üë´ 'wir kommen' - Ch√∫ng t√¥i ƒë·∫øn. Nh·ªõ: 'wir KOMMEN' (gi·ªëng nguy√™n th·ªÉ)",
            ihr: "üë• 'ihr kommt' - C√°c b·∫°n ƒë·∫øn. Nh·ªõ: 'ihr KOMMT' (gi·ªëng ng√¥i 3 s·ªë √≠t)",
            sie_plural:
              "üë• 'sie kommen' - H·ªç ƒë·∫øn. Nh·ªõ: 'sie KOMMEN' (gi·ªëng nguy√™n th·ªÉ)",
          },
          hei√üen: {
            ich: "üë§ 'ich hei√üe' - T√¥i t√™n l√†. Nh·ªõ: 'ich HEI√üE' (√ü = ss, th√™m 'e')",
            du: "üë• 'du hei√üt' - B·∫°n t√™n l√†. Nh·ªõ: 'du HEI√üT' (√ü = ss, th√™m 't')",
            Sie_formal:
              "ü§ù 'Sie hei√üen' - Anh/ch·ªã t√™n l√†. Nh·ªõ: 'Sie HEI√üEN' (gi·ªëng nguy√™n th·ªÉ)",
            er: "üë® 'er hei√üt' - Anh ·∫•y t√™n l√†. Nh·ªõ: 'er HEI√üT' (√ü = ss, th√™m 't')",
            sie_fem:
              "üë© 'sie hei√üt' - C√¥ ·∫•y t√™n l√†. Nh·ªõ: 'sie HEI√üT' (gi·ªëng 'er')",
            es: "üì¶ 'es hei√üt' - N√≥ t√™n l√†. Nh·ªõ: 'es HEI√üT' (v·∫≠t = 't')",
            wir: "üë´ 'wir hei√üen' - Ch√∫ng t√¥i t√™n l√†. Nh·ªõ: 'wir HEI√üEN' (gi·ªëng nguy√™n th·ªÉ)",
            ihr: "üë• 'ihr hei√üt' - C√°c b·∫°n t√™n l√†. Nh·ªõ: 'ihr HEI√üT' (gi·ªëng ng√¥i 3 s·ªë √≠t)",
            sie_plural:
              "üë• 'sie hei√üen' - H·ªç t√™n l√†. Nh·ªõ: 'sie HEI√üEN' (gi·ªëng nguy√™n th·ªÉ)",
          },
          sprechen: {
            ich: "üë§ 'ich spreche' - T√¥i n√≥i. Nh·ªõ: 'ich SPRECHE' (th√™m 'e' v√†o cu·ªëi)",
            du: "üë• 'du sprichst' - B·∫°n n√≥i. Nh·ªõ: 'du SPRICHST' (e‚Üíi, th√™m 'st')",
            Sie_formal:
              "ü§ù 'Sie sprechen' - Anh/ch·ªã n√≥i. Nh·ªõ: 'Sie SPRECHEN' (gi·ªëng nguy√™n th·ªÉ)",
            er: "üë® 'er spricht' - Anh ·∫•y n√≥i. Nh·ªõ: 'er SPRICHT' (e‚Üíi, th√™m 't')",
            sie_fem:
              "üë© 'sie spricht' - C√¥ ·∫•y n√≥i. Nh·ªõ: 'sie SPRICHT' (gi·ªëng 'er')",
            es: "üì¶ 'es spricht' - N√≥ n√≥i. Nh·ªõ: 'es SPRICHT' (v·∫≠t = 't')",
            wir: "üë´ 'wir sprechen' - Ch√∫ng t√¥i n√≥i. Nh·ªõ: 'wir SPRECHEN' (gi·ªëng nguy√™n th·ªÉ)",
            ihr: "üë• 'ihr sprecht' - C√°c b·∫°n n√≥i. Nh·ªõ: 'ihr SPRECHT' (b·ªè 'en', th√™m 't')",
            sie_plural:
              "üë• 'sie sprechen' - H·ªç n√≥i. Nh·ªõ: 'sie SPRECHEN' (gi·ªëng nguy√™n th·ªÉ)",
          },
        };

        return (
          tips[verb]?.[pronounKey] ||
          "H√£y quan s√°t b·∫£ng chia ƒë·ªông t·ª´ ƒë·ªÉ h·ªçc thu·ªôc!"
        );
      }

      // Get conjugation rules
      function getConjugationRule(verb, pronounKey) {
        const rules = {
          sein: {
            ich: "üîπ Ng√¥i 1 s·ªë √≠t: 'ich' + 'bin' (b·∫•t quy t·∫Øc - ph·∫£i h·ªçc thu·ªôc)",
            du: "üîπ Ng√¥i 2 s·ªë √≠t: 'du' + 'bist' (b·∫•t quy t·∫Øc - ph·∫£i h·ªçc thu·ªôc)",
            Sie_formal: "üîπ Ng√¥i 2 l·ªãch s·ª±: 'Sie' + 'sind' (gi·ªëng s·ªë nhi·ªÅu)",
            er: "üîπ Ng√¥i 3 s·ªë √≠t nam: 'er' + 'ist' (b·∫•t quy t·∫Øc - ph·∫£i h·ªçc thu·ªôc)",
            sie_fem: "üîπ Ng√¥i 3 s·ªë √≠t n·ªØ: 'sie' + 'ist' (gi·ªëng 'er ist')",
            es: "üîπ Ng√¥i 3 s·ªë √≠t trung: 'es' + 'ist' (gi·ªëng 'er ist')",
            wir: "üîπ Ng√¥i 1 s·ªë nhi·ªÅu: 'wir' + 'sind' (gi·ªëng Sie)",
            ihr: "üîπ Ng√¥i 2 s·ªë nhi·ªÅu: 'ihr' + 'seid' (duy nh·∫•t c√≥ 'seid')",
            sie_plural: "üîπ Ng√¥i 3 s·ªë nhi·ªÅu: 'sie' + 'sind' (gi·ªëng wir, Sie)",
          },
          kommen: {
            ich: "üîπ Ng√¥i 1 s·ªë √≠t: G·ªëc 'komm' + 'e' = 'komme'",
            du: "üîπ Ng√¥i 2 s·ªë √≠t: G·ªëc 'komm' + 'st' = 'kommst'",
            Sie_formal: "üîπ Ng√¥i 2 l·ªãch s·ª±: Gi·ªëng nguy√™n th·ªÉ 'kommen'",
            er: "üîπ Ng√¥i 3 s·ªë √≠t nam: G·ªëc 'komm' + 't' = 'kommt'",
            sie_fem: "üîπ Ng√¥i 3 s·ªë √≠t n·ªØ: Gi·ªëng 'er kommt'",
            es: "üîπ Ng√¥i 3 s·ªë √≠t trung: Gi·ªëng 'er kommt'",
            wir: "üîπ Ng√¥i 1 s·ªë nhi·ªÅu: Gi·ªëng nguy√™n th·ªÉ 'kommen'",
            ihr: "üîπ Ng√¥i 2 s·ªë nhi·ªÅu: G·ªëc 'komm' + 't' = 'kommt'",
            sie_plural: "üîπ Ng√¥i 3 s·ªë nhi·ªÅu: Gi·ªëng nguy√™n th·ªÉ 'kommen'",
          },
          hei√üen: {
            ich: "üîπ Ng√¥i 1 s·ªë √≠t: G·ªëc 'hei√ü' + 'e' = 'hei√üe'",
            du: "üîπ Ng√¥i 2 s·ªë √≠t: G·ªëc 'hei√ü' + 't' = 'hei√üt'",
            Sie_formal: "üîπ Ng√¥i 2 l·ªãch s·ª±: Gi·ªëng nguy√™n th·ªÉ 'hei√üen'",
            er: "üîπ Ng√¥i 3 s·ªë √≠t nam: G·ªëc 'hei√ü' + 't' = 'hei√üt'",
            sie_fem: "üîπ Ng√¥i 3 s·ªë √≠t n·ªØ: Gi·ªëng 'er hei√üt'",
            es: "üîπ Ng√¥i 3 s·ªë √≠t trung: Gi·ªëng 'er hei√üt'",
            wir: "üîπ Ng√¥i 1 s·ªë nhi·ªÅu: Gi·ªëng nguy√™n th·ªÉ 'hei√üen'",
            ihr: "üîπ Ng√¥i 2 s·ªë nhi·ªÅu: G·ªëc 'hei√ü' + 't' = 'hei√üt'",
            sie_plural: "üîπ Ng√¥i 3 s·ªë nhi·ªÅu: Gi·ªëng nguy√™n th·ªÉ 'hei√üen'",
          },
          sprechen: {
            ich: "üîπ Ng√¥i 1 s·ªë √≠t: G·ªëc 'sprech' + 'e' = 'spreche'",
            du: "üîπ Ng√¥i 2 s·ªë √≠t: 'sprech' ‚Üí 'sprich' + 'st' = 'sprichst' (e‚Üíi)",
            Sie_formal: "üîπ Ng√¥i 2 l·ªãch s·ª±: Gi·ªëng nguy√™n th·ªÉ 'sprechen'",
            er: "üîπ Ng√¥i 3 s·ªë √≠t nam: 'sprech' ‚Üí 'sprich' + 't' = 'spricht' (e‚Üíi)",
            sie_fem: "üîπ Ng√¥i 3 s·ªë √≠t n·ªØ: Gi·ªëng 'er spricht'",
            es: "üîπ Ng√¥i 3 s·ªë √≠t trung: Gi·ªëng 'er spricht'",
            wir: "üîπ Ng√¥i 1 s·ªë nhi·ªÅu: Gi·ªëng nguy√™n th·ªÉ 'sprechen'",
            ihr: "üîπ Ng√¥i 2 s·ªë nhi·ªÅu: G·ªëc 'sprech' + 't' = 'sprecht'",
            sie_plural: "üîπ Ng√¥i 3 s·ªë nhi·ªÅu: Gi·ªëng nguy√™n th·ªÉ 'sprechen'",
          },
        };

        return (
          rules[verb]?.[pronounKey] || "√Åp d·ª•ng quy t·∫Øc chia ƒë·ªông t·ª´ c∆° b·∫£n."
        );
      }

      // Initialize game
      function startGame(mode) {
        currentGameMode = mode;

        // Get current progress for this mode
        const progress = gameProgress[mode];
        currentQuestionIndex = progress.currentIndex;

        // Generate questions based on mode
        if (mode === "conjugation") {
          if (
            progress.questionsData.length === 0 ||
            currentQuestionIndex >= progress.questionsData.length
          ) {
            progress.questionsData = generateConjugationQuestions();
            progress.currentIndex = 0;
            currentQuestionIndex = 0;
          }
          questionsData = progress.questionsData;
          totalQuestions = questionsData.length;
        } else {
          // Regular vocabulary questions
          if (
            progress.questionsData.length === 0 ||
            currentQuestionIndex >= progress.questionsData.length
          ) {
            progress.questionsData = generateQuestions();
            progress.currentIndex = 0;
            currentQuestionIndex = 0;
          }
          questionsData = progress.questionsData;
          totalQuestions = questionsData.length;
        }

        isAnswered = false;

        // Show game area
        document.getElementById("mainMenu").style.display = "none";
        document.getElementById("gameArea").style.display = "block";
        document.getElementById("results").style.display = "none";
        document.getElementById("backButton").classList.add("show");

        // Set game styles for conjugation mode
        const gameHeader = document.getElementById("gameHeader");
        const gameTitle = document.getElementById("gameTitle");
        const questionArea = document.getElementById("questionArea");
        const progressFill = document.getElementById("progressFill");

        if (mode === "conjugation") {
          gameHeader.classList.add("conjugation");
          gameTitle.classList.add("conjugation");
          questionArea.classList.add("conjugation");
          progressFill.classList.add("conjugation");
        } else {
          gameHeader.classList.remove("conjugation");
          gameTitle.classList.remove("conjugation");
          questionArea.classList.remove("conjugation");
          progressFill.classList.remove("conjugation");
        }

        // Set game title
        const titles = {
          listening: "üëÇ Luy·ªán Nghe",
          speaking: "üó£Ô∏è Luy·ªán N√≥i",
          reading: "üëÅÔ∏è Luy·ªán ƒê·ªçc",
          writing: "‚úçÔ∏è Luy·ªán Vi·∫øt",
          conjugation: "üìù Chia ƒê·ªông T·ª´",
        };
        gameTitle.textContent = titles[mode];

        // Initialize speech recognition for speaking mode
        if (mode === "speaking") {
          initializeSpeechRecognition();
        }

        // Initialize audio context
        initializeAudio();

        // Setup sentence type selector for conjugation mode
        if (mode === "conjugation") {
          setupSentenceTypeSelector();
        }

        // Update score display
        updateScore();

        // Load current question
        loadQuestion();
      }

      // Generate random questions for vocabulary modes
      function generateQuestions() {
        const shuffled = [...vocabulary].sort(() => 0.5 - Math.random());
        return shuffled;
      }

      // Load current question
      function loadQuestion() {
        if (currentQuestionIndex >= questionsData.length) {
          showResults();
          return;
        }

        if (currentGameMode === "conjugation") {
          currentConjugation = questionsData[currentQuestionIndex];
        } else {
          currentWord = questionsData[currentQuestionIndex];
        }

        isAnswered = false;

        // Update progress
        document.getElementById("currentQuestion").textContent =
          currentQuestionIndex + 1;
        document.getElementById("totalQuestions").textContent =
          questionsData.length;
        document.getElementById("remainingCount").textContent =
          questionsData.length - currentQuestionIndex;
        const progress = (currentQuestionIndex / questionsData.length) * 100;
        document.getElementById("progressFill").style.width = progress + "%";

        // Hide feedback and next button
        document.getElementById("feedback").style.display = "none";
        document.getElementById("nextButton").style.display = "none";
        document.getElementById("exampleSentence").style.display = "none";

        // Setup question based on game mode
        setupQuestionByMode();
      }

      // Setup question based on game mode
      function setupQuestionByMode() {
        const questionEl = document.getElementById("question");
        const germanWordEl = document.getElementById("germanWord");
        const optionsEl = document.getElementById("options");
        const speechAreaEl = document.getElementById("speechArea");
        const inputAreaEl = document.getElementById("inputArea");
        const conjugationDisplayEl =
          document.getElementById("conjugationDisplay");
        const sentenceTypeSelectorEl = document.getElementById(
          "sentenceTypeSelector"
        );
        const translationHelpEl = document.getElementById("translationHelp");
        const playButtonEl = document.getElementById("playButton");
        const submitButtonEl = document.getElementById("submitButton");

        // Reset all areas
        germanWordEl.style.display = "none";
        speechAreaEl.style.display = "none";
        inputAreaEl.style.display = "none";
        conjugationDisplayEl.style.display = "none";
        sentenceTypeSelectorEl.style.display = "none";
        translationHelpEl.style.display = "none";
        optionsEl.style.display = "grid";
        playButtonEl.style.display = "inline-flex";
        submitButtonEl.style.display = "none";

        // Remove conjugation classes from elements
        const textInput = document.getElementById("textInput");
        textInput.classList.remove("conjugation");
        optionsEl.querySelectorAll(".option").forEach((option) => {
          option.classList.remove("conjugation");
        });

        // Add conjugation class to audio bars if needed
        const audioBars = document.querySelectorAll(".audio-bar");
        audioBars.forEach((bar) => {
          if (currentGameMode === "conjugation") {
            bar.classList.add("conjugation");
          } else {
            bar.classList.remove("conjugation");
          }
        });

        switch (currentGameMode) {
          case "listening":
            questionEl.textContent = "Nghe t·ª´ v·ª±ng v√† ch·ªçn nghƒ©a ƒë√∫ng:";
            germanWordEl.style.display = "block";
            germanWordEl.textContent = "üîä Nh·∫•n ƒë·ªÉ nghe";
            generateOptions();
            setTimeout(() => speakWord(currentWord.german), 500);
            break;

          case "speaking":
            questionEl.textContent = "Ph√°t √¢m t·ª´ ti·∫øng ƒê·ª©c sau:";
            speechAreaEl.style.display = "block";
            optionsEl.style.display = "none";
            playButtonEl.style.display = "none";
            document.getElementById("speakingWord").textContent =
              currentWord.german;
            document.getElementById("recognitionStatus").textContent =
              "Nh·∫•n v√†o micro ƒë·ªÉ b·∫Øt ƒë·∫ßu";
            document.getElementById("pronunciationFeedback").style.display =
              "none";
            break;

          case "reading":
            questionEl.textContent =
              "ƒê·ªçc t·ª´ v·ª±ng ti·∫øng ƒê·ª©c v√† ch·ªçn nghƒ©a ƒë√∫ng:";
            germanWordEl.style.display = "block";
            germanWordEl.textContent = currentWord.german;
            generateOptions();
            break;

          case "writing":
            questionEl.textContent = `G√µ t·ª´ ti·∫øng ƒê·ª©c c√≥ nghƒ©a: "${currentWord.vietnamese}"`;
            inputAreaEl.style.display = "block";
            optionsEl.style.display = "none";
            playButtonEl.style.display = "none";
            submitButtonEl.style.display = "inline-flex";

            // Setup input for writing
            const writingInput = document.getElementById("textInput");
            writingInput.value = "";
            writingInput.placeholder = `Nh·∫≠p t·ª´ ti·∫øng ƒê·ª©c c√≥ nghƒ©a "${currentWord.vietnamese}"...`;
            writingInput.focus();
            break;

          case "conjugation":
            // Reset sentence type to statement
            currentSentenceType = "statement";
            const activeBtn = document.querySelector(
              ".sentence-type-btn.active"
            );
            if (activeBtn) activeBtn.classList.remove("active");
            document
              .querySelector('.sentence-type-btn[data-type="statement"]')
              .classList.add("active");

            questionEl.innerHTML = `
              <div style="margin-bottom: 20px;">
                <h3 style="color: #ff6b6b; margin-bottom: 15px;">üìù T·∫°o c√¢u ${getSentenceTypeText(
                  currentSentenceType
                )} v·ªõi ƒë·ªông t·ª´ "${
              currentConjugation.verbData.infinitive
            }" v√† ƒë·∫°i t·ª´ "${currentConjugation.pronoun}"</h3>
                <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                  <h4 style="color: #856404; margin-bottom: 10px;">üí° M·∫πo ghi nh·ªõ:</h4>
                  <p style="color: #856404; margin: 0;">${getConjugationTip(
                    currentConjugation.verb,
                    currentConjugation.pronounKey
                  )}</p>
                </div>
                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 10px; padding: 15px;">
                  <h4 style="color: #155724; margin-bottom: 10px;">üéØ Quy t·∫Øc:</h4>
                  <p style="color: #155724; margin: 0;">${getConjugationRule(
                    currentConjugation.verb,
                    currentConjugation.pronounKey
                  )}</p>
                </div>
              </div>
            `;

            sentenceTypeSelectorEl.style.display = "block";
            conjugationDisplayEl.style.display = "block";
            translationHelpEl.style.display = "block";
            inputAreaEl.style.display = "block";
            optionsEl.style.display = "none";
            playButtonEl.style.display = "none";
            submitButtonEl.style.display = "inline-flex";

            // Display conjugation info
            document.getElementById("pronounDisplay").textContent =
              currentConjugation.pronoun;
            document.getElementById(
              "verbInfinitive"
            ).textContent = `${currentConjugation.verbData.infinitive} (${currentConjugation.verbData.vietnamese})`;

            // Display conjugation table with highlighting
            displayConjugationTableWithHighlight(
              currentConjugation.verbData,
              currentConjugation.pronounKey
            );

            // Update sentence preview and translation
            updateSentencePreview();
            updateTranslationHelp();

            // Setup input
            const conjugationInput = document.getElementById("textInput");
            conjugationInput.classList.add("conjugation");
            conjugationInput.value = "";
            conjugationInput.placeholder = `Nh·∫≠p c√¢u ${getSentenceTypeText(
              currentSentenceType
            ).toLowerCase()}...`;
            conjugationInput.focus();
            break;
        }
      }

      // Get sentence type text in Vietnamese
      function getSentenceTypeText(sentenceType) {
        const typeMap = {
          statement: "kh·∫≥ng ƒë·ªãnh",
          negative: "ph·ªß ƒë·ªãnh",
          question: "nghi v·∫•n",
        };
        return typeMap[sentenceType] || sentenceType;
      }

      // Generate options for multiple choice questions
      function generateOptions() {
        const optionsEl = document.getElementById("options");
        optionsEl.innerHTML = "";

        // Get 3 wrong answers
        const wrongAnswers = vocabulary
          .filter((word) => word.vietnamese !== currentWord.vietnamese)
          .sort(() => 0.5 - Math.random())
          .slice(0, 3);

        // Combine with correct answer and shuffle
        const allOptions = [currentWord, ...wrongAnswers].sort(
          () => 0.5 - Math.random()
        );

        allOptions.forEach((option) => {
          const optionEl = document.createElement("div");
          optionEl.className = "option";
          optionEl.textContent = option.vietnamese;
          optionEl.onclick = () =>
            selectOption(
              optionEl,
              option.vietnamese === currentWord.vietnamese
            );
          optionsEl.appendChild(optionEl);
        });
      }

      // Select option
      function selectOption(optionEl, isCorrect) {
        if (isAnswered) return;

        isAnswered = true;
        const progress = gameProgress[currentGameMode];
        const allOptions = document.querySelectorAll(".option");

        allOptions.forEach((option) => {
          option.classList.add("disabled");
          if (option.textContent === currentWord.vietnamese) {
            option.classList.add("correct");
          }
        });

        if (isCorrect) {
          optionEl.classList.add("correct");
          showFeedback(true, "üéâ Ch√≠nh x√°c! Tuy·ªát v·ªùi!");
          progress.correctAnswers++;
          progress.score += 10;
          playSuccessSound();

          // Show example sentence after correct answer
          setTimeout(() => {
            showExampleSentence();
          }, 1000);
        } else {
          optionEl.classList.add("wrong");
          showFeedback(
            false,
            `‚ùå Sai r·ªìi! ƒê√°p √°n ƒë√∫ng l√†: "${currentWord.vietnamese}"`
          );
          progress.wrongAnswers++;
          playErrorSound();

          // Show example sentence after wrong answer too
          setTimeout(() => {
            showExampleSentence();
          }, 1500);
        }

        updateScore();
        showNextButton();
      }

      // Show example sentence with improved content
      function showExampleSentence() {
        const exampleSentenceEl = document.getElementById("exampleSentence");
        const germanSentenceEl = document.getElementById("germanSentence");
        const vietnameseSentenceEl =
          document.getElementById("vietnameseSentence");

        // Get example sentence for current word
        const example = exampleSentences[currentWord.german];

        if (example) {
          germanSentenceEl.textContent = example.german;
          vietnameseSentenceEl.textContent = example.vietnamese;
        } else {
          // Create a more meaningful example based on word type and context
          const { german, vietnamese } = createContextualExample(currentWord);
          germanSentenceEl.textContent = german;
          vietnameseSentenceEl.textContent = vietnamese;
        }

        exampleSentenceEl.style.display = "block";
      }

      // Create contextual examples for words without predefined examples
      function createContextualExample(word) {
        const { german, vietnamese } = word;

        // Patterns for different types of words
        const patterns = {
          // Greetings and polite expressions
          greeting: [
            {
              de: `${german}! Wie geht es Ihnen?`,
              vi: `${vietnamese}! Anh/ch·ªã c√≥ kh·ªèe kh√¥ng?`,
            },
            {
              de: `${german}, freut mich Sie zu sehen.`,
              vi: `${vietnamese}, r·∫•t vui ƒë∆∞·ª£c g·∫∑p anh/ch·ªã.`,
            },
          ],

          // Verbs
          verb: [
            { de: `Ich m√∂chte ${german}.`, vi: `T√¥i mu·ªën ${vietnamese}.` },
            {
              de: `K√∂nnen Sie ${german}?`,
              vi: `Anh/ch·ªã c√≥ th·ªÉ ${vietnamese} kh√¥ng?`,
            },
            { de: `Wir m√ºssen ${german}.`, vi: `Ch√∫ng ta ph·∫£i ${vietnamese}.` },
          ],

          // Nouns
          noun: [
            {
              de: `Das ist mein ${german}.`,
              vi: `ƒê√¢y l√† ${vietnamese} c·ªßa t√¥i.`,
            },
            { de: `Wo ist der ${german}?`, vi: `${vietnamese} ·ªü ƒë√¢u?` },
            {
              de: `Ich brauche einen ${german}.`,
              vi: `T√¥i c·∫ßn m·ªôt ${vietnamese}.`,
            },
          ],

          // Adjectives
          adjective: [
            {
              de: `Das Wetter ist heute ${german}.`,
              vi: `Th·ªùi ti·∫øt h√¥m nay ${vietnamese}.`,
            },
            {
              de: `Mein Freund ist sehr ${german}.`,
              vi: `B·∫°n t√¥i r·∫•t ${vietnamese}.`,
            },
          ],

          // Countries and places
          place: [
            { de: `Ich komme aus ${german}.`, vi: `T√¥i ƒë·∫øn t·ª´ ${vietnamese}.` },
            {
              de: `${german} ist ein sch√∂nes Land.`,
              vi: `${vietnamese} l√† m·ªôt ƒë·∫•t n∆∞·ªõc ƒë·∫πp.`,
            },
            {
              de: `Ich m√∂chte nach ${german} reisen.`,
              vi: `T√¥i mu·ªën ƒëi du l·ªãch ${vietnamese}.`,
            },
          ],

          // Languages
          language: [
            { de: `Ich lerne ${german}.`, vi: `T√¥i h·ªçc ${vietnamese}.` },
            {
              de: `K√∂nnen Sie ${german} sprechen?`,
              vi: `Anh/ch·ªã c√≥ n√≥i ƒë∆∞·ª£c ${vietnamese} kh√¥ng?`,
            },
            {
              de: `${german} ist eine interessante Sprache.`,
              vi: `${vietnamese} l√† m·ªôt ng√¥n ng·ªØ th√∫ v·ªã.`,
            },
          ],

          // Time expressions
          time: [
            {
              de: `${german} gehe ich zur Arbeit.`,
              vi: `${vietnamese} t√¥i ƒëi l√†m.`,
            },
            {
              de: `${german} ist meine Lieblingszeit.`,
              vi: `${vietnamese} l√† th·ªùi gian y√™u th√≠ch c·ªßa t√¥i.`,
            },
          ],

          // Question words
          question: [
            { de: `${german} wohnen Sie?`, vi: `Anh/ch·ªã s·ªëng ${vietnamese}?` },
            { de: `${german} hei√üen Sie?`, vi: `Anh/ch·ªã t√™n ${vietnamese}?` },
          ],
        };

        // Determine word type and select appropriate pattern
        let selectedPattern;

        if (
          [
            "Hallo",
            "Guten Tag",
            "Guten Morgen",
            "Guten Abend",
            "Tsch√ºs",
            "danke",
            "bitte",
          ].includes(german)
        ) {
          selectedPattern =
            patterns.greeting[
              Math.floor(Math.random() * patterns.greeting.length)
            ];
        } else if (["Deutschland", "Polen", "Vietnam"].includes(german)) {
          selectedPattern =
            patterns.place[Math.floor(Math.random() * patterns.place.length)];
        } else if (
          ["Englisch", "Deutsch", "Polnisch", "Spanisch"].includes(german)
        ) {
          selectedPattern =
            patterns.language[
              Math.floor(Math.random() * patterns.language.length)
            ];
        } else if (
          ["morgen", "heute", "Vormittag", "Nachmittag", "Abend"].includes(
            german
          )
        ) {
          selectedPattern =
            patterns.time[Math.floor(Math.random() * patterns.time.length)];
        } else if (["Wie", "Wo", "Was", "Woher"].includes(german)) {
          selectedPattern =
            patterns.question[
              Math.floor(Math.random() * patterns.question.length)
            ];
        } else if (
          [
            "spreche",
            "komme",
            "hei√üe",
            "bin",
            "ist",
            "sehen",
            "h√∂ren",
            "lesen",
            "schreiben",
            "machen",
          ].includes(german)
        ) {
          selectedPattern =
            patterns.verb[Math.floor(Math.random() * patterns.verb.length)];
        } else if (
          [
            "gut",
            "super",
            "toll",
            "interessant",
            "einfach",
            "richtig",
          ].includes(german)
        ) {
          selectedPattern =
            patterns.adjective[
              Math.floor(Math.random() * patterns.adjective.length)
            ];
        } else {
          selectedPattern =
            patterns.noun[Math.floor(Math.random() * patterns.noun.length)];
        }

        return {
          german: selectedPattern.de,
          vietnamese: selectedPattern.vi,
        };
      }

      // Submit answer for writing and conjugation modes
      function submitAnswer() {
        if (isAnswered) return;

        const progress = gameProgress[currentGameMode];

        if (currentGameMode === "conjugation") {
          const userAnswer = document
            .getElementById("textInput")
            .value.trim()
            .toLowerCase();

          isAnswered = true;

          // Build expected answer based on current sentence type
          const correctAnswer = buildCorrectSentence(
            currentConjugation.verb,
            currentConjugation.pronounKey,
            currentSentenceType
          ).toLowerCase();

          // Normalize for comparison
          const normalizedUserAnswer = userAnswer.replace(/[.,!?]/g, "").trim();
          const normalizedCorrectAnswer = correctAnswer
            .replace(/[.,!?]/g, "")
            .trim();

          if (normalizedUserAnswer === normalizedCorrectAnswer) {
            const translation = getVietnameseTranslation(
              currentConjugation.verb,
              currentConjugation.pronounKey,
              currentSentenceType
            );
            showFeedback(
              true,
              `üéâ Ch√≠nh x√°c! C√¢u ${getSentenceTypeText(
                currentSentenceType
              )}: "${correctAnswer}"<br>üåç Nghƒ©a: ${translation}`
            );
            progress.correctAnswers++;
            progress.score += 10;
            playSuccessSound();
          } else {
            const translation = getVietnameseTranslation(
              currentConjugation.verb,
              currentConjugation.pronounKey,
              currentSentenceType
            );
            const detailedFeedback = `
              ‚ùå Ch∆∞a ƒë√∫ng! 
              üìù ƒê√°p √°n ƒë√∫ng: ${correctAnswer}
              üåç Nghƒ©a: ${translation}
              üí° M·∫πo nh·ªõ: ${getConjugationTip(
                currentConjugation.verb,
                currentConjugation.pronounKey
              )}
              üìö Quy t·∫Øc: ${getConjugationRule(
                currentConjugation.verb,
                currentConjugation.pronounKey
              )}
            `;
            showFeedback(false, detailedFeedback);
            progress.wrongAnswers++;
            playErrorSound();
          }
        } else if (currentGameMode === "writing") {
          const userAnswer = document
            .getElementById("textInput")
            .value.trim()
            .toLowerCase();

          isAnswered = true;
          const correctAnswer = currentWord.german.toLowerCase();

          // Normalize for comparison (handle special German characters)
          const normalizedUserAnswer = userAnswer
            .replace(/√ü/g, "ss")
            .replace(/√§/g, "ae")
            .replace(/√∂/g, "oe")
            .replace(/√º/g, "ue");
          const normalizedCorrectAnswer = correctAnswer
            .replace(/√ü/g, "ss")
            .replace(/√§/g, "ae")
            .replace(/√∂/g, "oe")
            .replace(/√º/g, "ue");

          if (
            userAnswer === correctAnswer ||
            normalizedUserAnswer === normalizedCorrectAnswer
          ) {
            showFeedback(true, "üéâ Ch√≠nh x√°c! B·∫°n ƒë√£ vi·∫øt ƒë√∫ng!");
            progress.correctAnswers++;
            progress.score += 10;
            playSuccessSound();

            // Show example sentence after correct answer
            setTimeout(() => {
              showExampleSentence();
            }, 1000);
          } else {
            showFeedback(
              false,
              `‚ùå Sai r·ªìi! ƒê√°p √°n ƒë√∫ng l√†: "${currentWord.german}"`
            );
            progress.wrongAnswers++;
            playErrorSound();

            // Show example sentence after wrong answer too
            setTimeout(() => {
              showExampleSentence();
            }, 1500);
          }
        }

        updateScore();
        showNextButton();
        document.getElementById("submitButton").style.display = "none";
      }

      // Show feedback
      function showFeedback(isCorrect, message) {
        const feedbackEl = document.getElementById("feedback");
        feedbackEl.style.display = "block";
        feedbackEl.innerHTML = message; // Changed from textContent to innerHTML
        feedbackEl.className = `feedback ${isCorrect ? "correct" : "wrong"}`;

        // For wrong answers in conjugation mode, make the feedback box larger
        if (!isCorrect && currentGameMode === "conjugation") {
          feedbackEl.style.fontSize = "1em";
          feedbackEl.style.lineHeight = "1.5";
          feedbackEl.style.textAlign = "left";
          feedbackEl.style.whiteSpace = "pre-line";
        } else {
          feedbackEl.style.fontSize = "1.1em";
          feedbackEl.style.lineHeight = "1.2";
          feedbackEl.style.textAlign = "center";
          feedbackEl.style.whiteSpace = "normal";
        }
      }

      // Show next button
      function showNextButton() {
        document.getElementById("nextButton").style.display = "inline-flex";
      }

      // Update score display
      function updateScore() {
        const progress = gameProgress[currentGameMode];
        document.getElementById("correctCount").textContent =
          progress.correctAnswers;
        document.getElementById("wrongCount").textContent =
          progress.wrongAnswers;
        document.getElementById("score").textContent = progress.score;
      }

      // Next question
      function nextQuestion() {
        currentQuestionIndex++;
        gameProgress[currentGameMode].currentIndex = currentQuestionIndex;
        loadQuestion();
        playClickSound();
      }

      // Skip question
      function skipQuestion() {
        if (!isAnswered) {
          gameProgress[currentGameMode].wrongAnswers++;
          updateScore();
        }
        playClickSound();
        nextQuestion();
      }

      // Play current word
      function playCurrentWord() {
        if (currentWord) {
          speakWord(currentWord.german);
        }
      }

      // Toggle recording for speaking mode
      function toggleRecording() {
        if (!recognition) {
          alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ nh·∫≠n di·ªán gi·ªçng n√≥i");
          return;
        }

        if (isRecording) {
          recognition.stop();
        } else {
          recognition.start();
        }

        playClickSound();
      }

      // Show results
      function showResults() {
        document.getElementById("gameArea").style.display = "none";
        document.getElementById("results").style.display = "block";

        const progress = gameProgress[currentGameMode];
        const totalAnswered = progress.correctAnswers + progress.wrongAnswers;
        const accuracy =
          totalAnswered > 0
            ? Math.round((progress.correctAnswers / totalAnswered) * 100)
            : 0;

        // Add conjugation styling to results if needed
        const finalScore = document.getElementById("finalScore");
        if (currentGameMode === "conjugation") {
          finalScore.classList.add("conjugation");
        } else {
          finalScore.classList.remove("conjugation");
        }

        document.getElementById("finalScore").textContent = progress.score;
        document.getElementById("finalCorrect").textContent =
          progress.correctAnswers;
        document.getElementById("finalWrong").textContent =
          progress.wrongAnswers;
        document.getElementById("finalAccuracy").textContent = accuracy + "%";

        playSuccessSound();
      }

      // Restart game
      function restartGame() {
        // Reset progress for current mode
        gameProgress[currentGameMode] = {
          correctAnswers: 0,
          wrongAnswers: 0,
          score: 0,
          currentIndex: 0,
          questionsData: [],
        };
        playClickSound();
        startGame(currentGameMode);
      }

      // Show main menu
      function showMainMenu() {
        document.getElementById("mainMenu").style.display = "block";
        document.getElementById("gameArea").style.display = "none";
        document.getElementById("results").style.display = "none";
        document.getElementById("backButton").classList.remove("show");

        playClickSound();

        // Update progress display for each mode
        updateModeProgress();
      }

      // Update progress display for each game mode
      function updateModeProgress() {
        const modes = [
          "listening",
          "speaking",
          "reading",
          "writing",
          "conjugation",
        ];

        modes.forEach((mode) => {
          const progress = gameProgress[mode];
          const progressEl = document.getElementById(mode + "Progress");

          if (
            progress.currentIndex > 0 ||
            progress.correctAnswers > 0 ||
            progress.wrongAnswers > 0
          ) {
            const totalAnswered =
              progress.correctAnswers + progress.wrongAnswers;
            const accuracy =
              totalAnswered > 0
                ? Math.round((progress.correctAnswers / totalAnswered) * 100)
                : 0;

            if (mode === "conjugation") {
              progressEl.textContent = `üìä ${progress.currentIndex}/${
                Object.keys(verbConjugations).length * 9 * 3
              } - ‚úÖ ${progress.correctAnswers} - ‚≠ê ${
                progress.score
              } - üéØ ${accuracy}%`;
            } else {
              progressEl.textContent = `üìä ${progress.currentIndex}/185 - ‚úÖ ${progress.correctAnswers} - ‚≠ê ${progress.score} - üéØ ${accuracy}%`;
            }
            progressEl.classList.add("has-progress");
          } else {
            progressEl.textContent =
              "üî• Ch∆∞a b·∫Øt ƒë·∫ßu - H√£y th·ª≠ th√°ch b·∫£n th√¢n!";
            progressEl.classList.remove("has-progress");
          }
        });
      }

      // Handle Enter key for input fields
      document.addEventListener("DOMContentLoaded", function () {
        // Text input handler
        document
          .getElementById("textInput")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter" && !isAnswered) {
              submitAnswer();
            }
          });

        // Load voices when page loads
        if ("speechSynthesis" in window) {
          speechSynthesis.addEventListener("voiceschanged", function () {
            console.log("Voices loaded:", speechSynthesis.getVoices().length);
          });
        }

        // Initialize progress display on page load
        updateModeProgress();

        // Add click sound to all buttons
        document.addEventListener("click", function (e) {
          if (
            e.target.matches("button") ||
            e.target.matches(".btn") ||
            e.target.matches(".option") ||
            e.target.matches(".game-mode") ||
            e.target.matches(".sentence-type-btn")
          ) {
            // Small delay to not interfere with other sounds
            setTimeout(() => {
              if (!e.target.matches(".mic-button")) {
                playClickSound();
              }
            }, 50);
          }
        });

        // Initialize audio context on first user interaction
        document.addEventListener(
          "click",
          function () {
            if (!audioContext) {
              initializeAudio();
            }
          },
          { once: true }
        );
      });

      // Add keyboard shortcuts
      document.addEventListener("keydown", function (e) {
        // Only if game area is visible
        if (document.getElementById("gameArea").style.display === "block") {
          switch (e.key) {
            case " ": // Spacebar for audio
              e.preventDefault();
              if (
                currentGameMode === "listening" ||
                currentGameMode === "reading"
              ) {
                playCurrentWord();
              } else if (currentGameMode === "conjugation") {
                speakConjugationSentence();
              }
              break;
            case "Enter":
              e.preventDefault();
              if (
                document.getElementById("nextButton").style.display !== "none"
              ) {
                nextQuestion();
              } else if (
                document.getElementById("submitButton").style.display !== "none"
              ) {
                submitAnswer();
              }
              break;
            case "Escape":
              e.preventDefault();
              showMainMenu();
              break;
            case "1":
            case "2":
            case "3":
            case "4":
              // Quick select options
              e.preventDefault();
              const optionIndex = parseInt(e.key) - 1;
              const options = document.querySelectorAll(
                ".option:not(.disabled)"
              );
              if (options[optionIndex] && !isAnswered) {
                options[optionIndex].click();
              }
              break;
          }
        }
      });

      // Add visual feedback for button presses
      function addButtonFeedback() {
        const buttons = document.querySelectorAll(
          "button, .btn, .option, .game-mode"
        );
        buttons.forEach((button) => {
          button.addEventListener("mousedown", function () {
            this.style.transform = "scale(0.95)";
          });

          button.addEventListener("mouseup", function () {
            this.style.transform = "";
          });

          button.addEventListener("mouseleave", function () {
            this.style.transform = "";
          });
        });
      }

      // Initialize visual feedback
      document.addEventListener("DOMContentLoaded", addButtonFeedback);

      // Add touch feedback for mobile
      if ("ontouchstart" in window) {
        document.addEventListener("touchstart", function (e) {
          if (
            e.target.matches("button") ||
            e.target.matches(".btn") ||
            e.target.matches(".option") ||
            e.target.matches(".game-mode")
          ) {
            e.target.style.transform = "scale(0.95)";
          }
        });

        document.addEventListener("touchend", function (e) {
          if (
            e.target.matches("button") ||
            e.target.matches(".btn") ||
            e.target.matches(".option") ||
            e.target.matches(".game-mode")
          ) {
            setTimeout(() => {
              e.target.style.transform = "";
            }, 150);
          }
        });
      }

      // Add progress persistence (using sessionStorage instead of localStorage)
      function saveProgress() {
        try {
          sessionStorage.setItem(
            "germanGameProgress",
            JSON.stringify(gameProgress)
          );
        } catch (e) {
          console.log("Could not save progress");
        }
      }

      function loadProgress() {
        try {
          const saved = sessionStorage.getItem("germanGameProgress");
          if (saved) {
            const savedProgress = JSON.parse(saved);
            // Merge with default structure
            Object.keys(savedProgress).forEach((mode) => {
              if (gameProgress[mode]) {
                Object.assign(gameProgress[mode], savedProgress[mode]);
              }
            });
          }
        } catch (e) {
          console.log("Could not load progress");
        }
      }

      // Save progress after each question
      const originalUpdateScore = updateScore;
      updateScore = function () {
        originalUpdateScore();
        saveProgress();
      };

      // Load progress on page load
      document.addEventListener("DOMContentLoaded", function () {
        loadProgress();
        updateModeProgress();
      });

      // Add success celebration animation
      function celebrateSuccess() {
        const gameArea = document.getElementById("gameArea");
        gameArea.style.animation = "celebrate 0.6s ease-out";

        setTimeout(() => {
          gameArea.style.animation = "";
        }, 600);
      }

      // Add CSS animation keyframes
      const style = document.createElement("style");
      style.textContent = `
        @keyframes celebrate {
          0% { transform: scale(1); }
          50% { transform: scale(1.02); }
          100% { transform: scale(1); }
        }
        
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-5px); }
          75% { transform: translateX(5px); }
        }
        
        .shake {
          animation: shake 0.5s ease-in-out;
        }
      `;
      document.head.appendChild(style);

      // Add error shake animation
      function shakeOnError() {
        const feedback = document.getElementById("feedback");
        feedback.classList.add("shake");

        setTimeout(() => {
          feedback.classList.remove("shake");
        }, 500);
      }

      // Enhanced feedback function
      const originalShowFeedback = showFeedback;
      showFeedback = function (isCorrect, message) {
        originalShowFeedback(isCorrect, message);

        if (isCorrect) {
          celebrateSuccess();
        } else {
          shakeOnError();
        }
      };

      // Add accessibility improvements
      function addAccessibility() {
        // Add ARIA labels
        document
          .getElementById("playButton")
          .setAttribute("aria-label", "Ph√°t √¢m t·ª´ hi·ªán t·∫°i");
        document
          .getElementById("submitButton")
          .setAttribute("aria-label", "Ki·ªÉm tra c√¢u tr·∫£ l·ªùi");
        document
          .getElementById("nextButton")
          .setAttribute("aria-label", "Chuy·ªÉn ƒë·∫øn c√¢u h·ªèi ti·∫øp theo");

        // Add keyboard navigation hints
        const helpText = document.createElement("div");
        helpText.style.cssText =
          "position: fixed; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 10px; border-radius: 5px; font-size: 12px; z-index: 1000;";
        helpText.innerHTML = `
          <strong>Ph√≠m t·∫Øt:</strong><br>
          Space: Ph√°t √¢m | Enter: Ti·∫øp theo | Esc: Menu | 1-4: Ch·ªçn ƒë√°p √°n
        `;
        document.body.appendChild(helpText);

        // Hide help text after 5 seconds
        setTimeout(() => {
          helpText.style.opacity = "0";
          helpText.style.transition = "opacity 2s";
        }, 5000);
      }

      // Initialize accessibility on page load
      document.addEventListener("DOMContentLoaded", addAccessibility);
    </script>
  </body>
</html>
