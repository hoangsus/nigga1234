<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TrÃ² chÆ¡i Buá»•i 1 - Giá»›i thiá»‡u báº£n thÃ¢n (NÃ¢ng cao)</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 2.5em;
        color: #4a47a3;
        margin-bottom: 10px;
      }

      .subtitle {
        font-size: 1.2em;
        color: #666;
        margin-bottom: 20px;
      }

      .back-to-index {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 50px;
        padding: 15px 25px;
        font-size: 1em;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        opacity: 0;
        visibility: hidden;
        transform: translateY(100px);
        z-index: 1000;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .back-to-index.visible {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .back-to-index:hover {
        background: linear-gradient(135deg, #5a6fd8 0%, #6a42a0 100%);
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
      }

      .game-menu {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .game-card {
        background: linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%);
        border: 2px solid #2196f3;
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .game-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        border-color: #1976d2;
      }

      .game-card.active {
        border-color: #4caf50;
        background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
      }

      .game-card.new {
        border-color: #ff9800;
        background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
      }

      .new-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #ff5722;
        color: white;
        padding: 4px 8px;
        border-radius: 10px;
        font-size: 0.7em;
        font-weight: bold;
      }

      .game-icon {
        font-size: 3em;
        margin-bottom: 15px;
      }

      .game-title {
        font-size: 1.3em;
        font-weight: bold;
        color: #1976d2;
        margin-bottom: 10px;
      }

      .game-description {
        color: #666;
        margin-bottom: 15px;
        line-height: 1.5;
      }

      .game-stats {
        font-size: 0.9em;
        color: #888;
      }

      .game-area {
        display: none;
        min-height: 400px;
      }

      .game-area.active {
        display: block;
      }

      .game-header {
        background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
        color: white;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .game-info h3 {
        margin-bottom: 5px;
      }

      .game-controls {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: #4caf50;
        color: white;
      }

      .btn-primary:hover {
        background: #45a049;
      }

      .btn-secondary {
        background: #f44336;
        color: white;
      }

      .btn-secondary:hover {
        background: #da190b;
      }

      .btn-back {
        background: #ff9800;
        color: white;
      }

      .btn-back:hover {
        background: #e68900;
      }

      .btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      /* Audio status indicator */
      .audio-status {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        margin-left: 10px;
        font-size: 0.9em;
        color: #666;
      }

      .audio-loading {
        color: #ff9800;
      }

      .audio-ready {
        color: #4caf50;
      }

      .audio-error {
        color: #f44336;
      }

      /* Game 1: Flash Cards */
      .flashcard {
        background: white;
        border: 3px solid #2196f3;
        border-radius: 15px;
        padding: 40px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        min-height: 300px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
      }

      .flashcard:hover {
        transform: scale(1.02);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      .flashcard.flipped {
        background: #e8f5e8;
        border-color: #4caf50;
      }

      .card-content {
        font-size: 2em;
        margin-bottom: 20px;
        font-weight: bold;
      }

      .card-pronunciation {
        font-size: 1.2em;
        color: #8e44ad;
        margin-bottom: 15px;
        font-style: italic;
      }

      .card-translation {
        font-size: 1.5em;
        color: #27ae60;
        font-weight: bold;
      }

      .card-hint {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        color: #666;
        font-size: 0.9em;
      }

      /* Game 2: Memory Game */
      .memory-grid {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 10px;
        max-width: 800px;
        margin: 0 auto;
      }

      .memory-card {
        aspect-ratio: 1;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        color: white;
        font-weight: bold;
        position: relative;
        overflow: hidden;
        font-size: 0.7em;
      }

      .memory-card:hover {
        transform: scale(1.05);
      }

      .memory-card.flipped {
        background: white;
        color: #333;
        border: 2px solid #2196f3;
      }

      .memory-card.matched {
        background: #4caf50;
        color: white;
      }

      .memory-card-content {
        text-align: center;
        padding: 5px;
        word-break: break-word;
      }

      /* Game 3: Quiz */
      .quiz-question {
        background: #f8f9ff;
        border: 2px solid #2196f3;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
        text-align: center;
      }

      .quiz-question h3 {
        color: #1976d2;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      .quiz-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .quiz-option {
        background: white;
        border: 2px solid #dee2e6;
        border-radius: 10px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
      }

      .quiz-option:hover {
        border-color: #2196f3;
        background: #e3f2fd;
      }

      .quiz-option.correct {
        border-color: #4caf50;
        background: #e8f5e8;
        color: #155724;
      }

      .quiz-option.wrong {
        border-color: #f44336;
        background: #ffebee;
        color: #721c24;
      }

      .score-display {
        text-align: center;
        font-size: 1.2em;
        margin: 20px 0;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
      }

      /* Category Game */
      .category-box {
        border: 2px dashed #ccc;
        padding: 20px;
        min-height: 120px;
        border-radius: 10px;
        background: #f9f9f9;
        transition: all 0.3s ease;
      }

      .category-box h4 {
        text-align: center;
        color: #666;
        margin-bottom: 10px;
        font-size: 1.1em;
      }

      .draggable-word {
        background: #667eea;
        color: white;
        padding: 8px 12px;
        border-radius: 20px;
        cursor: move;
        display: inline-block;
        margin: 5px;
        font-size: 0.9em;
        user-select: none;
        transition: all 0.3s ease;
      }

      .draggable-word:hover {
        background: #5a6fd8;
        transform: scale(1.05);
      }

      .category-word {
        background: #4caf50;
        color: white;
        padding: 5px 10px;
        margin: 2px;
        border-radius: 15px;
        display: inline-block;
        font-size: 0.8em;
      }

      /* Typing Game */
      .typing-input {
        width: 100%;
        padding: 15px;
        font-size: 1.2em;
        border: 2px solid #ddd;
        border-radius: 10px;
        margin: 20px 0;
        text-align: center;
      }

      .typing-input:focus {
        outline: none;
        border-color: #2196f3;
      }

      .typing-feedback {
        margin-top: 15px;
        font-size: 1.1em;
        font-weight: bold;
        text-align: center;
        padding: 10px;
        border-radius: 8px;
      }

      /* Speed Test Game */
      .speed-test-area {
        background: white;
        border: 2px solid #2196f3;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
      }

      .speed-test-word {
        font-size: 3em;
        text-align: center;
        margin: 30px 0;
        font-weight: bold;
        color: #1976d2;
      }

      .speed-test-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .stat-box {
        background: #f8f9ff;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        border: 2px solid #e3f2fd;
      }

      .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #1976d2;
      }

      .stat-label {
        color: #666;
        margin-top: 5px;
      }

      /* Word Builder Game */
      .word-builder-area {
        background: white;
        border: 2px solid #2196f3;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
      }

      .scrambled-letters {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 10px;
        margin: 20px 0;
      }

      .letter-tile {
        background: #667eea;
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1.5em;
        font-weight: bold;
        transition: all 0.3s ease;
        user-select: none;
      }

      .letter-tile:hover {
        background: #5a6fd8;
        transform: scale(1.1);
      }

      .letter-tile.used {
        background: #ccc;
        cursor: not-allowed;
        transform: scale(0.9);
      }

      .word-builder-input {
        width: 100%;
        padding: 20px;
        font-size: 1.5em;
        text-align: center;
        border: 3px solid #ddd;
        border-radius: 10px;
        margin: 20px 0;
        letter-spacing: 3px;
        text-transform: lowercase;
      }

      .word-builder-input:focus {
        outline: none;
        border-color: #2196f3;
      }

      /* Sentence Builder Game */
      .sentence-builder-area {
        background: white;
        border: 2px solid #2196f3;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
      }

      .sentence-prompt {
        background: #f8f9ff;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
        font-size: 1.2em;
        color: #1976d2;
      }

      .word-bank {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 10px;
        margin: 20px 0;
        padding: 20px;
        background: #f0f0f0;
        border-radius: 10px;
      }

      .word-chip {
        background: #4caf50;
        color: white;
        padding: 10px 15px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 1em;
        transition: all 0.3s ease;
        user-select: none;
      }

      .word-chip:hover {
        background: #45a049;
        transform: scale(1.05);
      }

      .word-chip.used {
        background: #ccc;
        cursor: not-allowed;
      }

      .sentence-builder-area {
        min-height: 60px;
        border: 2px dashed #ddd;
        border-radius: 10px;
        padding: 15px;
        margin: 20px 0;
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        align-items: center;
      }

      /* Audio fallback display */
      .audio-fallback {
        background: #f0f8ff;
        border: 2px solid #2196f3;
        border-radius: 10px;
        padding: 20px;
        margin: 15px 0;
        text-align: center;
      }

      .audio-fallback h4 {
        color: #1976d2;
        margin-bottom: 10px;
      }

      .pronunciation-display {
        font-size: 1.3em;
        color: #8e44ad;
        font-weight: bold;
        margin: 10px 0;
      }

      /* Audio Modal */
      .audio-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 2000;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 80%;
        text-align: center;
      }

      .modal-content h2 {
        margin-bottom: 15px;
        color: #4a47a3;
      }

      .modal-content p {
        margin-bottom: 20px;
        color: #666;
      }

      .enable-audio-btn {
        background: #4caf50;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        font-size: 1.1em;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .enable-audio-btn:hover {
        background: #45a049;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .container {
          padding: 20px;
          margin: 10px;
        }

        .header h1 {
          font-size: 2em;
        }

        .memory-grid {
          grid-template-columns: repeat(6, 1fr);
          gap: 8px;
        }

        .quiz-options {
          grid-template-columns: 1fr;
        }

        .back-to-index {
          bottom: 20px;
          right: 20px;
          padding: 12px 20px;
          font-size: 0.9em;
        }

        .game-menu {
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .speed-test-stats {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 480px) {
        .memory-grid {
          grid-template-columns: repeat(4, 1fr);
        }

        .flashcard {
          padding: 20px;
          min-height: 250px;
        }

        .card-content {
          font-size: 1.5em;
        }

        .back-to-index {
          padding: 10px 15px;
          font-size: 0.8em;
        }

        .memory-card {
          font-size: 0.6em;
        }

        .speed-test-word {
          font-size: 2em;
        }

        .speed-test-stats {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Audio Activation Modal -->
    <div id="audioModal" class="audio-modal">
      <div class="modal-content">
        <h2>ğŸ”Š KÃ­ch hoáº¡t Ã¢m thanh</h2>
        <p>
          Äá»ƒ tráº£i nghiá»‡m Ä‘áº§y Ä‘á»§ trÃ² chÆ¡i, vui lÃ²ng báº¥m nÃºt bÃªn dÆ°á»›i Ä‘á»ƒ kÃ­ch hoáº¡t
          Ã¢m thanh.
        </p>
        <button class="enable-audio-btn" onclick="enableAudio()">
          KÃ­ch hoáº¡t Ã¢m thanh
        </button>
      </div>
    </div>

    <div class="container">
      <div class="header">
        <h1>ğŸ® TrÃ² chÆ¡i Buá»•i 1 - NÃ¢ng cao</h1>
        <div class="subtitle">
          Giá»›i thiá»‡u báº£n thÃ¢n - 9 trÃ² chÆ¡i luyá»‡n táº­p tá»« vá»±ng thÃº vá»‹
        </div>
      </div>

      <div class="game-menu" id="gameMenu">
        <div class="game-card" onclick="startGame('flashcards')">
          <div class="game-icon">ğŸƒ</div>
          <div class="game-title">Tháº» ghi nhá»›</div>
          <div class="game-description">
            Láº­t tháº» Ä‘á»ƒ xem nghÄ©a tiáº¿ng Viá»‡t. Há»c tá»« vá»±ng má»™t cÃ¡ch trá»±c quan vÃ 
            hiá»‡u quáº£.
          </div>
          <div class="game-stats">ğŸ“š 72 tá»« â€¢ â±ï¸ 20-25 phÃºt</div>
        </div>

        <div class="game-card" onclick="startGame('memory')">
          <div class="game-icon">ğŸ§ </div>
          <div class="game-title">TrÃ² chÆ¡i ghi nhá»›</div>
          <div class="game-description">
            TÃ¬m cáº·p tá»« tiáº¿ng Äá»©c vÃ  nghÄ©a tiáº¿ng Viá»‡t. RÃ¨n luyá»‡n trÃ­ nhá»› vÃ  tá»«
            vá»±ng.
          </div>
          <div class="game-stats">ğŸ¯ 36 cáº·p â€¢ â±ï¸ 30 phÃºt</div>
        </div>

        <div class="game-card" onclick="startGame('quiz')">
          <div class="game-icon">â“</div>
          <div class="game-title">CÃ¢u há»i tráº¯c nghiá»‡m</div>
          <div class="game-description">
            Tráº£ lá»i cÃ¢u há»i vá» tá»« vá»±ng vÃ  ngá»¯ phÃ¡p cÆ¡ báº£n. Kiá»ƒm tra kiáº¿n thá»©c Ä‘Ã£
            há»c.
          </div>
          <div class="game-stats">ğŸ“ 72 cÃ¢u â€¢ â±ï¸ 45 phÃºt</div>
        </div>

        <div class="game-card" onclick="startGame('listening')">
          <div class="game-icon">ğŸ§</div>
          <div class="game-title">Luyá»‡n nghe</div>
          <div class="game-description">
            Nghe tá»« tiáº¿ng Äá»©c vÃ  chá»n nghÄ©a Ä‘Ãºng. RÃ¨n luyá»‡n kháº£ nÄƒng nháº­n biáº¿t
            Ã¢m thanh.
          </div>
          <div class="game-stats">ğŸ”Š 72 tá»« â€¢ â±ï¸ 35 phÃºt</div>
        </div>

        <div class="game-card" onclick="startGame('category')">
          <div class="game-icon">ğŸ·ï¸</div>
          <div class="game-title">PhÃ¢n loáº¡i tá»« vá»±ng</div>
          <div class="game-description">
            KÃ©o tháº£ tá»« vÃ o Ä‘Ãºng nhÃ³m. Há»c cÃ¡ch phÃ¢n loáº¡i vÃ  ghi nhá»› theo chá»§ Ä‘á».
          </div>
          <div class="game-stats">ğŸ¯ 72 tá»« / 12 nhÃ³m â€¢ â±ï¸ 25 phÃºt</div>
        </div>

        <div class="game-card" onclick="startGame('typing')">
          <div class="game-icon">âŒ¨ï¸</div>
          <div class="game-title">GÃµ tá»« vá»±ng</div>
          <div class="game-description">
            Nghe tá»« tiáº¿ng Äá»©c vÃ  gÃµ chÃ­nh xÃ¡c. RÃ¨n luyá»‡n chÃ­nh táº£ vÃ  phÃ¡t Ã¢m.
          </div>
          <div class="game-stats">âœï¸ 72 tá»« â€¢ â±ï¸ 40 phÃºt</div>
        </div>

        <div class="game-card new" onclick="startGame('speedtest')">
          <div class="new-badge">Má»šI</div>
          <div class="game-icon">âš¡</div>
          <div class="game-title">Kiá»ƒm tra tá»‘c Ä‘á»™</div>
          <div class="game-description">
            Tráº£ lá»i nhanh nghÄ©a cá»§a tá»« tiáº¿ng Äá»©c. RÃ¨n luyá»‡n pháº£n xáº¡ vÃ  tá»‘c Ä‘á»™
            nháº­n biáº¿t.
          </div>
          <div class="game-stats">ğŸš€ 60 giÃ¢y â€¢ â±ï¸ 10 phÃºt</div>
        </div>

        <div class="game-card new" onclick="startGame('wordbuilder')">
          <div class="new-badge">Má»šI</div>
          <div class="game-icon">ğŸ§©</div>
          <div class="game-title">Xáº¿p chá»¯ cÃ¡i</div>
          <div class="game-description">
            Sáº¯p xáº¿p cÃ¡c chá»¯ cÃ¡i Ä‘á»ƒ táº¡o thÃ nh tá»« tiáº¿ng Äá»©c. RÃ¨n luyá»‡n chÃ­nh táº£ vÃ 
            cáº¥u trÃºc tá»«.
          </div>
          <div class="game-stats">ğŸ”¤ 72 tá»« â€¢ â±ï¸ 30 phÃºt</div>
        </div>

        <div class="game-card new" onclick="startGame('sentencebuilder')">
          <div class="new-badge">Má»šI</div>
          <div class="game-icon">ğŸ“</div>
          <div class="game-title">GhÃ©p cÃ¢u</div>
          <div class="game-description">
            Sáº¯p xáº¿p tá»« Ä‘á»ƒ táº¡o thÃ nh cÃ¢u Ä‘Ãºng ngá»¯ phÃ¡p. Há»c cáº¥u trÃºc cÃ¢u cÆ¡ báº£n.
          </div>
          <div class="game-stats">ğŸ¯ 36 cÃ¢u â€¢ â±ï¸ 35 phÃºt</div>
        </div>
      </div>

      <!-- Flashcards Game -->
      <div class="game-area" id="flashcardsGame">
        <div class="game-header">
          <div class="game-info">
            <h3>ğŸƒ Tháº» ghi nhá»›</h3>
            <p>
              Tháº» <span id="currentCard">1</span> /
              <span id="totalCards">72</span>
            </p>
          </div>
          <div class="game-controls">
            <button class="btn btn-primary" onclick="prevCard()">
              â¬…ï¸ TrÆ°á»›c
            </button>
            <button class="btn btn-primary" onclick="nextCard()">
              Tiáº¿p â¡ï¸
            </button>
            <button class="btn btn-back" onclick="backToMenu()">ğŸ  Menu</button>
          </div>
        </div>

        <div class="flashcard" id="flashcard" onclick="flipCard()">
          <div class="card-content" id="cardContent">ich</div>
          <div class="card-pronunciation" id="cardPronunciation">[Ã­ch]</div>
          <div
            class="card-translation"
            id="cardTranslation"
            style="display: none"
          >
            tÃ´i
          </div>
          <div class="card-hint">ğŸ’¡ Báº¥m Ä‘á»ƒ xem nghÄ©a</div>
        </div>
      </div>

      <!-- Memory Game -->
      <div class="game-area" id="memoryGame">
        <div class="game-header">
          <div class="game-info">
            <h3>ğŸ§  TrÃ² chÆ¡i ghi nhá»›</h3>
            <p>
              Äiá»ƒm: <span id="memoryScore">0</span> â€¢ LÆ°á»£t:
              <span id="memoryMoves">0</span> â€¢ Cáº·p:
              <span id="memoryPairs">0</span>/36
            </p>
          </div>
          <div class="game-controls">
            <button class="btn btn-primary" onclick="resetMemory()">
              ğŸ”„ ChÆ¡i láº¡i
            </button>
            <button class="btn btn-back" onclick="backToMenu()">ğŸ  Menu</button>
          </div>
        </div>

        <div class="memory-grid" id="memoryGrid">
          <!-- Memory cards will be generated by JavaScript -->
        </div>
      </div>

      <!-- Quiz Game -->
      <div class="game-area" id="quizGame">
        <div class="game-header">
          <div class="game-info">
            <h3>â“ CÃ¢u há»i tráº¯c nghiá»‡m</h3>
            <p>
              CÃ¢u <span id="currentQuestion">1</span> /
              <span id="totalQuestions">72</span>
            </p>
          </div>
          <div class="game-controls">
            <button
              class="btn btn-primary"
              onclick="nextQuestion()"
              id="nextBtn"
              style="display: none"
            >
              Tiáº¿p â¡ï¸
            </button>
            <button class="btn btn-back" onclick="backToMenu()">ğŸ  Menu</button>
          </div>
        </div>

        <div class="quiz-question" id="quizQuestion">
          <h3 id="questionText">Tá»« "ich" cÃ³ nghÄ©a lÃ  gÃ¬?</h3>
          <div class="quiz-options" id="quizOptions">
            <!-- Options will be generated by JavaScript -->
          </div>
        </div>

        <div class="score-display" id="quizScore" style="display: none">
          Äiá»ƒm cá»§a báº¡n: <span id="finalScore">0</span>/72
        </div>
      </div>

      <!-- Listening Game -->
      <div class="game-area" id="listeningGame">
        <div class="game-header">
          <div class="game-info">
            <h3>ğŸ§ Luyá»‡n nghe</h3>
            <p>
              Tá»« <span id="currentListening">1</span> /
              <span id="totalListening">72</span>
            </p>
          </div>
          <div class="game-controls">
            <button class="btn btn-primary" onclick="playAudio()" id="playBtn">
              ğŸ”Š Nghe láº¡i
            </button>
            <button
              class="btn btn-primary"
              onclick="nextListening()"
              id="nextListeningBtn"
              style="display: none"
            >
              Tiáº¿p â¡ï¸
            </button>
            <button class="btn btn-back" onclick="backToMenu()">ğŸ  Menu</button>
          </div>
        </div>

        <div class="quiz-question">
          <h3>ğŸ§ Nghe vÃ  chá»n nghÄ©a Ä‘Ãºng:</h3>

          <div class="quiz-options" id="listeningOptions">
            <!-- Options will be generated by JavaScript -->
          </div>
        </div>

        <div class="score-display" id="listeningScore" style="display: none">
          Äiá»ƒm nghe: <span id="finalListeningScore">0</span>/72
        </div>
      </div>

      <!-- Category Game -->
      <div class="game-area" id="categoryGame">
        <div class="game-header">
          <div class="game-info">
            <h3>ğŸ·ï¸ PhÃ¢n loáº¡i tá»« vá»±ng</h3>
            <p>
              Äiá»ƒm: <span id="categoryScore">0</span> â€¢ CÃ²n láº¡i:
              <span id="remainingWords">72</span>
            </p>
          </div>
          <div class="game-controls">
            <button class="btn btn-primary" onclick="resetCategory()">
              ğŸ”„ ChÆ¡i láº¡i
            </button>
            <button class="btn btn-back" onclick="backToMenu()">ğŸ  Menu</button>
          </div>
        </div>

        <div id="categoryContainer">
          <!-- Category game will be rendered here -->
        </div>
      </div>

      <!-- Typing Game -->
      <div class="game-area" id="typingGame">
        <div class="game-header">
          <div class="game-info">
            <h3>âŒ¨ï¸ GÃµ tá»« vá»±ng</h3>
            <p>
              Tá»« <span id="currentTyping">1</span> /
              <span id="totalTyping">72</span>
            </p>
          </div>
          <div class="game-controls">
            <button
              class="btn btn-primary"
              onclick="playTypingAudio()"
              id="playTypingBtn"
            >
              ğŸ”Š Nghe láº¡i
            </button>
            <button
              class="btn btn-primary"
              onclick="nextTyping()"
              id="nextTypingBtn"
              style="display: none"
            >
              Tiáº¿p â¡ï¸
            </button>
            <button class="btn btn-back" onclick="backToMenu()">ğŸ  Menu</button>
          </div>
        </div>

        <div class="quiz-question">
          <h3>âŒ¨ï¸ Nghe vÃ  gÃµ tá»« tiáº¿ng Äá»©c:</h3>
          <input
            type="text"
            id="typingInput"
            class="typing-input"
            placeholder="GÃµ tá»« báº¡n nghe Ä‘Æ°á»£c..."
          />
          <button
            class="btn btn-primary"
            onclick="checkTyping()"
            id="checkTypingBtn"
          >
            âœ… Kiá»ƒm tra
          </button>
          <div id="typingFeedback" class="typing-feedback"></div>
        </div>

        <div class="score-display" id="typingScore" style="display: none">
          Äiá»ƒm gÃµ tá»«: <span id="finalTypingScore">0</span>/72
        </div>
      </div>

      <!-- Speed Test Game -->
      <div class="game-area" id="speedtestGame">
        <div class="game-header">
          <div class="game-info">
            <h3>âš¡ Kiá»ƒm tra tá»‘c Ä‘á»™</h3>
            <p id="speedTestStatus">Sáºµn sÃ ng báº¯t Ä‘áº§u?</p>
          </div>
          <div class="game-controls">
            <button
              class="btn btn-primary"
              onclick="startSpeedTest()"
              id="speedStartBtn"
            >
              ğŸš€ Báº¯t Ä‘áº§u
            </button>
            <button
              class="btn btn-primary"
              onclick="resetSpeedTest()"
              id="speedResetBtn"
              style="display: none"
            >
              ğŸ”„ ChÆ¡i láº¡i
            </button>
            <button class="btn btn-back" onclick="backToMenu()">ğŸ  Menu</button>
          </div>
        </div>

        <div class="speed-test-area" id="speedTestArea">
          <div class="speed-test-word" id="speedTestWord">
            Nháº¥n "Báº¯t Ä‘áº§u" Ä‘á»ƒ chÆ¡i!
          </div>

          <div class="quiz-options" id="speedTestOptions" style="display: none">
            <!-- Options will be generated by JavaScript -->
          </div>

          <div class="speed-test-stats">
            <div class="stat-box">
              <div class="stat-number" id="speedScore">0</div>
              <div class="stat-label">Äiá»ƒm</div>
            </div>
            <div class="stat-box">
              <div class="stat-number" id="speedTime">60</div>
              <div class="stat-label">Thá»i gian</div>
            </div>
            <div class="stat-box">
              <div class="stat-number" id="speedCorrect">0</div>
              <div class="stat-label">ÄÃºng</div>
            </div>
            <div class="stat-box">
              <div class="stat-number" id="speedWrong">0</div>
              <div class="stat-label">Sai</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Word Builder Game -->
      <div class="game-area" id="wordbuilderGame">
        <div class="game-header">
          <div class="game-info">
            <h3>ğŸ§© Xáº¿p chá»¯ cÃ¡i</h3>
            <p>
              Tá»« <span id="currentWordBuilder">1</span> /
              <span id="totalWordBuilder">72</span>
            </p>
          </div>
          <div class="game-controls">
            <button
              class="btn btn-primary"
              onclick="checkWordBuilder()"
              id="checkWordBtn"
            >
              âœ… Kiá»ƒm tra
            </button>
            <button
              class="btn btn-primary"
              onclick="nextWordBuilder()"
              id="nextWordBtn"
              style="display: none"
            >
              Tiáº¿p â¡ï¸
            </button>
            <button class="btn btn-secondary" onclick="clearWordBuilder()">
              ğŸ—‘ï¸ XÃ³a
            </button>
            <button class="btn btn-back" onclick="backToMenu()">ğŸ  Menu</button>
          </div>
        </div>

        <div class="word-builder-area">
          <div class="quiz-question">
            <h3 id="wordBuilderPrompt">
              Sáº¯p xáº¿p chá»¯ cÃ¡i Ä‘á»ƒ táº¡o thÃ nh tá»« cÃ³ nghÄ©a: "tÃ´i"
            </h3>

            <input
              type="text"
              id="wordBuilderInput"
              class="word-builder-input"
              placeholder="Nháº¥p vÃ o chá»¯ cÃ¡i Ä‘á»ƒ xáº¿p tá»«..."
              readonly
            />

            <div class="scrambled-letters" id="scrambledLetters">
              <!-- Letters will be generated by JavaScript -->
            </div>

            <div id="wordBuilderFeedback" class="typing-feedback"></div>
          </div>
        </div>

        <div class="score-display" id="wordBuilderScore" style="display: none">
          Äiá»ƒm xáº¿p chá»¯: <span id="finalWordBuilderScore">0</span>/72
        </div>
      </div>

      <!-- Sentence Builder Game -->
      <div class="game-area" id="sentencebuilderGame">
        <div class="game-header">
          <div class="game-info">
            <h3>ğŸ“ GhÃ©p cÃ¢u</h3>
            <p>
              CÃ¢u <span id="currentSentence">1</span> /
              <span id="totalSentences">36</span>
            </p>
          </div>
          <div class="game-controls">
            <button
              class="btn btn-primary"
              onclick="checkSentence()"
              id="checkSentenceBtn"
            >
              âœ… Kiá»ƒm tra
            </button>
            <button
              class="btn btn-primary"
              onclick="nextSentence()"
              id="nextSentenceBtn"
              style="display: none"
            >
              Tiáº¿p â¡ï¸
            </button>
            <button class="btn btn-secondary" onclick="clearSentence()">
              ğŸ—‘ï¸ XÃ³a
            </button>
            <button class="btn btn-back" onclick="backToMenu()">ğŸ  Menu</button>
          </div>
        </div>

        <div class="sentence-builder-area">
          <div class="sentence-prompt" id="sentencePrompt">
            Sáº¯p xáº¿p cÃ¡c tá»« Ä‘á»ƒ táº¡o thÃ nh cÃ¢u: "TÃ´i tÃªn lÃ  Anna"
          </div>

          <div class="sentence-builder-area" id="sentenceDropZone">
            <p style="color: #999">KÃ©o tá»« vÃ o Ä‘Ã¢y Ä‘á»ƒ táº¡o cÃ¢u...</p>
          </div>

          <div class="word-bank" id="wordBank">
            <!-- Words will be generated by JavaScript -->
          </div>

          <div id="sentenceFeedback" class="typing-feedback"></div>
        </div>

        <div class="score-display" id="sentenceScore" style="display: none">
          Äiá»ƒm ghÃ©p cÃ¢u: <span id="finalSentenceScore">0</span>/36
        </div>
      </div>
    </div>

    <!-- Back to Index Button -->
    <button
      class="back-to-index"
      id="backToIndex"
      onclick="window.history.back()"
    >
      ğŸ  Vá» trang chá»§
    </button>

    <script>
      // Vocabulary data for games - Äáº¦Y Äá»¦ 72 Tá»ª Vá»°NG BUá»”I 1
      const vocabulary = [
        // NHÃ“M 1: Cá»°C Ká»² QUAN TRá»ŒNG
        {
          german: "ich",
          pronunciation: "[Ã­ch]",
          vietnamese: "tÃ´i",
          category: "SiÃªu quan trá»ng",
        },
        {
          german: "bin",
          pronunciation: "[bin]",
          vietnamese: "lÃ ",
          category: "SiÃªu quan trá»ng",
        },
        {
          german: "ist",
          pronunciation: "[Ã­t]",
          vietnamese: "lÃ ",
          category: "SiÃªu quan trá»ng",
        },
        {
          german: "heiÃŸe",
          pronunciation: "[hai-sÆ¡]",
          vietnamese: "tÃªn lÃ ",
          category: "SiÃªu quan trá»ng",
        },
        {
          german: "Hallo",
          pronunciation: "[ha-lÃ´]",
          vietnamese: "xin chÃ o",
          category: "SiÃªu quan trá»ng",
        },
        {
          german: "Guten Tag",
          pronunciation: "[gu-ten tÃ¡c]",
          vietnamese: "chÃ o buá»•i chiá»u",
          category: "SiÃªu quan trá»ng",
        },
        {
          german: "TschÃ¼s",
          pronunciation: "[chÃºy-s]",
          vietnamese: "táº¡m biá»‡t (thÃ¢n máº­t)",
          category: "SiÃªu quan trá»ng",
        },
        {
          german: "komme",
          pronunciation: "[cÃ´-mÆ¡]",
          vietnamese: "Ä‘áº¿n / Ä‘áº¿n tá»«",
          category: "SiÃªu quan trá»ng",
        },
        {
          german: "spreche",
          pronunciation: "[spre-xe]",
          vietnamese: "nÃ³i (ngÃ´n ngá»¯)",
          category: "SiÃªu quan trá»ng",
        },

        // NHÃ“M 2: QUAN TRá»ŒNG
        {
          german: "aus",
          pronunciation: "[aus]",
          vietnamese: "tá»«",
          category: "Quan trá»ng",
        },
        {
          german: "und",
          pronunciation: "[unt]",
          vietnamese: "vÃ ",
          category: "Quan trá»ng",
        },
        {
          german: "ein bisschen",
          pronunciation: "[ain bÃ­-sÆ¡n]",
          vietnamese: "má»™t chÃºt",
          category: "Quan trá»ng",
        },
        {
          german: "mein",
          pronunciation: "[main]",
          vietnamese: "cá»§a tÃ´i",
          category: "Quan trá»ng",
        },
        {
          german: "meine",
          pronunciation: "[mai-nÆ¡]",
          vietnamese: "cá»§a tÃ´i",
          category: "Quan trá»ng",
        },
        {
          german: "Name",
          pronunciation: "[na-mÆ¡]",
          vietnamese: "tÃªn",
          category: "Quan trá»ng",
        },
        {
          german: "ja",
          pronunciation: "[ya]",
          vietnamese: "cÃ³",
          category: "Quan trá»ng",
        },
        {
          german: "nein",
          pronunciation: "[nain]",
          vietnamese: "khÃ´ng",
          category: "Quan trá»ng",
        },
        {
          german: "okay",
          pronunciation: "[Ã´-kÃ¢y]",
          vietnamese: "Ä‘Æ°á»£c rá»“i",
          category: "Quan trá»ng",
        },
        {
          german: "bitte",
          pronunciation: "[bi-tÆ¡]",
          vietnamese: "lÃ m Æ¡n / xin má»i",
          category: "Quan trá»ng",
        },

        // NHÃ“M 3: QUá»C GIA & NGÃ”N NGá»®
        {
          german: "Deutschland",
          pronunciation: "[ÄÃ³i-t-lant]",
          vietnamese: "nÆ°á»›c Äá»©c",
          category: "Quá»‘c gia",
        },
        {
          german: "Englisch",
          pronunciation: "[Ã‰ng-lÃ­t]",
          vietnamese: "tiáº¿ng Anh",
          category: "NgÃ´n ngá»¯",
        },
        {
          german: "Polen",
          pronunciation: "[PÃ´-len]",
          vietnamese: "Ba Lan",
          category: "Quá»‘c gia",
        },
        {
          german: "Polnisch",
          pronunciation: "[PÃ´l-nÃ­t]",
          vietnamese: "tiáº¿ng Ba Lan",
          category: "NgÃ´n ngá»¯",
        },
        {
          german: "Spanisch",
          pronunciation: "[Shpa-nÃ­t]",
          vietnamese: "tiáº¿ng TÃ¢y Ban Nha",
          category: "NgÃ´n ngá»¯",
        },

        // NHÃ“M 4: GIA ÄÃŒNH & NGÆ¯á»œI
        {
          german: "Mama",
          pronunciation: "[Ma-ma]",
          vietnamese: "máº¹",
          category: "Gia Ä‘Ã¬nh",
        },
        {
          german: "Opa",
          pronunciation: "[Ã”-pa]",
          vietnamese: "Ã´ng",
          category: "Gia Ä‘Ã¬nh",
        },
        {
          german: "du",
          pronunciation: "[du]",
          vietnamese: "báº¡n",
          category: "NgÆ°á»i",
        },

        // NHÃ“M 5: Tá»ª Há»I & LIÃŠN Káº¾T
        {
          german: "Wie",
          pronunciation: "[vÃ¬]",
          vietnamese: "nhÆ° tháº¿ nÃ o / lÃ m sao",
          category: "Tá»« há»i",
        },
        {
          german: "Woher",
          pronunciation: "[vÃ´-he]",
          vietnamese: "tá»« Ä‘Ã¢u",
          category: "Tá»« há»i",
        },
        {
          german: "Was",
          pronunciation: "[vÃ¡t]",
          vietnamese: "cÃ¡i gÃ¬",
          category: "Tá»« há»i",
        },
        {
          german: "oder",
          pronunciation: "[Ã´-Ä‘Æ¡]",
          vietnamese: "hoáº·c",
          category: "LiÃªn tá»«",
        },
        {
          german: "Auf Wiedersehen",
          pronunciation: "[auf vÃ¬-Ä‘Æ¡-ze-en]",
          vietnamese: "táº¡m biá»‡t (trang trá»ng)",
          category: "ChÃ o há»i",
        },
        {
          german: "doch",
          pronunciation: "[Ä‘á»t]",
          vietnamese: "tháº­t ra / mÃ ",
          category: "Tá»« liÃªn káº¿t",
        },

        // NHÃ“M 6: TÃNH Tá»ª & MÃ” Táº¢
        {
          german: "ganz",
          pronunciation: "[gÃ¡nt]",
          vietnamese: "hoÃ n toÃ n / ráº¥t",
          category: "TÃ­nh tá»«",
        },
        {
          german: "einfach",
          pronunciation: "[ain-fÃ¡t]",
          vietnamese: "Ä‘Æ¡n giáº£n",
          category: "TÃ­nh tá»«",
        },
        {
          german: "super",
          pronunciation: "[zu-pe]",
          vietnamese: "tuyá»‡t vá»i",
          category: "TÃ­nh tá»«",
        },
        {
          german: "gut",
          pronunciation: "[gut]",
          vietnamese: "tá»‘t",
          category: "TÃ­nh tá»«",
        },
        {
          german: "richtig",
          pronunciation: "[rÃ­t-tÃ­t]",
          vietnamese: "Ä‘Ãºng",
          category: "TÃ­nh tá»«",
        },

        // NHÃ“M 7: Sá» Äáº¾M & THá»œI GIAN
        {
          german: "eins",
          pronunciation: "[ains]",
          vietnamese: "má»™t",
          category: "Sá»‘ Ä‘áº¿m",
        },
        {
          german: "zwei",
          pronunciation: "[tsvai]",
          vietnamese: "hai",
          category: "Sá»‘ Ä‘áº¿m",
        },
        {
          german: "drei",
          pronunciation: "[Ä‘rai]",
          vietnamese: "ba",
          category: "Sá»‘ Ä‘áº¿m",
        },
        {
          german: "zuerst",
          pronunciation: "[tsu-e-á»›t]",
          vietnamese: "trÆ°á»›c tiÃªn",
          category: "Thá»i gian",
        },
        {
          german: "nochmal",
          pronunciation: "[ná»t-mal]",
          vietnamese: "má»™t láº§n ná»¯a",
          category: "Thá»i gian",
        },

        // NHÃ“M 8: Cáº¢M TÃN & Äá»˜NG Tá»ª
        {
          german: "Oh",
          pronunciation: "[Ã´]",
          vietnamese: "Ã´i",
          category: "Cáº£m thÃ¡n",
        },
        {
          german: "Hey",
          pronunciation: "[hÃ¢y]",
          vietnamese: "nÃ y",
          category: "Cáº£m thÃ¡n",
        },
        {
          german: "Ach",
          pronunciation: "[Ã¡t]",
          vietnamese: "Ã´i / thÃ´i nÃ o",
          category: "Cáº£m thÃ¡n",
        },
        {
          german: "Na los",
          pronunciation: "[na lÃ´t]",
          vietnamese: "nÃ o thÃ´i",
          category: "Cáº£m thÃ¡n",
        },
        {
          german: "komm",
          pronunciation: "[cá»m]",
          vietnamese: "Ä‘áº¿n / thÃ´i nÃ o",
          category: "Äá»™ng tá»«",
        },
        {
          german: "hast",
          pronunciation: "[hÃ¡t]",
          vietnamese: "cÃ³ / Ä‘Ã£ (vá»›i du)",
          category: "Äá»™ng tá»«",
        },
        {
          german: "vergessen",
          pronunciation: "[fe-gÃ©-sÆ¡n]",
          vietnamese: "quÃªn",
          category: "Äá»™ng tá»«",
        },

        // NHÃ“M 9: Tá»ª Há»– TRá»¢ & THá»œI GIAN
        {
          german: "das",
          pronunciation: "[Ä‘Ã¡t]",
          vietnamese: "Ä‘iá»u Ä‘Ã³ / cÃ¡i Ä‘Ã³",
          category: "Tá»« chá»‰ Ä‘á»‹nh",
        },
        {
          german: "dann",
          pronunciation: "[Ä‘Ã¡n]",
          vietnamese: "sau Ä‘Ã³ / rá»“i",
          category: "Thá»i gian",
        },
        {
          german: "jetzt",
          pronunciation: "[yÃ©t]",
          vietnamese: "bÃ¢y giá»",
          category: "Thá»i gian",
        },
        {
          german: "hier",
          pronunciation: "[hia]",
          vietnamese: "Ä‘Ã¢y / á»Ÿ Ä‘Ã¢y",
          category: "NÆ¡i chá»‘n",
        },

        // NHÃ“M 10: CÃ‚U Cáº¢M THÃN & KHÃC
        {
          german: "Ã„hm",
          pronunciation: "[Æ¡m]",
          vietnamese: "á»«m (do dá»±)",
          category: "Cáº£m thÃ¡n",
        },
        {
          german: "Puh",
          pronunciation: "[puh]",
          vietnamese: "phÃ¹ (thá»Ÿ phÃ o)",
          category: "Cáº£m thÃ¡n",
        },
        {
          german: "Halli hallo",
          pronunciation: "[ha-li ha-lÃ´]",
          vietnamese: "chÃ o chÃ o (vui váº»)",
          category: "ChÃ o há»i",
        },
        {
          german: "tut mir leid",
          pronunciation: "[tut mia lait]",
          vietnamese: "xin lá»—i",
          category: "Lá»‹ch sá»±",
        },
        {
          german: "Keine Zeit",
          pronunciation: "[kai-nÆ¡ tsait]",
          vietnamese: "khÃ´ng cÃ³ thá»i gian",
          category: "Tá»« chá»‘i",
        },
        {
          german: "Mach's",
          pronunciation: "[mÃ¡t]",
          vietnamese: "lÃ m Ä‘i (rÃºt gá»n cá»§a mach es)",
          category: "Äá»™ng tá»«",
        },

        // NHÃ“M 11: TÃŠN RIÃŠNG
        {
          german: "Lara",
          pronunciation: "[La-ra]",
          vietnamese: "Lara (tÃªn ngÆ°á»i)",
          category: "TÃªn riÃªng",
        },
        {
          german: "Walter",
          pronunciation: "[Val-te]",
          vietnamese: "Walter (tÃªn ngÆ°á»i)",
          category: "TÃªn riÃªng",
        },
        {
          german: "Sofia",
          pronunciation: "[Zo-fi-a]",
          vietnamese: "Sofia (tÃªn ngÆ°á»i)",
          category: "TÃªn riÃªng",
        },

        // NHÃ“M 12: Tá»ª Vá»°NG Há»ŒC Táº¬P & HOáº T Äá»˜NG
        {
          german: "sehen",
          pronunciation: "[ze-en]",
          vietnamese: "nhÃ¬n / xem",
          category: "Hoáº¡t Ä‘á»™ng",
        },
        {
          german: "Sie",
          pronunciation: "[zi]",
          vietnamese: "há» / báº¡n (trang trá»ng)",
          category: "Äáº¡i tá»«",
        },
        {
          german: "die",
          pronunciation: "[di]",
          vietnamese: "nhá»¯ng / cÃ¡c (máº¡o tá»«)",
          category: "Máº¡o tá»«",
        },
        {
          german: "Fotos",
          pronunciation: "[fÃ´-tÃ´t]",
          vietnamese: "nhá»¯ng bá»©c áº£nh",
          category: "Äá»“ váº­t",
        },
        {
          german: "an",
          pronunciation: "[an]",
          vietnamese: "táº¡i / á»Ÿ / xem",
          category: "Giá»›i tá»«",
        },
        {
          german: "hÃ¶ren",
          pronunciation: "[hÃ¶-ren]",
          vietnamese: "nghe",
          category: "Hoáº¡t Ä‘á»™ng",
        },
        {
          german: "noch einmal",
          pronunciation: "[ná»t ain-mal]",
          vietnamese: "má»™t láº§n ná»¯a",
          category: "Thá»i gian",
        },
        {
          german: "kreuzen",
          pronunciation: "[kroy-tsen]",
          vietnamese: "Ä‘Ã¡nh dáº¥u X",
          category: "Hoáº¡t Ä‘á»™ng",
        },

        // CÃC Tá»ª Bá»” SUNG
        {
          german: "So",
          pronunciation: "[zÃ´]",
          vietnamese: "váº­y / nhÆ° tháº¿",
          category: "Tá»« liÃªn káº¿t",
        },
        {
          german: "aber",
          pronunciation: "[a-be]",
          vietnamese: "nhÆ°ng / thÃ¬",
          category: "LiÃªn tá»«",
        },
        {
          german: "noch",
          pronunciation: "[ná»t]",
          vietnamese: "cÃ²n / ná»¯a",
          category: "Tráº¡ng tá»«",
        },
        {
          german: "Also",
          pronunciation: "[an-zÃ´]",
          vietnamese: "váº­y thÃ¬",
          category: "Tá»« liÃªn káº¿t",
        },
        {
          german: "Foto",
          pronunciation: "[fÃ´-tÃ´]",
          vietnamese: "áº£nh / hÃ¬nh",
          category: "Äá»“ váº­t",
        },
        {
          german: "Wartet",
          pronunciation: "[va-tet]",
          vietnamese: "chá» Ä‘Ã£",
          category: "Äá»™ng tá»«",
        },
      ];

      // Sample sentences for sentence builder game
      const sampleSentences = [
        {
          german: ["ich", "heiÃŸe", "Anna"],
          vietnamese: "TÃ´i tÃªn lÃ  Anna",
          words: ["ich", "heiÃŸe", "Anna", "bin", "ist", "Name"],
        },
        {
          german: ["ich", "bin", "Student"],
          vietnamese: "TÃ´i lÃ  sinh viÃªn",
          words: ["ich", "bin", "Student", "ist", "heiÃŸe", "Name"],
        },
        {
          german: ["ich", "komme", "aus", "Deutschland"],
          vietnamese: "TÃ´i Ä‘áº¿n tá»« Äá»©c",
          words: ["ich", "komme", "aus", "Deutschland", "Polen", "spreche"],
        },
        {
          german: ["ich", "spreche", "Deutsch"],
          vietnamese: "TÃ´i nÃ³i tiáº¿ng Äá»©c",
          words: ["ich", "spreche", "Deutsch", "Englisch", "komme", "aus"],
        },
        {
          german: ["Hallo", "wie", "heiÃŸt", "du"],
          vietnamese: "Xin chÃ o, báº¡n tÃªn gÃ¬?",
          words: ["Hallo", "wie", "heiÃŸt", "du", "ich", "bin"],
        },
        {
          german: ["Guten", "Tag", "mein", "Name", "ist", "Peter"],
          vietnamese: "ChÃ o buá»•i chiá»u, tÃªn tÃ´i lÃ  Peter",
          words: [
            "Guten",
            "Tag",
            "mein",
            "Name",
            "ist",
            "Peter",
            "heiÃŸe",
            "ich",
          ],
        },
        {
          german: ["ich", "spreche", "ein", "bisschen", "Deutsch"],
          vietnamese: "TÃ´i nÃ³i má»™t chÃºt tiáº¿ng Äá»©c",
          words: [
            "ich",
            "spreche",
            "ein",
            "bisschen",
            "Deutsch",
            "gut",
            "super",
          ],
        },
        {
          german: ["woher", "kommst", "du"],
          vietnamese: "Báº¡n Ä‘áº¿n tá»« Ä‘Ã¢u?",
          words: ["woher", "kommst", "du", "ich", "komme", "aus"],
        },
        {
          german: ["das", "ist", "super"],
          vietnamese: "Äiá»u Ä‘Ã³ tháº­t tuyá»‡t",
          words: ["das", "ist", "super", "gut", "einfach", "richtig"],
        },
        {
          german: ["ja", "das", "ist", "richtig"],
          vietnamese: "VÃ¢ng, Ä‘iá»u Ä‘Ã³ Ä‘Ãºng",
          words: ["ja", "das", "ist", "richtig", "nein", "okay"],
        },
        {
          german: ["nein", "das", "ist", "falsch"],
          vietnamese: "KhÃ´ng, Ä‘iá»u Ä‘Ã³ sai",
          words: ["nein", "das", "ist", "falsch", "richtig", "ja"],
        },
        {
          german: ["ich", "bin", "aus", "Vietnam"],
          vietnamese: "TÃ´i Ä‘áº¿n tá»« Viá»‡t Nam",
          words: ["ich", "bin", "aus", "Vietnam", "Deutschland", "komme"],
        },
        {
          german: ["mein", "Name", "ist", "Maria"],
          vietnamese: "TÃªn tÃ´i lÃ  Maria",
          words: ["mein", "Name", "ist", "Maria", "ich", "heiÃŸe"],
        },
        {
          german: ["ich", "spreche", "Englisch", "und", "Deutsch"],
          vietnamese: "TÃ´i nÃ³i tiáº¿ng Anh vÃ  tiáº¿ng Äá»©c",
          words: [
            "ich",
            "spreche",
            "Englisch",
            "und",
            "Deutsch",
            "oder",
            "Spanisch",
          ],
        },
        {
          german: ["bitte", "sprechen", "Sie", "langsam"],
          vietnamese: "Xin hÃ£y nÃ³i cháº­m",
          words: ["bitte", "sprechen", "Sie", "langsam", "schnell", "gut"],
        },
        {
          german: ["Auf", "Wiedersehen", "bis", "morgen"],
          vietnamese: "Táº¡m biá»‡t, háº¹n gáº·p láº¡i ngÃ y mai",
          words: ["Auf", "Wiedersehen", "bis", "morgen", "heute", "TschÃ¼s"],
        },
        {
          german: ["das", "ist", "sehr", "gut"],
          vietnamese: "Äiá»u Ä‘Ã³ ráº¥t tá»‘t",
          words: ["das", "ist", "sehr", "gut", "super", "einfach"],
        },
        {
          german: ["ich", "verstehe", "das", "nicht"],
          vietnamese: "TÃ´i khÃ´ng hiá»ƒu Ä‘iá»u Ä‘Ã³",
          words: ["ich", "verstehe", "das", "nicht", "gut", "spreche"],
        },
        {
          german: ["wie", "alt", "bist", "du"],
          vietnamese: "Báº¡n bao nhiÃªu tuá»•i?",
          words: ["wie", "alt", "bist", "du", "ich", "bin"],
        },
        {
          german: ["ich", "bin", "zwanzig", "Jahre", "alt"],
          vietnamese: "TÃ´i hai mÆ°Æ¡i tuá»•i",
          words: ["ich", "bin", "zwanzig", "Jahre", "alt", "jung"],
        },
        {
          german: ["wo", "wohnst", "du"],
          vietnamese: "Báº¡n sá»‘ng á»Ÿ Ä‘Ã¢u?",
          words: ["wo", "wohnst", "du", "ich", "wohne", "hier"],
        },
        {
          german: ["ich", "wohne", "in", "Berlin"],
          vietnamese: "TÃ´i sá»‘ng á»Ÿ Berlin",
          words: ["ich", "wohne", "in", "Berlin", "MÃ¼nchen", "Hamburg"],
        },
        {
          german: ["was", "machst", "du"],
          vietnamese: "Báº¡n lÃ m gÃ¬?",
          words: ["was", "machst", "du", "ich", "arbeite", "studiere"],
        },
        {
          german: ["ich", "bin", "Lehrer"],
          vietnamese: "TÃ´i lÃ  giÃ¡o viÃªn",
          words: ["ich", "bin", "Lehrer", "Student", "Arzt", "Koch"],
        },
        {
          german: ["es", "freut", "mich"],
          vietnamese: "TÃ´i ráº¥t vui",
          words: ["es", "freut", "mich", "dich", "sehr", "gut"],
        },
        {
          german: ["haben", "Sie", "Zeit"],
          vietnamese: "Báº¡n cÃ³ thá»i gian khÃ´ng?",
          words: ["haben", "Sie", "Zeit", "ich", "habe", "keine"],
        },
        {
          german: ["ja", "ich", "habe", "Zeit"],
          vietnamese: "VÃ¢ng, tÃ´i cÃ³ thá»i gian",
          words: ["ja", "ich", "habe", "Zeit", "keine", "nein"],
        },
        {
          german: ["entschuldigung", "wo", "ist", "das"],
          vietnamese: "Xin lá»—i, cÃ¡i Ä‘Ã³ á»Ÿ Ä‘Ã¢u?",
          words: ["entschuldigung", "wo", "ist", "das", "hier", "dort"],
        },
        {
          german: ["vielen", "Dank", "fÃ¼r", "alles"],
          vietnamese: "Cáº£m Æ¡n nhiá»u vÃ¬ táº¥t cáº£",
          words: ["vielen", "Dank", "fÃ¼r", "alles", "nichts", "bitte"],
        },
        {
          german: ["gern", "geschehen", "bitte", "schÃ¶n"],
          vietnamese: "KhÃ´ng cÃ³ gÃ¬, xin má»i",
          words: ["gern", "geschehen", "bitte", "schÃ¶n", "Dank", "sehr"],
        },
        {
          german: ["heute", "ist", "ein", "schÃ¶ner", "Tag"],
          vietnamese: "HÃ´m nay lÃ  má»™t ngÃ y Ä‘áº¹p",
          words: ["heute", "ist", "ein", "schÃ¶ner", "Tag", "morgen"],
        },
        {
          german: ["ich", "lerne", "Deutsch", "gern"],
          vietnamese: "TÃ´i thÃ­ch há»c tiáº¿ng Äá»©c",
          words: ["ich", "lerne", "Deutsch", "gern", "nicht", "spreche"],
        },
        {
          german: ["kÃ¶nnen", "Sie", "mir", "helfen"],
          vietnamese: "Báº¡n cÃ³ thá»ƒ giÃºp tÃ´i khÃ´ng?",
          words: ["kÃ¶nnen", "Sie", "mir", "helfen", "ich", "kann"],
        },
        {
          german: ["natÃ¼rlich", "kann", "ich", "helfen"],
          vietnamese: "Táº¥t nhiÃªn tÃ´i cÃ³ thá»ƒ giÃºp",
          words: ["natÃ¼rlich", "kann", "ich", "helfen", "nicht", "gern"],
        },
        {
          german: ["das", "macht", "nichts"],
          vietnamese: "KhÃ´ng sao cáº£",
          words: ["das", "macht", "nichts", "alles", "gut", "okay"],
        },
        {
          german: ["bis", "bald", "auf", "Wiedersehen"],
          vietnamese: "Háº¹n gáº·p láº¡i sá»›m, táº¡m biá»‡t",
          words: ["bis", "bald", "auf", "Wiedersehen", "morgen", "heute"],
        },
      ];

      let currentGameData = {};
      let audioSupported = false;
      let audioEnabled = false;

      // Test audio support
      function testAudioSupport() {
        try {
          if ("speechSynthesis" in window) {
            // Test if voices are available
            const voices = speechSynthesis.getVoices();
            const germanVoice = voices.find((voice) =>
              voice.lang.startsWith("de")
            );
            audioSupported = germanVoice ? true : false;
          }
        } catch (error) {
          audioSupported = false;
        }
      }

      // Show audio activation modal for mobile
      function checkMobileAudio() {
        if (
          /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
            navigator.userAgent
          )
        ) {
          document.getElementById("audioModal").style.display = "flex";
        } else {
          audioEnabled = true;
        }
      }

      // Enable audio function
      function enableAudio() {
        // Try to play a silent audio to enable audio context
        const audioContext = new (window.AudioContext ||
          window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        oscillator.type = "sine";
        oscillator.frequency.setValueAtTime(1, audioContext.currentTime); // Almost silent
        oscillator.connect(audioContext.destination);
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.1);

        audioEnabled = true;
        document.getElementById("audioModal").style.display = "none";

        // Test Web Speech API
        testAudioSupport();
      }

      // Enhanced audio function with fallback
      function speakGerman(text, fallbackElement = null) {
        if (!audioEnabled) {
          // Show visual fallback
          if (fallbackElement) {
            const word = vocabulary.find((w) => w.german === text);
            if (word) {
              fallbackElement.style.display = "block";
              fallbackElement.querySelector(
                ".pronunciation-display"
              ).textContent = `${word.german} ${word.pronunciation}`;
            }
          }
          return;
        }

        if (!audioSupported || !("speechSynthesis" in window)) {
          // Show visual fallback
          if (fallbackElement) {
            const word = vocabulary.find((w) => w.german === text);
            if (word) {
              fallbackElement.style.display = "block";
              fallbackElement.querySelector(
                ".pronunciation-display"
              ).textContent = `${word.german} ${word.pronunciation}`;
            }
          }
          return;
        }

        try {
          // Cancel any ongoing speech
          speechSynthesis.cancel();

          const utterance = new SpeechSynthesisUtterance(text);
          const voices = speechSynthesis.getVoices();

          // Try to find German voice
          const germanVoice = voices.find(
            (voice) =>
              voice.lang.startsWith("de") ||
              voice.name.toLowerCase().includes("german")
          );

          if (germanVoice) {
            utterance.voice = germanVoice;
          }

          utterance.lang = "de-DE";
          utterance.rate = 0.7;
          utterance.pitch = 1;
          utterance.volume = 1;

          // Hide fallback if audio works
          if (fallbackElement) {
            fallbackElement.style.display = "none";
          }

          speechSynthesis.speak(utterance);
        } catch (error) {
          console.log("Audio error:", error);
          // Show fallback on error
          if (fallbackElement) {
            const word = vocabulary.find((w) => w.german === text);
            if (word) {
              fallbackElement.style.display = "block";
              fallbackElement.querySelector(
                ".pronunciation-display"
              ).textContent = `${word.german} ${word.pronunciation}`;
            }
          }
        }
      }

      // Initialize audio on page load
      window.addEventListener("load", () => {
        testAudioSupport();
        checkMobileAudio();

        // Re-test after voices are loaded
        if ("speechSynthesis" in window) {
          speechSynthesis.addEventListener("voiceschanged", () => {
            testAudioSupport();
          });
        }
      });

      // Back to index button visibility
      const backToIndexBtn = document.getElementById("backToIndex");

      window.addEventListener("scroll", () => {
        if (window.scrollY > 300) {
          backToIndexBtn.classList.add("visible");
        } else {
          backToIndexBtn.classList.remove("visible");
        }
      });

      // Game control functions
      function startGame(gameType) {
        if (
          !audioEnabled &&
          (gameType === "listening" ||
            gameType === "typing" ||
            gameType === "speedtest")
        ) {
          document.getElementById("audioModal").style.display = "flex";
          return;
        }

        document.getElementById("gameMenu").style.display = "none";
        document
          .querySelectorAll(".game-area")
          .forEach((area) => area.classList.remove("active"));

        switch (gameType) {
          case "flashcards":
            document.getElementById("flashcardsGame").classList.add("active");
            initFlashcards();
            break;
          case "memory":
            document.getElementById("memoryGame").classList.add("active");
            initMemoryGame();
            break;
          case "quiz":
            document.getElementById("quizGame").classList.add("active");
            initQuizGame();
            break;
          case "listening":
            document.getElementById("listeningGame").classList.add("active");
            initListeningGame();
            break;
          case "category":
            document.getElementById("categoryGame").classList.add("active");
            initCategoryGame();
            break;
          case "typing":
            document.getElementById("typingGame").classList.add("active");
            initTypingGame();
            break;
          case "speedtest":
            document.getElementById("speedtestGame").classList.add("active");
            initSpeedTest();
            break;
          case "wordbuilder":
            document.getElementById("wordbuilderGame").classList.add("active");
            initWordBuilder();
            break;
          case "sentencebuilder":
            document
              .getElementById("sentencebuilderGame")
              .classList.add("active");
            initSentenceBuilder();
            break;
        }
      }

      function backToMenu() {
        // Stop any ongoing speech
        if ("speechSynthesis" in window) {
          speechSynthesis.cancel();
        }

        // Clear any timers
        if (currentGameData.speedTest && currentGameData.speedTest.timer) {
          clearInterval(currentGameData.speedTest.timer);
        }

        document
          .querySelectorAll(".game-area")
          .forEach((area) => area.classList.remove("active"));
        document.getElementById("gameMenu").style.display = "grid";
      }

      // Flashcards Game
      function initFlashcards() {
        currentGameData.flashcards = {
          currentIndex: 0,
          cards: vocabulary,
          isFlipped: false,
        };

        document.getElementById("totalCards").textContent =
          currentGameData.flashcards.cards.length;
        showFlashcard();
      }

      function showFlashcard() {
        const data = currentGameData.flashcards;
        const card = data.cards[data.currentIndex];

        document.getElementById("currentCard").textContent =
          data.currentIndex + 1;
        document.getElementById("cardContent").textContent = card.german;
        document.getElementById("cardPronunciation").textContent =
          card.pronunciation;
        document.getElementById("cardTranslation").textContent =
          card.vietnamese;

        // Reset card state
        document.getElementById("flashcard").classList.remove("flipped");
        document.getElementById("cardTranslation").style.display = "none";
        data.isFlipped = false;
      }

      function flipCard() {
        const data = currentGameData.flashcards;
        const flashcard = document.getElementById("flashcard");
        const translation = document.getElementById("cardTranslation");

        if (!data.isFlipped) {
          flashcard.classList.add("flipped");
          translation.style.display = "block";
          data.isFlipped = true;
        }
      }

      function nextCard() {
        const data = currentGameData.flashcards;
        if (data.currentIndex < data.cards.length - 1) {
          data.currentIndex++;
          showFlashcard();
        }
      }

      function prevCard() {
        const data = currentGameData.flashcards;
        if (data.currentIndex > 0) {
          data.currentIndex--;
          showFlashcard();
        }
      }

      // Memory Game - Updated to handle 72 words
      function initMemoryGame() {
        // Take 36 words for 36 pairs (72 cards total)
        const selectedWords = vocabulary.slice(0, 36);

        const memoryCards = [];

        // Create pairs (German word + Vietnamese meaning)
        selectedWords.forEach((word) => {
          memoryCards.push({
            type: "german",
            content: word.german,
            id: word.german,
          });
          memoryCards.push({
            type: "vietnamese",
            content: word.vietnamese,
            id: word.german,
          });
        });

        // Shuffle cards
        for (let i = memoryCards.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [memoryCards[i], memoryCards[j]] = [memoryCards[j], memoryCards[i]];
        }

        currentGameData.memory = {
          cards: memoryCards,
          flippedCards: [],
          matchedPairs: 0,
          moves: 0,
          score: 0,
        };

        renderMemoryGrid();
      }

      function renderMemoryGrid() {
        const grid = document.getElementById("memoryGrid");
        grid.innerHTML = "";

        currentGameData.memory.cards.forEach((card, index) => {
          const cardElement = document.createElement("div");
          cardElement.className = "memory-card";
          cardElement.innerHTML = `<div class="memory-card-content">?</div>`;
          cardElement.onclick = () => flipMemoryCard(index);
          grid.appendChild(cardElement);
        });
      }

      function flipMemoryCard(index) {
        const data = currentGameData.memory;

        if (data.flippedCards.length === 2 || data.flippedCards.includes(index))
          return;

        const cardElement = document.querySelectorAll(".memory-card")[index];
        const card = data.cards[index];

        cardElement.classList.add("flipped");
        cardElement.querySelector(".memory-card-content").textContent =
          card.content;
        data.flippedCards.push(index);

        if (data.flippedCards.length === 2) {
          data.moves++;
          document.getElementById("memoryMoves").textContent = data.moves;

          setTimeout(() => checkMemoryMatch(), 1000);
        }
      }

      function checkMemoryMatch() {
        const data = currentGameData.memory;
        const [first, second] = data.flippedCards;
        const firstCard = data.cards[first];
        const secondCard = data.cards[second];

        if (firstCard.id === secondCard.id) {
          // Match found
          document
            .querySelectorAll(".memory-card")
            [first].classList.add("matched");
          document
            .querySelectorAll(".memory-card")
            [second].classList.add("matched");
          data.matchedPairs++;
          data.score += 10;

          document.getElementById("memoryPairs").textContent =
            data.matchedPairs;

          if (data.matchedPairs === 36) {
            setTimeout(
              () => alert("ğŸ‰ ChÃºc má»«ng! Báº¡n Ä‘Ã£ hoÃ n thÃ nh trÃ² chÆ¡i!"),
              500
            );
          }
        } else {
          // No match
          const firstElement = document.querySelectorAll(".memory-card")[first];
          const secondElement =
            document.querySelectorAll(".memory-card")[second];

          firstElement.classList.remove("flipped");
          secondElement.classList.remove("flipped");
          firstElement.querySelector(".memory-card-content").textContent = "?";
          secondElement.querySelector(".memory-card-content").textContent = "?";
        }

        document.getElementById("memoryScore").textContent = data.score;
        data.flippedCards = [];
      }

      function resetMemory() {
        initMemoryGame();
        document.getElementById("memoryScore").textContent = "0";
        document.getElementById("memoryMoves").textContent = "0";
        document.getElementById("memoryPairs").textContent = "0";
      }

      // Quiz Game - Updated to use all 72 words
      function initQuizGame() {
        const questions = [];

        vocabulary.forEach((word) => {
          const wrongAnswers = vocabulary
            .filter((w) => w.vietnamese !== word.vietnamese)
            .sort(() => Math.random() - 0.5)
            .slice(0, 3)
            .map((w) => w.vietnamese);

          const options = [word.vietnamese, ...wrongAnswers].sort(
            () => Math.random() - 0.5
          );

          questions.push({
            question: `Tá»« "${word.german}" cÃ³ nghÄ©a lÃ  gÃ¬?`,
            options: options,
            correct: word.vietnamese,
          });
        });

        // Shuffle questions
        questions.sort(() => Math.random() - 0.5);

        currentGameData.quiz = {
          questions: questions,
          currentIndex: 0,
          score: 0,
          answered: false,
        };

        document.getElementById("totalQuestions").textContent =
          questions.length;
        showQuizQuestion();
      }

      function showQuizQuestion() {
        const data = currentGameData.quiz;
        const question = data.questions[data.currentIndex];

        document.getElementById("currentQuestion").textContent =
          data.currentIndex + 1;
        document.getElementById("questionText").textContent = question.question;

        const optionsContainer = document.getElementById("quizOptions");
        optionsContainer.innerHTML = "";

        question.options.forEach((option) => {
          const optionElement = document.createElement("div");
          optionElement.className = "quiz-option";
          optionElement.textContent = option;
          optionElement.onclick = () =>
            selectQuizOption(option, question.correct);
          optionsContainer.appendChild(optionElement);
        });

        data.answered = false;
        document.getElementById("nextBtn").style.display = "none";
      }

      function selectQuizOption(selected, correct) {
        if (currentGameData.quiz.answered) return;

        currentGameData.quiz.answered = true;

        document.querySelectorAll(".quiz-option").forEach((option) => {
          if (option.textContent === correct) {
            option.classList.add("correct");
          } else if (option.textContent === selected && selected !== correct) {
            option.classList.add("wrong");
          }
        });

        if (selected === correct) {
          currentGameData.quiz.score++;
        }

        setTimeout(() => {
          document.getElementById("nextBtn").style.display = "inline-block";
        }, 1000);
      }

      function nextQuestion() {
        const data = currentGameData.quiz;

        if (data.currentIndex < data.questions.length - 1) {
          data.currentIndex++;
          showQuizQuestion();
        } else {
          // Show final score
          document.getElementById("quizQuestion").style.display = "none";
          document.getElementById("nextBtn").style.display = "none";
          document.getElementById("quizScore").style.display = "block";
          document.getElementById("finalScore").textContent = data.score;
        }
      }

      // Listening Game - Updated to use all 72 words
      function initListeningGame() {
        // Shuffle all vocabulary words
        const shuffledWords = [...vocabulary].sort(() => Math.random() - 0.5);

        currentGameData.listening = {
          words: shuffledWords,
          currentIndex: 0,
          score: 0,
          answered: false,
        };

        document.getElementById("totalListening").textContent =
          shuffledWords.length;
        showListeningQuestion();
      }

      function showListeningQuestion() {
        const data = currentGameData.listening;
        const word = data.words[data.currentIndex];

        document.getElementById("currentListening").textContent =
          data.currentIndex + 1;

        // Create wrong answers
        const wrongAnswers = vocabulary
          .filter((w) => w.vietnamese !== word.vietnamese)
          .sort(() => Math.random() - 0.5)
          .slice(0, 3)
          .map((w) => w.vietnamese);

        const options = [word.vietnamese, ...wrongAnswers].sort(
          () => Math.random() - 0.5
        );

        const optionsContainer = document.getElementById("listeningOptions");
        optionsContainer.innerHTML = "";

        options.forEach((option) => {
          const optionElement = document.createElement("div");
          optionElement.className = "quiz-option";
          optionElement.textContent = option;
          optionElement.onclick = () =>
            selectListeningOption(option, word.vietnamese);
          optionsContainer.appendChild(optionElement);
        });

        data.answered = false;
        document.getElementById("nextListeningBtn").style.display = "none";

        // Auto play audio with fallback
        setTimeout(() => playAudio(), 500);
      }

      function playAudio() {
        const data = currentGameData.listening;
        const word = data.words[data.currentIndex];
        const fallbackElement = document.getElementById("audioFallback");

        speakGerman(word.german, fallbackElement);
      }

      function selectListeningOption(selected, correct) {
        if (currentGameData.listening.answered) return;

        currentGameData.listening.answered = true;

        document
          .querySelectorAll("#listeningOptions .quiz-option")
          .forEach((option) => {
            if (option.textContent === correct) {
              option.classList.add("correct");
            } else if (
              option.textContent === selected &&
              selected !== correct
            ) {
              option.classList.add("wrong");
            }
          });

        if (selected === correct) {
          currentGameData.listening.score++;
        }

        setTimeout(() => {
          document.getElementById("nextListeningBtn").style.display =
            "inline-block";
        }, 1000);
      }

      function nextListening() {
        const data = currentGameData.listening;

        if (data.currentIndex < data.words.length - 1) {
          data.currentIndex++;
          showListeningQuestion();
        } else {
          // Show final score
          document.querySelector(
            "#listeningGame .quiz-question"
          ).style.display = "none";
          document.getElementById("nextListeningBtn").style.display = "none";
          document.getElementById("listeningScore").style.display = "block";
          document.getElementById("finalListeningScore").textContent =
            data.score;
        }
      }

      // Category Game - Updated to use all 72 words
      function initCategoryGame() {
        // Get all unique categories
        const allCategories = [
          ...new Set(vocabulary.map((word) => word.category)),
        ];

        currentGameData.category = {
          categories: allCategories,
          words: [...vocabulary].sort(() => Math.random() - 0.5),
          score: 0,
          completed: [],
        };

        document.getElementById("remainingWords").textContent =
          vocabulary.length;
        renderCategoryGame();
      }

      function renderCategoryGame() {
        const container = document.getElementById("categoryContainer");
        container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    ${currentGameData.category.categories
                      .map(
                        (cat) => `
                        <div class="category-box" data-category="${cat}">
                            <h4>${cat}</h4>
                            <div class="category-content"></div>
                        </div>
                    `
                      )
                      .join("")}
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                    ${currentGameData.category.words
                      .map(
                        (word) => `
                        <div class="draggable-word" draggable="true" data-category="${word.category}">
                            ${word.german}
                        </div>
                    `
                      )
                      .join("")}
                </div>
            `;

        // Add drag and drop functionality
        addDragDropListeners();
      }

      function addDragDropListeners() {
        const draggableWords = document.querySelectorAll(".draggable-word");
        const categoryBoxes = document.querySelectorAll(".category-box");

        draggableWords.forEach((word) => {
          word.addEventListener("dragstart", (e) => {
            e.dataTransfer.setData("text/plain", word.textContent);
            e.dataTransfer.setData("category", word.dataset.category);
          });
        });

        categoryBoxes.forEach((box) => {
          box.addEventListener("dragover", (e) => {
            e.preventDefault();
            box.style.background = "#e3f2fd";
          });

          box.addEventListener("dragleave", () => {
            box.style.background = "#f9f9f9";
          });

          box.addEventListener("drop", (e) => {
            e.preventDefault();
            const word = e.dataTransfer.getData("text/plain");
            const wordCategory = e.dataTransfer.getData("category");
            const boxCategory = box.dataset.category;

            if (wordCategory === boxCategory) {
              // Correct!
              box.querySelector(
                ".category-content"
              ).innerHTML += `<span class="category-word">${word}</span>`;
              const wordElement = Array.from(
                document.querySelectorAll(".draggable-word")
              ).find((el) => el.textContent === word);
              if (wordElement) wordElement.remove();

              currentGameData.category.score += 10;
              document.getElementById("categoryScore").textContent =
                currentGameData.category.score;
              document.getElementById("remainingWords").textContent =
                document.querySelectorAll(".draggable-word").length;

              if (document.querySelectorAll(".draggable-word").length === 0) {
                setTimeout(
                  () =>
                    alert(
                      "ğŸ‰ ChÃºc má»«ng! Báº¡n Ä‘Ã£ phÃ¢n loáº¡i Ä‘Ãºng táº¥t cáº£ tá»« vá»±ng!"
                    ),
                  500
                );
              }
            } else {
              // Wrong!
              box.style.background = "#ffebee";
              setTimeout(() => {
                box.style.background = "#f9f9f9";
              }, 1000);
            }
          });
        });
      }

      function resetCategory() {
        initCategoryGame();
        document.getElementById("categoryScore").textContent = "0";
      }

      // Typing Game - Updated to use all 72 words
      function initTypingGame() {
        // Use all words, shuffle them
        const allWords = [...vocabulary].sort(() => Math.random() - 0.5);

        currentGameData.typing = {
          words: allWords,
          currentIndex: 0,
          score: 0,
          answered: false,
        };

        document.getElementById("totalTyping").textContent = allWords.length;
        showTypingQuestion();
      }

      function showTypingQuestion() {
        const data = currentGameData.typing;
        const word = data.words[data.currentIndex];

        document.getElementById("currentTyping").textContent =
          data.currentIndex + 1;
        document.getElementById("typingInput").value = "";
        document.getElementById("typingFeedback").innerHTML = "";
        document.getElementById("nextTypingBtn").style.display = "none";

        data.answered = false;

        // Auto play audio with fallback
        setTimeout(() => playTypingAudio(), 500);
      }

      function playTypingAudio() {
        const data = currentGameData.typing;
        const word = data.words[data.currentIndex];
        const fallbackElement = document.getElementById("typingAudioFallback");

        speakGerman(word.german, fallbackElement);
      }

      function checkTyping() {
        if (currentGameData.typing.answered) return;

        const data = currentGameData.typing;
        const word = data.words[data.currentIndex];
        const userInput = document
          .getElementById("typingInput")
          .value.trim()
          .toLowerCase();
        const correctAnswer = word.german.toLowerCase();

        data.answered = true;

        const feedback = document.getElementById("typingFeedback");

        if (userInput === correctAnswer) {
          feedback.innerHTML = `<span style="color: #4CAF50;">âœ… ÄÃºng rá»“i! "${word.german}" = ${word.vietnamese}</span>`;
          feedback.style.background = "#e8f5e8";
          data.score++;
        } else {
          feedback.innerHTML = `<span style="color: #f44336;">âŒ Sai rá»“i! ÄÃ¡p Ã¡n Ä‘Ãºng: "${word.german}" = ${word.vietnamese}</span>`;
          feedback.style.background = "#ffebee";
        }

        setTimeout(() => {
          document.getElementById("nextTypingBtn").style.display =
            "inline-block";
        }, 2000);
      }

      function nextTyping() {
        const data = currentGameData.typing;

        if (data.currentIndex < data.words.length - 1) {
          data.currentIndex++;
          showTypingQuestion();
        } else {
          // Show final score
          document.querySelector("#typingGame .quiz-question").style.display =
            "none";
          document.getElementById("nextTypingBtn").style.display = "none";
          document.getElementById("typingScore").style.display = "block";
          document.getElementById("finalTypingScore").textContent = data.score;
        }
      }

      // Speed Test Game - NEW GAME
      function initSpeedTest() {
        currentGameData.speedTest = {
          words: [...vocabulary].sort(() => Math.random() - 0.5),
          currentIndex: 0,
          score: 0,
          correct: 0,
          wrong: 0,
          timeLeft: 60,
          timer: null,
          gameActive: false,
        };

        document.getElementById("speedTestWord").textContent =
          "Nháº¥n 'Báº¯t Ä‘áº§u' Ä‘á»ƒ chÆ¡i!";
        document.getElementById("speedTestOptions").style.display = "none";
        document.getElementById("speedStartBtn").style.display = "inline-block";
        document.getElementById("speedResetBtn").style.display = "none";
        document.getElementById("speedTestStatus").textContent =
          "Sáºµn sÃ ng báº¯t Ä‘áº§u?";

        updateSpeedTestStats();
      }

      function startSpeedTest() {
        const data = currentGameData.speedTest;
        data.gameActive = true;
        data.timeLeft = 60;
        data.currentIndex = 0;

        document.getElementById("speedStartBtn").style.display = "none";
        document.getElementById("speedTestStatus").textContent =
          "Tráº£ lá»i nhanh nháº¥t cÃ³ thá»ƒ!";

        // Start timer
        data.timer = setInterval(() => {
          data.timeLeft--;
          document.getElementById("speedTime").textContent = data.timeLeft;

          if (data.timeLeft <= 0) {
            endSpeedTest();
          }
        }, 1000);

        showSpeedTestWord();
      }

      function showSpeedTestWord() {
        const data = currentGameData.speedTest;
        if (!data.gameActive || data.currentIndex >= data.words.length) return;

        const word = data.words[data.currentIndex];

        document.getElementById("speedTestWord").textContent = word.german;
        document.getElementById("speedTestOptions").style.display = "grid";

        // Create options
        const wrongAnswers = vocabulary
          .filter((w) => w.vietnamese !== word.vietnamese)
          .sort(() => Math.random() - 0.5)
          .slice(0, 3)
          .map((w) => w.vietnamese);

        const options = [word.vietnamese, ...wrongAnswers].sort(
          () => Math.random() - 0.5
        );

        const optionsContainer = document.getElementById("speedTestOptions");
        optionsContainer.innerHTML = "";

        options.forEach((option) => {
          const optionElement = document.createElement("div");
          optionElement.className = "quiz-option";
          optionElement.textContent = option;
          optionElement.onclick = () =>
            selectSpeedOption(option, word.vietnamese);
          optionsContainer.appendChild(optionElement);
        });
      }

      function selectSpeedOption(selected, correct) {
        const data = currentGameData.speedTest;
        if (!data.gameActive) return;

        if (selected === correct) {
          data.score += 10;
          data.correct++;
        } else {
          data.wrong++;
        }

        data.currentIndex++;
        updateSpeedTestStats();

        // Show next word immediately
        setTimeout(() => showSpeedTestWord(), 100);
      }

      function updateSpeedTestStats() {
        const data = currentGameData.speedTest;
        document.getElementById("speedScore").textContent = data.score;
        document.getElementById("speedTime").textContent = data.timeLeft;
        document.getElementById("speedCorrect").textContent = data.correct;
        document.getElementById("speedWrong").textContent = data.wrong;
      }

      function endSpeedTest() {
        const data = currentGameData.speedTest;
        data.gameActive = false;
        clearInterval(data.timer);

        document.getElementById("speedTestOptions").style.display = "none";
        document.getElementById(
          "speedTestWord"
        ).textContent = `ğŸ‰ Káº¿t thÃºc! Äiá»ƒm: ${data.score} | ÄÃºng: ${data.correct} | Sai: ${data.wrong}`;
        document.getElementById("speedTestStatus").textContent = `Tá»‘c Ä‘á»™: ${
          data.correct + data.wrong
        } tá»«/phÃºt`;
        document.getElementById("speedResetBtn").style.display = "inline-block";
      }

      function resetSpeedTest() {
        if (currentGameData.speedTest && currentGameData.speedTest.timer) {
          clearInterval(currentGameData.speedTest.timer);
        }
        initSpeedTest();
      }

      // Word Builder Game - NEW GAME
      function initWordBuilder() {
        currentGameData.wordBuilder = {
          words: [...vocabulary].sort(() => Math.random() - 0.5),
          currentIndex: 0,
          score: 0,
          answered: false,
        };

        document.getElementById("totalWordBuilder").textContent =
          vocabulary.length;
        showWordBuilderQuestion();
      }

      function showWordBuilderQuestion() {
        const data = currentGameData.wordBuilder;
        const word = data.words[data.currentIndex];

        document.getElementById("currentWordBuilder").textContent =
          data.currentIndex + 1;
        document.getElementById(
          "wordBuilderPrompt"
        ).textContent = `Sáº¯p xáº¿p chá»¯ cÃ¡i Ä‘á»ƒ táº¡o thÃ nh tá»« cÃ³ nghÄ©a: "${word.vietnamese}"`;

        document.getElementById("wordBuilderInput").value = "";
        document.getElementById("wordBuilderFeedback").innerHTML = "";
        document.getElementById("nextWordBtn").style.display = "none";

        // Scramble the letters
        const letters = word.german
          .toLowerCase()
          .split("")
          .sort(() => Math.random() - 0.5);

        const scrambledContainer = document.getElementById("scrambledLetters");
        scrambledContainer.innerHTML = "";

        letters.forEach((letter, index) => {
          const letterTile = document.createElement("div");
          letterTile.className = "letter-tile";
          letterTile.textContent = letter;
          letterTile.onclick = () => addLetter(letter, index);
          letterTile.dataset.index = index;
          scrambledContainer.appendChild(letterTile);
        });

        data.answered = false;
      }

      function addLetter(letter, index) {
        const input = document.getElementById("wordBuilderInput");
        const tile = document.querySelector(`[data-index="${index}"]`);

        if (tile.classList.contains("used")) return;

        input.value += letter;
        tile.classList.add("used");
      }

      function clearWordBuilder() {
        document.getElementById("wordBuilderInput").value = "";
        document.querySelectorAll(".letter-tile").forEach((tile) => {
          tile.classList.remove("used");
        });
      }

      function checkWordBuilder() {
        if (currentGameData.wordBuilder.answered) return;

        const data = currentGameData.wordBuilder;
        const word = data.words[data.currentIndex];
        const userInput = document
          .getElementById("wordBuilderInput")
          .value.trim()
          .toLowerCase();
        const correctAnswer = word.german.toLowerCase();

        data.answered = true;

        const feedback = document.getElementById("wordBuilderFeedback");

        if (userInput === correctAnswer) {
          feedback.innerHTML = `<span style="color: #4CAF50;">âœ… ÄÃºng rá»“i! "${word.german}" = ${word.vietnamese}</span>`;
          feedback.style.background = "#e8f5e8";
          data.score++;
        } else {
          feedback.innerHTML = `<span style="color: #f44336;">âŒ Sai rá»“i! ÄÃ¡p Ã¡n Ä‘Ãºng: "${word.german}" = ${word.vietnamese}</span>`;
          feedback.style.background = "#ffebee";
        }

        setTimeout(() => {
          document.getElementById("nextWordBtn").style.display = "inline-block";
        }, 2000);
      }

      function nextWordBuilder() {
        const data = currentGameData.wordBuilder;

        if (data.currentIndex < data.words.length - 1) {
          data.currentIndex++;
          showWordBuilderQuestion();
        } else {
          // Show final score
          document.querySelector(
            "#wordbuilderGame .word-builder-area"
          ).style.display = "none";
          document.getElementById("nextWordBtn").style.display = "none";
          document.getElementById("wordBuilderScore").style.display = "block";
          document.getElementById("finalWordBuilderScore").textContent =
            data.score;
        }
      }

      // Sentence Builder Game - NEW GAME
      function initSentenceBuilder() {
        currentGameData.sentenceBuilder = {
          sentences: [...sampleSentences].sort(() => Math.random() - 0.5),
          currentIndex: 0,
          score: 0,
          answered: false,
          selectedWords: [],
        };

        document.getElementById("totalSentences").textContent =
          sampleSentences.length;
        showSentenceBuilderQuestion();
      }

      function showSentenceBuilderQuestion() {
        const data = currentGameData.sentenceBuilder;
        const sentence = data.sentences[data.currentIndex];

        document.getElementById("currentSentence").textContent =
          data.currentIndex + 1;
        document.getElementById(
          "sentencePrompt"
        ).textContent = `Sáº¯p xáº¿p cÃ¡c tá»« Ä‘á»ƒ táº¡o thÃ nh cÃ¢u: "${sentence.vietnamese}"`;

        document.getElementById("sentenceDropZone").innerHTML =
          '<p style="color: #999;">KÃ©o tá»« vÃ o Ä‘Ã¢y Ä‘á»ƒ táº¡o cÃ¢u...</p>';
        document.getElementById("sentenceFeedback").innerHTML = "";
        document.getElementById("nextSentenceBtn").style.display = "none";

        // Create word bank
        const wordBank = document.getElementById("wordBank");
        wordBank.innerHTML = "";

        sentence.words.forEach((word, index) => {
          const wordChip = document.createElement("div");
          wordChip.className = "word-chip";
          wordChip.textContent = word;
          wordChip.onclick = () => selectSentenceWord(word, index);
          wordChip.dataset.index = index;
          wordBank.appendChild(wordChip);
        });

        data.answered = false;
        data.selectedWords = [];
      }

      function selectSentenceWord(word, index) {
        const data = currentGameData.sentenceBuilder;
        const chip = document.querySelector(`[data-index="${index}"]`);

        if (chip.classList.contains("used")) return;

        data.selectedWords.push(word);
        chip.classList.add("used");

        // Update drop zone
        const dropZone = document.getElementById("sentenceDropZone");
        dropZone.innerHTML = data.selectedWords
          .map((w) => `<span class="word-chip">${w}</span>`)
          .join(" ");
      }

      function clearSentence() {
        const data = currentGameData.sentenceBuilder;
        data.selectedWords = [];

        document.getElementById("sentenceDropZone").innerHTML =
          '<p style="color: #999;">KÃ©o tá»« vÃ o Ä‘Ã¢y Ä‘á»ƒ táº¡o cÃ¢u...</p>';

        document.querySelectorAll(".word-chip").forEach((chip) => {
          chip.classList.remove("used");
        });
      }

      function checkSentence() {
        if (currentGameData.sentenceBuilder.answered) return;

        const data = currentGameData.sentenceBuilder;
        const sentence = data.sentences[data.currentIndex];
        const userSentence = data.selectedWords.join(" ").toLowerCase();
        const correctSentence = sentence.german.join(" ").toLowerCase();

        data.answered = true;

        const feedback = document.getElementById("sentenceFeedback");

        if (userSentence === correctSentence) {
          feedback.innerHTML = `<span style="color: #4CAF50;">âœ… ÄÃºng rá»“i! "${sentence.german.join(
            " "
          )}" = ${sentence.vietnamese}</span>`;
          feedback.style.background = "#e8f5e8";
          data.score++;
        } else {
          feedback.innerHTML = `<span style="color: #f44336;">âŒ Sai rá»“i! ÄÃ¡p Ã¡n Ä‘Ãºng: "${sentence.german.join(
            " "
          )}" = ${sentence.vietnamese}</span>`;
          feedback.style.background = "#ffebee";
        }

        setTimeout(() => {
          document.getElementById("nextSentenceBtn").style.display =
            "inline-block";
        }, 2000);
      }

      function nextSentence() {
        const data = currentGameData.sentenceBuilder;

        if (data.currentIndex < data.sentences.length - 1) {
          data.currentIndex++;
          showSentenceBuilderQuestion();
        } else {
          // Show final score
          document.querySelector(
            "#sentencebuilderGame .sentence-builder-area"
          ).style.display = "none";
          document.getElementById("nextSentenceBtn").style.display = "none";
          document.getElementById("sentenceScore").style.display = "block";
          document.getElementById("finalSentenceScore").textContent =
            data.score;
        }
      }

      // Allow Enter key for typing and word builder games
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(() => {
          const typingInput = document.getElementById("typingInput");
          if (typingInput) {
            typingInput.addEventListener("keypress", function (e) {
              if (e.key === "Enter") {
                checkTyping();
              }
            });
          }

          const wordBuilderInput = document.getElementById("wordBuilderInput");
          if (wordBuilderInput) {
            wordBuilderInput.addEventListener("keypress", function (e) {
              if (e.key === "Enter") {
                checkWordBuilder();
              }
            });
          }
        }, 100);
      });

      // Initialize back to index button
      setTimeout(() => {
        backToIndexBtn.classList.add("visible");
      }, 1000);
    </script>
  </body>
</html>
