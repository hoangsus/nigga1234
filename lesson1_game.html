<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tr√≤ ch∆°i Bu·ªïi 1 - Gi·ªõi thi·ªáu b·∫£n th√¢n</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
        padding: 20px;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 2.5em;
        color: #4a47a3;
        margin-bottom: 10px;
      }

      .subtitle {
        font-size: 1.2em;
        color: #666;
        margin-bottom: 20px;
      }

      /* Enhanced Audio Status */
      .audio-status {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 15px;
        border-radius: 25px;
        font-size: 0.9em;
        font-weight: 600;
        margin: 10px 0;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .audio-loading {
        background: #fff3cd;
        color: #856404;
        border: 2px solid #ffeaa7;
      }

      .audio-ready {
        background: #d4edda;
        color: #155724;
        border: 2px solid #c3e6cb;
      }

      .audio-error {
        background: #f8d7da;
        color: #721c24;
        border: 2px solid #f5c6cb;
      }

      .audio-mobile-warning {
        background: #e2e3e5;
        color: #383d41;
        border: 2px solid #d6d8db;
      }

      .back-to-index {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 50px;
        padding: 15px 25px;
        font-size: 1em;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        opacity: 0;
        visibility: hidden;
        transform: translateY(100px);
        z-index: 1000;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .back-to-index.visible {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .back-to-index:hover {
        background: linear-gradient(135deg, #5a6fd8 0%, #6a42a0 100%);
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
      }

      .game-menu {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .game-card {
        background: linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%);
        border: 2px solid #2196f3;
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .game-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        border-color: #1976d2;
      }

      .game-card.active {
        border-color: #4caf50;
        background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
      }

      .game-icon {
        font-size: 3em;
        margin-bottom: 15px;
      }

      .game-title {
        font-size: 1.3em;
        font-weight: bold;
        color: #1976d2;
        margin-bottom: 10px;
      }

      .game-description {
        color: #666;
        margin-bottom: 15px;
        line-height: 1.5;
      }

      .game-stats {
        font-size: 0.9em;
        color: #888;
      }

      .game-area {
        display: none;
        min-height: 400px;
      }

      .game-area.active {
        display: block;
      }

      .game-header {
        background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
        color: white;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .game-info h3 {
        margin-bottom: 5px;
      }

      .game-controls {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
        font-size: 0.95em;
        position: relative;
        overflow: hidden;
      }

      .btn-primary {
        background: #4caf50;
        color: white;
      }

      .btn-primary:hover {
        background: #45a049;
        transform: translateY(-2px);
      }

      .btn-secondary {
        background: #f44336;
        color: white;
      }

      .btn-secondary:hover {
        background: #da190b;
      }

      .btn-back {
        background: #ff9800;
        color: white;
      }

      .btn-back:hover {
        background: #e68900;
      }

      .btn-audio {
        background: #9c27b0;
        color: white;
        position: relative;
      }

      .btn-audio:hover {
        background: #7b1fa2;
        transform: translateY(-2px);
      }

      .btn-audio.playing {
        background: #4caf50;
        animation: pulse 1.5s infinite;
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(76, 175, 80, 0);
        }
      }

      .btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }

      /* Mobile Audio Guide */
      .mobile-audio-guide {
        background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
        border: 2px solid #4caf50;
        border-radius: 15px;
        padding: 20px;
        margin: 15px 0;
        display: none;
      }

      .mobile-audio-guide.show {
        display: block;
      }

      .mobile-audio-guide h4 {
        color: #2e7d32;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .mobile-audio-guide ul {
        color: #1b5e20;
        margin-left: 20px;
        line-height: 1.6;
      }

      .mobile-audio-guide li {
        margin-bottom: 5px;
      }

      /* Enhanced Audio Fallback */
      .audio-fallback {
        background: linear-gradient(135deg, #f0f8ff 0%, #e3f2fd 100%);
        border: 3px solid #2196f3;
        border-radius: 15px;
        padding: 25px;
        margin: 20px 0;
        text-align: center;
        box-shadow: 0 8px 20px rgba(33, 150, 243, 0.2);
        transition: all 0.3s ease;
      }

      .audio-fallback h4 {
        color: #1976d2;
        margin-bottom: 15px;
        font-size: 1.3em;
      }

      .pronunciation-display {
        font-size: 2em;
        color: #8e44ad;
        font-weight: bold;
        margin: 20px 0;
        padding: 15px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border: 2px solid #9c27b0;
      }

      .pronunciation-hint {
        font-size: 1em;
        color: #666;
        font-style: italic;
        margin-top: 15px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 8px;
      }

      /* Game 1: Flash Cards */
      .flashcard {
        background: white;
        border: 3px solid #2196f3;
        border-radius: 15px;
        padding: 40px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        min-height: 300px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
      }

      .flashcard:hover {
        transform: scale(1.02);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      .flashcard.flipped {
        background: #e8f5e8;
        border-color: #4caf50;
      }

      .card-content {
        font-size: 2em;
        margin-bottom: 20px;
        font-weight: bold;
      }

      .card-pronunciation {
        font-size: 1.2em;
        color: #8e44ad;
        margin-bottom: 15px;
        font-style: italic;
      }

      .card-translation {
        font-size: 1.5em;
        color: #27ae60;
        font-weight: bold;
      }

      .card-hint {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        color: #666;
        font-size: 0.9em;
      }

      /* Game 2: Memory Game */
      .memory-grid {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 10px;
        max-width: 800px;
        margin: 0 auto;
      }

      .memory-card {
        aspect-ratio: 1;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        color: white;
        font-weight: bold;
        position: relative;
        overflow: hidden;
        font-size: 0.8em;
      }

      .memory-card:hover {
        transform: scale(1.05);
      }

      .memory-card.flipped {
        background: white;
        color: #333;
        border: 2px solid #2196f3;
      }

      .memory-card.matched {
        background: #4caf50;
        color: white;
      }

      .memory-card-content {
        text-align: center;
        padding: 5px;
        word-break: break-word;
      }

      /* Game 3: Quiz */
      .quiz-question {
        background: #f8f9ff;
        border: 2px solid #2196f3;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
        text-align: center;
      }

      .quiz-question h3 {
        color: #1976d2;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      .quiz-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .quiz-option {
        background: white;
        border: 2px solid #dee2e6;
        border-radius: 10px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        font-size: 1em;
        font-weight: 500;
      }

      .quiz-option:hover {
        border-color: #2196f3;
        background: #e3f2fd;
        transform: translateY(-3px);
      }

      .quiz-option.correct {
        border-color: #4caf50;
        background: #e8f5e8;
        color: #155724;
      }

      .quiz-option.wrong {
        border-color: #f44336;
        background: #ffebee;
        color: #721c24;
      }

      .score-display {
        text-align: center;
        font-size: 1.2em;
        margin: 20px 0;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
      }

      /* Category Game */
      .category-box {
        border: 2px dashed #ccc;
        padding: 20px;
        min-height: 120px;
        border-radius: 10px;
        background: #f9f9f9;
        transition: all 0.3s ease;
      }

      .category-box h4 {
        text-align: center;
        color: #666;
        margin-bottom: 10px;
        font-size: 1.1em;
      }

      .draggable-word {
        background: #667eea;
        color: white;
        padding: 8px 12px;
        border-radius: 20px;
        cursor: move;
        display: inline-block;
        margin: 5px;
        font-size: 0.9em;
        user-select: none;
        transition: all 0.3s ease;
      }

      .draggable-word:hover {
        background: #5a6fd8;
        transform: scale(1.05);
      }

      .category-word {
        background: #4caf50;
        color: white;
        padding: 5px 10px;
        margin: 2px;
        border-radius: 15px;
        display: inline-block;
        font-size: 0.8em;
      }

      /* Typing Game */
      .typing-input {
        width: 100%;
        padding: 15px;
        font-size: 1.2em;
        border: 2px solid #ddd;
        border-radius: 10px;
        margin: 20px 0;
        text-align: center;
      }

      .typing-input:focus {
        outline: none;
        border-color: #2196f3;
      }

      .typing-feedback {
        margin-top: 15px;
        font-size: 1.1em;
        font-weight: bold;
        text-align: center;
        padding: 15px;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .container {
          padding: 20px;
          margin: 10px;
        }

        .header h1 {
          font-size: 2em;
        }

        .memory-grid {
          grid-template-columns: repeat(6, 1fr);
          gap: 8px;
        }

        .quiz-options {
          grid-template-columns: 1fr;
        }

        .back-to-index {
          bottom: 20px;
          right: 20px;
          padding: 12px 20px;
          font-size: 0.9em;
        }

        .game-menu {
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .pronunciation-display {
          font-size: 1.7em;
        }

        .btn {
          padding: 10px 16px;
          font-size: 0.9em;
        }
      }

      @media (max-width: 480px) {
        .memory-grid {
          grid-template-columns: repeat(4, 1fr);
        }

        .flashcard {
          padding: 20px;
          min-height: 250px;
        }

        .card-content {
          font-size: 1.5em;
        }

        .back-to-index {
          padding: 10px 15px;
          font-size: 0.8em;
        }

        .memory-card {
          font-size: 0.7em;
        }

        .pronunciation-display {
          font-size: 1.5em;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üéÆ Tr√≤ ch∆°i Bu·ªïi 1</h1>
        <div class="subtitle">
          Gi·ªõi thi·ªáu b·∫£n th√¢n - Luy·ªán t·∫≠p t·ª´ v·ª±ng th√∫ v·ªã
        </div>
        <div id="audioStatus" class="audio-status audio-loading">
          üîÑ ƒêang ki·ªÉm tra √¢m thanh...
        </div>
      </div>

      <!-- Mobile Audio Guide -->
      <div id="mobileAudioGuide" class="mobile-audio-guide">
        <h4>üì± H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng √¢m thanh tr√™n mobile:</h4>
        <ul>
          <li>Nh·∫•n n√∫t "üîä Nghe" ƒë·ªÉ ph√°t √¢m thanh t·ª´ ti·∫øng ƒê·ª©c</li>
          <li>N·∫øu kh√¥ng nghe ƒë∆∞·ª£c, phi√™n √¢m s·∫Ω hi·ªÉn th·ªã b√™n d∆∞·ªõi</li>
          <li>ƒê·∫£m b·∫£o √¢m l∆∞·ª£ng thi·∫øt b·ªã ƒë√£ b·∫≠t</li>
          <li>M·ªôt s·ªë thi·∫øt b·ªã c·∫ßn c√†i th√™m gi·ªçng n√≥i ti·∫øng ƒê·ª©c</li>
        </ul>
      </div>

      <div class="game-menu" id="gameMenu">
        <div class="game-card" onclick="startGame('flashcards')">
          <div class="game-icon">üÉè</div>
          <div class="game-title">Th·∫ª ghi nh·ªõ</div>
          <div class="game-description">
            L·∫≠t th·∫ª ƒë·ªÉ xem nghƒ©a ti·∫øng Vi·ªát. H·ªçc t·ª´ v·ª±ng m·ªôt c√°ch tr·ª±c quan v√†
            hi·ªáu qu·∫£.
          </div>
          <div class="game-stats">üìö 72 t·ª´ ‚Ä¢ ‚è±Ô∏è 20-25 ph√∫t</div>
        </div>

        <div class="game-card" onclick="startGame('memory')">
          <div class="game-icon">üß†</div>
          <div class="game-title">Tr√≤ ch∆°i ghi nh·ªõ</div>
          <div class="game-description">
            T√¨m c·∫∑p t·ª´ ti·∫øng ƒê·ª©c v√† nghƒ©a ti·∫øng Vi·ªát. R√®n luy·ªán tr√≠ nh·ªõ v√† t·ª´
            v·ª±ng.
          </div>
          <div class="game-stats">üéØ 16 c·∫∑p ‚Ä¢ ‚è±Ô∏è 20 ph√∫t</div>
        </div>

        <div class="game-card" onclick="startGame('quiz')">
          <div class="game-icon">‚ùì</div>
          <div class="game-title">C√¢u h·ªèi tr·∫Øc nghi·ªám</div>
          <div class="game-description">
            Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ t·ª´ v·ª±ng v√† ng·ªØ ph√°p c∆° b·∫£n. Ki·ªÉm tra ki·∫øn th·ª©c ƒë√£
            h·ªçc.
          </div>
          <div class="game-stats">üìù 30 c√¢u ‚Ä¢ ‚è±Ô∏è 25 ph√∫t</div>
        </div>

        <div class="game-card" onclick="startGame('listening')">
          <div class="game-icon">üéß</div>
          <div class="game-title">Luy·ªán nghe</div>
          <div class="game-description">
            Nghe t·ª´ ti·∫øng ƒê·ª©c v√† ch·ªçn nghƒ©a ƒë√∫ng. ƒê√£ t·ªëi ∆∞u cho mobile!
          </div>
          <div class="game-stats">üîä 25 t·ª´ ‚Ä¢ ‚è±Ô∏è 15 ph√∫t</div>
        </div>

        <div class="game-card" onclick="startGame('category')">
          <div class="game-icon">üè∑Ô∏è</div>
          <div class="game-title">Ph√¢n lo·∫°i t·ª´ v·ª±ng</div>
          <div class="game-description">
            K√©o th·∫£ t·ª´ v√†o ƒë√∫ng nh√≥m. H·ªçc c√°ch ph√¢n lo·∫°i v√† ghi nh·ªõ theo ch·ªß ƒë·ªÅ.
          </div>
          <div class="game-stats">üéØ 12 nh√≥m ‚Ä¢ ‚è±Ô∏è 15 ph√∫t</div>
        </div>

        <div class="game-card" onclick="startGame('typing')">
          <div class="game-icon">‚å®Ô∏è</div>
          <div class="game-title">G√µ t·ª´ v·ª±ng</div>
          <div class="game-description">
            Nghe t·ª´ ti·∫øng ƒê·ª©c v√† g√µ ch√≠nh x√°c. R√®n luy·ªán ch√≠nh t·∫£ v√† ph√°t √¢m.
          </div>
          <div class="game-stats">‚úçÔ∏è 20 t·ª´ ‚Ä¢ ‚è±Ô∏è 18 ph√∫t</div>
        </div>
      </div>

      <!-- Flashcards Game -->
      <div class="game-area" id="flashcardsGame">
        <div class="game-header">
          <div class="game-info">
            <h3>üÉè Th·∫ª ghi nh·ªõ</h3>
            <p>
              Th·∫ª <span id="currentCard">1</span> /
              <span id="totalCards">72</span>
            </p>
          </div>
          <div class="game-controls">
            <button class="btn btn-primary" onclick="prevCard()">
              ‚¨ÖÔ∏è Tr∆∞·ªõc
            </button>
            <button class="btn btn-primary" onclick="nextCard()">
              Ti·∫øp ‚û°Ô∏è
            </button>
            <button class="btn btn-back" onclick="backToMenu()">üè† Menu</button>
          </div>
        </div>

        <div class="flashcard" id="flashcard" onclick="flipCard()">
          <div class="card-content" id="cardContent">ich</div>
          <div class="card-pronunciation" id="cardPronunciation">[√≠ch]</div>
          <div
            class="card-translation"
            id="cardTranslation"
            style="display: none"
          >
            t√¥i
          </div>
          <div class="card-hint">üí° B·∫•m ƒë·ªÉ xem nghƒ©a</div>
        </div>
      </div>

      <!-- Memory Game -->
      <div class="game-area" id="memoryGame">
        <div class="game-header">
          <div class="game-info">
            <h3>üß† Tr√≤ ch∆°i ghi nh·ªõ</h3>
            <p>
              ƒêi·ªÉm: <span id="memoryScore">0</span> ‚Ä¢ L∆∞·ª£t:
              <span id="memoryMoves">0</span>
            </p>
          </div>
          <div class="game-controls">
            <button class="btn btn-primary" onclick="resetMemory()">
              üîÑ Ch∆°i l·∫°i
            </button>
            <button class="btn btn-back" onclick="backToMenu()">üè† Menu</button>
          </div>
        </div>

        <div class="memory-grid" id="memoryGrid">
          <!-- Memory cards will be generated by JavaScript -->
        </div>
      </div>

      <!-- Quiz Game -->
      <div class="game-area" id="quizGame">
        <div class="game-header">
          <div class="game-info">
            <h3>‚ùì C√¢u h·ªèi tr·∫Øc nghi·ªám</h3>
            <p>
              C√¢u <span id="currentQuestion">1</span> /
              <span id="totalQuestions">30</span>
            </p>
          </div>
          <div class="game-controls">
            <button
              class="btn btn-primary"
              onclick="nextQuestion()"
              id="nextBtn"
              style="display: none"
            >
              Ti·∫øp ‚û°Ô∏è
            </button>
            <button class="btn btn-back" onclick="backToMenu()">üè† Menu</button>
          </div>
        </div>

        <div class="quiz-question" id="quizQuestion">
          <h3 id="questionText">T·ª´ "ich" c√≥ nghƒ©a l√† g√¨?</h3>
          <div class="quiz-options" id="quizOptions">
            <!-- Options will be generated by JavaScript -->
          </div>
        </div>

        <div class="score-display" id="quizScore" style="display: none">
          ƒêi·ªÉm c·ªßa b·∫°n: <span id="finalScore">0</span>/30
        </div>
      </div>

      <!-- Listening Game -->
      <div class="game-area" id="listeningGame">
        <div class="game-header">
          <div class="game-info">
            <h3>üéß Luy·ªán nghe</h3>
            <p>
              T·ª´ <span id="currentListening">1</span> /
              <span id="totalListening">25</span>
            </p>
          </div>
          <div class="game-controls">
            <button class="btn btn-audio" onclick="playAudio()" id="playBtn">
              üîä Nghe
            </button>
            <button
              class="btn btn-primary"
              onclick="nextListening()"
              id="nextListeningBtn"
              style="display: none"
            >
              Ti·∫øp ‚û°Ô∏è
            </button>
            <button class="btn btn-back" onclick="backToMenu()">üè† Menu</button>
          </div>
        </div>

        <div class="quiz-question">
          <h3>üéß Nghe v√† ch·ªçn nghƒ©a ƒë√∫ng:</h3>
          <div class="audio-fallback" id="audioFallback">
            <h4>üì¢ T·ª´ c·∫ßn nghe:</h4>
            <div class="pronunciation-display" id="currentWordDisplay"></div>
            <div class="pronunciation-hint">
              üìñ ƒê·ªçc to theo phi√™n √¢m ƒë·ªÉ luy·ªán ph√°t √¢m
            </div>
          </div>
          <div class="quiz-options" id="listeningOptions">
            <!-- Options will be generated by JavaScript -->
          </div>
        </div>

        <div class="score-display" id="listeningScore" style="display: none">
          ƒêi·ªÉm nghe: <span id="finalListeningScore">0</span>/25
        </div>
      </div>

      <!-- Category Game -->
      <div class="game-area" id="categoryGame">
        <div class="game-header">
          <div class="game-info">
            <h3>üè∑Ô∏è Ph√¢n lo·∫°i t·ª´ v·ª±ng</h3>
            <p>
              ƒêi·ªÉm: <span id="categoryScore">0</span> ‚Ä¢ C√≤n l·∫°i:
              <span id="remainingWords">0</span>
            </p>
          </div>
          <div class="game-controls">
            <button class="btn btn-primary" onclick="resetCategory()">
              üîÑ Ch∆°i l·∫°i
            </button>
            <button class="btn btn-back" onclick="backToMenu()">üè† Menu</button>
          </div>
        </div>

        <div id="categoryContainer">
          <!-- Category game will be rendered here -->
        </div>
      </div>

      <!-- Typing Game -->
      <div class="game-area" id="typingGame">
        <div class="game-header">
          <div class="game-info">
            <h3>‚å®Ô∏è G√µ t·ª´ v·ª±ng</h3>
            <p>
              T·ª´ <span id="currentTyping">1</span> /
              <span id="totalTyping">20</span>
            </p>
          </div>
          <div class="game-controls">
            <button
              class="btn btn-audio"
              onclick="playTypingAudio()"
              id="playTypingBtn"
            >
              üîä Nghe
            </button>
            <button
              class="btn btn-primary"
              onclick="nextTyping()"
              id="nextTypingBtn"
              style="display: none"
            >
              Ti·∫øp ‚û°Ô∏è
            </button>
            <button class="btn btn-back" onclick="backToMenu()">üè† Menu</button>
          </div>
        </div>

        <div class="quiz-question">
          <h3>‚å®Ô∏è Nghe v√† g√µ t·ª´ ti·∫øng ƒê·ª©c:</h3>
          <div class="audio-fallback" id="typingAudioFallback">
            <h4>üì¢ T·ª´ c·∫ßn g√µ:</h4>
            <div
              class="pronunciation-display"
              id="currentTypingWordDisplay"
            ></div>
            <div class="pronunciation-hint">
              üéØ Nghe theo phi√™n √¢m v√† g√µ t·ª´ ti·∫øng ƒê·ª©c
            </div>
          </div>
          <input
            type="text"
            id="typingInput"
            class="typing-input"
            placeholder="G√µ t·ª´ b·∫°n nghe ƒë∆∞·ª£c..."
            autocomplete="off"
            autocorrect="off"
            spellcheck="false"
          />
          <button
            class="btn btn-primary"
            onclick="checkTyping()"
            id="checkTypingBtn"
          >
            ‚úÖ Ki·ªÉm tra
          </button>
          <div id="typingFeedback" class="typing-feedback"></div>
        </div>

        <div class="score-display" id="typingScore" style="display: none">
          ƒêi·ªÉm g√µ t·ª´: <span id="finalTypingScore">0</span>/20
        </div>
      </div>
    </div>

    <!-- Back to Index Button -->
    <button
      class="back-to-index"
      id="backToIndex"
      onclick="window.history.back()"
    >
      üè† V·ªÅ trang ch·ªß
    </button>

    <script>
      // COMPLETE VOCABULARY DATA - 72 WORDS
      const vocabulary = [
        // NH√ìM 1: C·ª∞C K·ª≤ QUAN TR·ªåNG
        {
          german: "ich",
          pronunciation: "[√≠ch]",
          vietnamese: "t√¥i",
          category: "Si√™u quan tr·ªçng",
        },
        {
          german: "bin",
          pronunciation: "[bin]",
          vietnamese: "l√†",
          category: "Si√™u quan tr·ªçng",
        },
        {
          german: "ist",
          pronunciation: "[√≠t]",
          vietnamese: "l√†",
          category: "Si√™u quan tr·ªçng",
        },
        {
          german: "hei√üe",
          pronunciation: "[hai-s∆°]",
          vietnamese: "t√™n l√†",
          category: "Si√™u quan tr·ªçng",
        },
        {
          german: "Hallo",
          pronunciation: "[ha-l√¥]",
          vietnamese: "xin ch√†o",
          category: "Si√™u quan tr·ªçng",
        },
        {
          german: "Guten Tag",
          pronunciation: "[gu-ten t√°c]",
          vietnamese: "ch√†o bu·ªïi chi·ªÅu",
          category: "Si√™u quan tr·ªçng",
        },
        {
          german: "Tsch√ºs",
          pronunciation: "[ch√∫y-s]",
          vietnamese: "t·∫°m bi·ªát (th√¢n m·∫≠t)",
          category: "Si√™u quan tr·ªçng",
        },
        {
          german: "komme",
          pronunciation: "[c√¥-m∆°]",
          vietnamese: "ƒë·∫øn / ƒë·∫øn t·ª´",
          category: "Si√™u quan tr·ªçng",
        },
        {
          german: "spreche",
          pronunciation: "[spre-xe]",
          vietnamese: "n√≥i (ng√¥n ng·ªØ)",
          category: "Si√™u quan tr·ªçng",
        },

        // NH√ìM 2: QUAN TR·ªåNG
        {
          german: "aus",
          pronunciation: "[aus]",
          vietnamese: "t·ª´",
          category: "Quan tr·ªçng",
        },
        {
          german: "und",
          pronunciation: "[unt]",
          vietnamese: "v√†",
          category: "Quan tr·ªçng",
        },
        {
          german: "ein bisschen",
          pronunciation: "[ain b√≠-s∆°n]",
          vietnamese: "m·ªôt ch√∫t",
          category: "Quan tr·ªçng",
        },
        {
          german: "mein",
          pronunciation: "[main]",
          vietnamese: "c·ªßa t√¥i",
          category: "Quan tr·ªçng",
        },
        {
          german: "meine",
          pronunciation: "[mai-n∆°]",
          vietnamese: "c·ªßa t√¥i",
          category: "Quan tr·ªçng",
        },
        {
          german: "Name",
          pronunciation: "[na-m∆°]",
          vietnamese: "t√™n",
          category: "Quan tr·ªçng",
        },
        {
          german: "ja",
          pronunciation: "[ya]",
          vietnamese: "c√≥",
          category: "Quan tr·ªçng",
        },
        {
          german: "nein",
          pronunciation: "[nain]",
          vietnamese: "kh√¥ng",
          category: "Quan tr·ªçng",
        },
        {
          german: "okay",
          pronunciation: "[√¥-k√¢y]",
          vietnamese: "ƒë∆∞·ª£c r·ªìi",
          category: "Quan tr·ªçng",
        },
        {
          german: "bitte",
          pronunciation: "[bi-t∆°]",
          vietnamese: "l√†m ∆°n / xin m·ªùi",
          category: "Quan tr·ªçng",
        },

        // NH√ìM 3: QU·ªêC GIA & NG√îN NG·ªÆ
        {
          german: "Deutschland",
          pronunciation: "[ƒê√≥i-t-lant]",
          vietnamese: "n∆∞·ªõc ƒê·ª©c",
          category: "Qu·ªëc gia",
        },
        {
          german: "Englisch",
          pronunciation: "[√âng-l√≠t]",
          vietnamese: "ti·∫øng Anh",
          category: "Ng√¥n ng·ªØ",
        },
        {
          german: "Polen",
          pronunciation: "[P√¥-len]",
          vietnamese: "Ba Lan",
          category: "Qu·ªëc gia",
        },
        {
          german: "Polnisch",
          pronunciation: "[P√¥l-n√≠t]",
          vietnamese: "ti·∫øng Ba Lan",
          category: "Ng√¥n ng·ªØ",
        },
        {
          german: "Spanisch",
          pronunciation: "[Shpa-n√≠t]",
          vietnamese: "ti·∫øng T√¢y Ban Nha",
          category: "Ng√¥n ng·ªØ",
        },

        // NH√ìM 4: GIA ƒê√åNH & NG∆Ø·ªúI
        {
          german: "Mama",
          pronunciation: "[Ma-ma]",
          vietnamese: "m·∫π",
          category: "Gia ƒë√¨nh",
        },
        {
          german: "Opa",
          pronunciation: "[√î-pa]",
          vietnamese: "√¥ng",
          category: "Gia ƒë√¨nh",
        },
        {
          german: "du",
          pronunciation: "[du]",
          vietnamese: "b·∫°n",
          category: "Ng∆∞·ªùi",
        },

        // NH√ìM 5: T·ª™ H·ªéI & LI√äN K·∫æT
        {
          german: "Wie",
          pronunciation: "[v√¨]",
          vietnamese: "nh∆∞ th·∫ø n√†o / l√†m sao",
          category: "T·ª´ h·ªèi",
        },
        {
          german: "Woher",
          pronunciation: "[v√¥-he]",
          vietnamese: "t·ª´ ƒë√¢u",
          category: "T·ª´ h·ªèi",
        },
        {
          german: "Was",
          pronunciation: "[v√°t]",
          vietnamese: "c√°i g√¨",
          category: "T·ª´ h·ªèi",
        },
        {
          german: "oder",
          pronunciation: "[√¥-ƒë∆°]",
          vietnamese: "ho·∫∑c",
          category: "Li√™n t·ª´",
        },
        {
          german: "Auf Wiedersehen",
          pronunciation: "[auf v√¨-ƒë∆°-ze-en]",
          vietnamese: "t·∫°m bi·ªát (trang tr·ªçng)",
          category: "Ch√†o h·ªèi",
        },
        {
          german: "doch",
          pronunciation: "[ƒë·ªçt]",
          vietnamese: "th·∫≠t ra / m√†",
          category: "T·ª´ li√™n k·∫øt",
        },

        // NH√ìM 6: T√çNH T·ª™ & M√î T·∫¢
        {
          german: "ganz",
          pronunciation: "[g√°nt]",
          vietnamese: "ho√†n to√†n / r·∫•t",
          category: "T√≠nh t·ª´",
        },
        {
          german: "einfach",
          pronunciation: "[ain-f√°t]",
          vietnamese: "ƒë∆°n gi·∫£n",
          category: "T√≠nh t·ª´",
        },
        {
          german: "super",
          pronunciation: "[zu-pe]",
          vietnamese: "tuy·ªát v·ªùi",
          category: "T√≠nh t·ª´",
        },
        {
          german: "gut",
          pronunciation: "[gut]",
          vietnamese: "t·ªët",
          category: "T√≠nh t·ª´",
        },
        {
          german: "richtig",
          pronunciation: "[r√≠t-t√≠t]",
          vietnamese: "ƒë√∫ng",
          category: "T√≠nh t·ª´",
        },

        // NH√ìM 7: S·ªê ƒê·∫æM & TH·ªúI GIAN
        {
          german: "eins",
          pronunciation: "[ains]",
          vietnamese: "m·ªôt",
          category: "S·ªë ƒë·∫øm",
        },
        {
          german: "zwei",
          pronunciation: "[tsvai]",
          vietnamese: "hai",
          category: "S·ªë ƒë·∫øm",
        },
        {
          german: "drei",
          pronunciation: "[ƒërai]",
          vietnamese: "ba",
          category: "S·ªë ƒë·∫øm",
        },
        {
          german: "zuerst",
          pronunciation: "[tsu-e-·ªõt]",
          vietnamese: "tr∆∞·ªõc ti√™n",
          category: "Th·ªùi gian",
        },
        {
          german: "nochmal",
          pronunciation: "[n·ªçt-mal]",
          vietnamese: "m·ªôt l·∫ßn n·ªØa",
          category: "Th·ªùi gian",
        },

        // NH√ìM 8: C·∫¢M T√ÅN & ƒê·ªòNG T·ª™
        {
          german: "Oh",
          pronunciation: "[√¥]",
          vietnamese: "√¥i",
          category: "C·∫£m th√°n",
        },
        {
          german: "Hey",
          pronunciation: "[h√¢y]",
          vietnamese: "n√†y",
          category: "C·∫£m th√°n",
        },
        {
          german: "Ach",
          pronunciation: "[√°t]",
          vietnamese: "√¥i / th√¥i n√†o",
          category: "C·∫£m th√°n",
        },
        {
          german: "Na los",
          pronunciation: "[na l√¥t]",
          vietnamese: "n√†o th√¥i",
          category: "C·∫£m th√°n",
        },
        {
          german: "komm",
          pronunciation: "[c·ªçm]",
          vietnamese: "ƒë·∫øn / th√¥i n√†o",
          category: "ƒê·ªông t·ª´",
        },
        {
          german: "hast",
          pronunciation: "[h√°t]",
          vietnamese: "c√≥ / ƒë√£ (v·ªõi du)",
          category: "ƒê·ªông t·ª´",
        },
        {
          german: "vergessen",
          pronunciation: "[fe-g√©-s∆°n]",
          vietnamese: "qu√™n",
          category: "ƒê·ªông t·ª´",
        },

        // NH√ìM 9: T·ª™ H·ªñ TR·ª¢ & TH·ªúI GIAN
        {
          german: "das",
          pronunciation: "[ƒë√°t]",
          vietnamese: "ƒëi·ªÅu ƒë√≥ / c√°i ƒë√≥",
          category: "T·ª´ ch·ªâ ƒë·ªãnh",
        },
        {
          german: "dann",
          pronunciation: "[ƒë√°n]",
          vietnamese: "sau ƒë√≥ / r·ªìi",
          category: "Th·ªùi gian",
        },
        {
          german: "jetzt",
          pronunciation: "[y√©t]",
          vietnamese: "b√¢y gi·ªù",
          category: "Th·ªùi gian",
        },
        {
          german: "hier",
          pronunciation: "[hia]",
          vietnamese: "ƒë√¢y / ·ªü ƒë√¢y",
          category: "N∆°i ch·ªën",
        },

        // NH√ìM 10: C√ÇU C·∫¢M TH√ÅN & KH√ÅC
        {
          german: "√Ñhm",
          pronunciation: "[∆°m]",
          vietnamese: "·ª´m (do d·ª±)",
          category: "C·∫£m th√°n",
        },
        {
          german: "Puh",
          pronunciation: "[puh]",
          vietnamese: "ph√π (th·ªü ph√†o)",
          category: "C·∫£m th√°n",
        },
        {
          german: "Halli hallo",
          pronunciation: "[ha-li ha-l√¥]",
          vietnamese: "ch√†o ch√†o (vui v·∫ª)",
          category: "Ch√†o h·ªèi",
        },
        {
          german: "tut mir leid",
          pronunciation: "[tut mia lait]",
          vietnamese: "xin l·ªói",
          category: "L·ªãch s·ª±",
        },
        {
          german: "Keine Zeit",
          pronunciation: "[kai-n∆° tsait]",
          vietnamese: "kh√¥ng c√≥ th·ªùi gian",
          category: "T·ª´ ch·ªëi",
        },
        {
          german: "Mach's",
          pronunciation: "[m√°t]",
          vietnamese: "l√†m ƒëi (r√∫t g·ªçn c·ªßa mach es)",
          category: "ƒê·ªông t·ª´",
        },

        // NH√ìM 11: T√äN RI√äNG
        {
          german: "Lara",
          pronunciation: "[La-ra]",
          vietnamese: "Lara (t√™n ng∆∞·ªùi)",
          category: "T√™n ri√™ng",
        },
        {
          german: "Walter",
          pronunciation: "[Val-te]",
          vietnamese: "Walter (t√™n ng∆∞·ªùi)",
          category: "T√™n ri√™ng",
        },
        {
          german: "Sofia",
          pronunciation: "[Zo-fi-a]",
          vietnamese: "Sofia (t√™n ng∆∞·ªùi)",
          category: "T√™n ri√™ng",
        },

        // NH√ìM 12: T·ª™ V·ª∞NG H·ªåC T·∫¨P & HO·∫†T ƒê·ªòNG
        {
          german: "sehen",
          pronunciation: "[ze-en]",
          vietnamese: "nh√¨n / xem",
          category: "Ho·∫°t ƒë·ªông",
        },
        {
          german: "Sie",
          pronunciation: "[zi]",
          vietnamese: "h·ªç / b·∫°n (trang tr·ªçng)",
          category: "ƒê·∫°i t·ª´",
        },
        {
          german: "die",
          pronunciation: "[di]",
          vietnamese: "nh·ªØng / c√°c (m·∫°o t·ª´)",
          category: "M·∫°o t·ª´",
        },
        {
          german: "Fotos",
          pronunciation: "[f√¥-t√¥t]",
          vietnamese: "nh·ªØng b·ª©c ·∫£nh",
          category: "ƒê·ªì v·∫≠t",
        },
        {
          german: "an",
          pronunciation: "[an]",
          vietnamese: "t·∫°i / ·ªü / xem",
          category: "Gi·ªõi t·ª´",
        },
        {
          german: "h√∂ren",
          pronunciation: "[h√∂-ren]",
          vietnamese: "nghe",
          category: "Ho·∫°t ƒë·ªông",
        },
        {
          german: "noch einmal",
          pronunciation: "[n·ªçt ain-mal]",
          vietnamese: "m·ªôt l·∫ßn n·ªØa",
          category: "Th·ªùi gian",
        },
        {
          german: "kreuzen",
          pronunciation: "[kroy-tsen]",
          vietnamese: "ƒë√°nh d·∫•u X",
          category: "Ho·∫°t ƒë·ªông",
        },

        // C√ÅC T·ª™ B·ªî SUNG
        {
          german: "So",
          pronunciation: "[z√¥]",
          vietnamese: "v·∫≠y / nh∆∞ th·∫ø",
          category: "T·ª´ li√™n k·∫øt",
        },
        {
          german: "aber",
          pronunciation: "[a-be]",
          vietnamese: "nh∆∞ng / th√¨",
          category: "Li√™n t·ª´",
        },
        {
          german: "noch",
          pronunciation: "[n·ªçt]",
          vietnamese: "c√≤n / n·ªØa",
          category: "Tr·∫°ng t·ª´",
        },
        {
          german: "Also",
          pronunciation: "[an-z√¥]",
          vietnamese: "v·∫≠y th√¨",
          category: "T·ª´ li√™n k·∫øt",
        },
        {
          german: "Foto",
          pronunciation: "[f√¥-t√¥]",
          vietnamese: "·∫£nh / h√¨nh",
          category: "ƒê·ªì v·∫≠t",
        },
        {
          german: "Wartet",
          pronunciation: "[va-tet]",
          vietnamese: "ch·ªù ƒë√£",
          category: "ƒê·ªông t·ª´",
        },
      ];

      // ENHANCED MOBILE-FIRST AUDIO SYSTEM
      let currentGameData = {};
      let isMobile =
        /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
          navigator.userAgent
        );
      let audioSupported = false;
      let voicesLoaded = false;
      let userHasInteracted = false;
      let speechSynthesisReady = false;

      // Comprehensive Audio Detection and Initialization
      function initializeAudioSystem() {
        console.log("üîä Initializing Audio System...");
        console.log("üì± Mobile device:", isMobile);

        const statusElement = document.getElementById("audioStatus");
        const mobileGuide = document.getElementById("mobileAudioGuide");

        if (!("speechSynthesis" in window)) {
          statusElement.textContent = "‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ √¢m thanh";
          statusElement.className = "audio-status audio-error";
          console.log("‚ùå Speech Synthesis not supported");
          return false;
        }

        // Show mobile guide for mobile devices
        if (isMobile) {
          mobileGuide.classList.add("show");
        }

        // Function to check and update audio status
        function checkAudioStatus() {
          const voices = speechSynthesis.getVoices();
          console.log("üé§ Available voices:", voices.length);

          if (voices.length === 0) {
            statusElement.textContent = "‚è≥ ƒêang t·∫£i gi·ªçng n√≥i...";
            statusElement.className = "audio-status audio-loading";
            return false;
          }

          const germanVoices = voices.filter(
            (voice) =>
              voice.lang.startsWith("de") ||
              voice.name.toLowerCase().includes("german") ||
              voice.name.toLowerCase().includes("deutsch")
          );

          console.log("üá©üá™ German voices found:", germanVoices.length);
          germanVoices.forEach((voice) => {
            console.log(`  - ${voice.name} (${voice.lang})`);
          });

          if (germanVoices.length > 0) {
            statusElement.textContent = "‚úÖ √Çm thanh s·∫µn s√†ng";
            statusElement.className = "audio-status audio-ready";
            audioSupported = true;
            speechSynthesisReady = true;
          } else {
            statusElement.textContent =
              "‚ö†Ô∏è Kh√¥ng c√≥ gi·ªçng ti·∫øng ƒê·ª©c - s·ª≠ d·ª•ng phi√™n √¢m";
            statusElement.className = "audio-status audio-mobile-warning";
            audioSupported = false;
          }

          voicesLoaded = true;
          return audioSupported;
        }

        // Initial check
        checkAudioStatus();

        // Listen for voices changed event (important for mobile)
        speechSynthesis.addEventListener("voiceschanged", () => {
          console.log("üîÑ Voices changed event fired");
          checkAudioStatus();
        });

        // Force trigger voices loading on some browsers
        setTimeout(() => {
          speechSynthesis.getVoices();
          checkAudioStatus();
        }, 100);

        // Additional checks for mobile
        if (isMobile) {
          setTimeout(() => {
            checkAudioStatus();
          }, 1000);

          setTimeout(() => {
            checkAudioStatus();
          }, 3000);
        }

        return true;
      }

      // Enhanced Speech Function with Mobile Optimization
      function speakGerman(text, fallbackElement = null, buttonElement = null) {
        console.log("üó£Ô∏è Attempting to speak:", text);

        // Always show fallback with pronunciation
        if (fallbackElement) {
          const word = vocabulary.find((w) => w.german === text);
          if (word) {
            fallbackElement.style.display = "block";
            const displayElement = fallbackElement.querySelector(
              ".pronunciation-display"
            );
            if (displayElement) {
              displayElement.textContent = `${word.german} ${word.pronunciation}`;
            }
          }
        }

        // Check if speech synthesis is available
        if (!("speechSynthesis" in window) || !speechSynthesisReady) {
          console.log("‚ö†Ô∏è Speech synthesis not available");
          return;
        }

        // For mobile, require user interaction
        if (isMobile && !userHasInteracted) {
          console.log("üì± User interaction required for mobile");
          return;
        }

        try {
          // Cancel any ongoing speech
          speechSynthesis.cancel();

          // Add visual feedback
          if (buttonElement) {
            buttonElement.classList.add("playing");
          }

          // Small delay to ensure cancellation
          setTimeout(() => {
            const utterance = new SpeechSynthesisUtterance(text);
            const voices = speechSynthesis.getVoices();

            // Find the best German voice
            let selectedVoice = null;
            const germanVoices = voices.filter(
              (voice) =>
                voice.lang.startsWith("de") ||
                voice.name.toLowerCase().includes("german") ||
                voice.name.toLowerCase().includes("deutsch")
            );

            if (germanVoices.length > 0) {
              // Prefer female voices for better pronunciation
              selectedVoice =
                germanVoices.find(
                  (voice) =>
                    voice.name.toLowerCase().includes("female") ||
                    voice.name.toLowerCase().includes("anna") ||
                    voice.name.toLowerCase().includes("petra")
                ) || germanVoices[0];

              utterance.voice = selectedVoice;
              console.log("üéØ Using voice:", selectedVoice.name);
            }

            // Configure utterance for better mobile compatibility
            utterance.lang = "de-DE";
            utterance.rate = 0.75; // Slightly slower for clarity
            utterance.pitch = 1.0;
            utterance.volume = 1.0;

            // Event listeners
            utterance.onstart = () => {
              console.log("‚ñ∂Ô∏è Speech started");
              if (buttonElement) {
                buttonElement.classList.add("playing");
              }
            };

            utterance.onend = () => {
              console.log("‚èπÔ∏è Speech ended");
              if (buttonElement) {
                buttonElement.classList.remove("playing");
              }
            };

            utterance.onerror = (event) => {
              console.log("‚ùå Speech error:", event.error);
              if (buttonElement) {
                buttonElement.classList.remove("playing");
              }
            };

            utterance.onpause = () => {
              console.log("‚è∏Ô∏è Speech paused");
            };

            utterance.onresume = () => {
              console.log("‚ñ∂Ô∏è Speech resumed");
            };

            // Speak with error handling
            try {
              speechSynthesis.speak(utterance);
            } catch (speakError) {
              console.log("‚ùå Error during speak:", speakError);
              if (buttonElement) {
                buttonElement.classList.remove("playing");
              }
            }
          }, 150); // Increased delay for mobile compatibility
        } catch (error) {
          console.log("‚ùå Speech error:", error);
          if (buttonElement) {
            buttonElement.classList.remove("playing");
          }
        }
      }

      // User Interaction Tracking
      function setupUserInteractionTracking() {
        const events = ["click", "touchstart", "touchend", "keydown"];

        function handleUserInteraction() {
          if (!userHasInteracted) {
            userHasInteracted = true;
            console.log("üëÜ User interaction detected - audio enabled");

            // Update status if needed
            if (audioSupported && speechSynthesisReady) {
              const statusElement = document.getElementById("audioStatus");
              statusElement.textContent =
                "‚úÖ √Çm thanh ƒë√£ s·∫µn s√†ng - Nh·∫•n n√∫t nghe";
              statusElement.className = "audio-status audio-ready";
            }
          }
        }

        events.forEach((event) => {
          document.addEventListener(event, handleUserInteraction, {
            once: true,
            passive: true,
          });
        });
      }

      // Back to index button visibility
      const backToIndexBtn = document.getElementById("backToIndex");

      window.addEventListener("scroll", () => {
        if (window.scrollY > 300) {
          backToIndexBtn.classList.add("visible");
        } else {
          backToIndexBtn.classList.remove("visible");
        }
      });

      // Game control functions
      function startGame(gameType) {
        document.getElementById("gameMenu").style.display = "none";
        document
          .querySelectorAll(".game-area")
          .forEach((area) => area.classList.remove("active"));

        switch (gameType) {
          case "flashcards":
            document.getElementById("flashcardsGame").classList.add("active");
            initFlashcards();
            break;
          case "memory":
            document.getElementById("memoryGame").classList.add("active");
            initMemoryGame();
            break;
          case "quiz":
            document.getElementById("quizGame").classList.add("active");
            initQuizGame();
            break;
          case "listening":
            document.getElementById("listeningGame").classList.add("active");
            initListeningGame();
            break;
          case "category":
            document.getElementById("categoryGame").classList.add("active");
            initCategoryGame();
            break;
          case "typing":
            document.getElementById("typingGame").classList.add("active");
            initTypingGame();
            break;
        }
      }

      function backToMenu() {
        // Stop any ongoing speech
        if ("speechSynthesis" in window) {
          speechSynthesis.cancel();
        }

        // Remove playing states
        document.querySelectorAll(".btn-audio").forEach((btn) => {
          btn.classList.remove("playing");
        });

        document
          .querySelectorAll(".game-area")
          .forEach((area) => area.classList.remove("active"));
        document.getElementById("gameMenu").style.display = "grid";
      }

      // Flashcards Game
      function initFlashcards() {
        currentGameData.flashcards = {
          currentIndex: 0,
          cards: vocabulary,
          isFlipped: false,
        };

        document.getElementById("totalCards").textContent =
          currentGameData.flashcards.cards.length;
        showFlashcard();
      }

      function showFlashcard() {
        const data = currentGameData.flashcards;
        const card = data.cards[data.currentIndex];

        document.getElementById("currentCard").textContent =
          data.currentIndex + 1;
        document.getElementById("cardContent").textContent = card.german;
        document.getElementById("cardPronunciation").textContent =
          card.pronunciation;
        document.getElementById("cardTranslation").textContent =
          card.vietnamese;

        // Reset card state
        document.getElementById("flashcard").classList.remove("flipped");
        document.getElementById("cardTranslation").style.display = "none";
        data.isFlipped = false;
      }

      function flipCard() {
        const data = currentGameData.flashcards;
        const flashcard = document.getElementById("flashcard");
        const translation = document.getElementById("cardTranslation");

        if (!data.isFlipped) {
          flashcard.classList.add("flipped");
          translation.style.display = "block";
          data.isFlipped = true;
        }
      }

      function nextCard() {
        const data = currentGameData.flashcards;
        if (data.currentIndex < data.cards.length - 1) {
          data.currentIndex++;
          showFlashcard();
        }
      }

      function prevCard() {
        const data = currentGameData.flashcards;
        if (data.currentIndex > 0) {
          data.currentIndex--;
          showFlashcard();
        }
      }

      // Memory Game
      function initMemoryGame() {
        const importantWords = vocabulary
          .filter(
            (word) =>
              word.category === "Si√™u quan tr·ªçng" ||
              word.category === "Quan tr·ªçng"
          )
          .slice(0, 16);

        const memoryCards = [];

        // Create pairs (German word + Vietnamese meaning)
        importantWords.forEach((word) => {
          memoryCards.push({
            type: "german",
            content: word.german,
            id: word.german,
          });
          memoryCards.push({
            type: "vietnamese",
            content: word.vietnamese,
            id: word.german,
          });
        });

        // Shuffle cards
        for (let i = memoryCards.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [memoryCards[i], memoryCards[j]] = [memoryCards[j], memoryCards[i]];
        }

        currentGameData.memory = {
          cards: memoryCards,
          flippedCards: [],
          matchedPairs: 0,
          moves: 0,
          score: 0,
        };

        renderMemoryGrid();
      }

      function renderMemoryGrid() {
        const grid = document.getElementById("memoryGrid");
        grid.innerHTML = "";

        currentGameData.memory.cards.forEach((card, index) => {
          const cardElement = document.createElement("div");
          cardElement.className = "memory-card";
          cardElement.innerHTML = `<div class="memory-card-content">?</div>`;
          cardElement.onclick = () => flipMemoryCard(index);
          grid.appendChild(cardElement);
        });
      }

      function flipMemoryCard(index) {
        const data = currentGameData.memory;

        if (data.flippedCards.length === 2 || data.flippedCards.includes(index))
          return;

        const cardElement = document.querySelectorAll(".memory-card")[index];
        const card = data.cards[index];

        cardElement.classList.add("flipped");
        cardElement.querySelector(".memory-card-content").textContent =
          card.content;
        data.flippedCards.push(index);

        if (data.flippedCards.length === 2) {
          data.moves++;
          document.getElementById("memoryMoves").textContent = data.moves;

          setTimeout(() => checkMemoryMatch(), 1000);
        }
      }

      function checkMemoryMatch() {
        const data = currentGameData.memory;
        const [first, second] = data.flippedCards;
        const firstCard = data.cards[first];
        const secondCard = data.cards[second];

        if (firstCard.id === secondCard.id) {
          // Match found
          document
            .querySelectorAll(".memory-card")
            [first].classList.add("matched");
          document
            .querySelectorAll(".memory-card")
            [second].classList.add("matched");
          data.matchedPairs++;
          data.score += 10;

          if (data.matchedPairs === 16) {
            setTimeout(
              () => alert("üéâ Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh tr√≤ ch∆°i!"),
              500
            );
          }
        } else {
          // No match
          const firstElement = document.querySelectorAll(".memory-card")[first];
          const secondElement =
            document.querySelectorAll(".memory-card")[second];

          firstElement.classList.remove("flipped");
          secondElement.classList.remove("flipped");
          firstElement.querySelector(".memory-card-content").textContent = "?";
          secondElement.querySelector(".memory-card-content").textContent = "?";
        }

        document.getElementById("memoryScore").textContent = data.score;
        data.flippedCards = [];
      }

      function resetMemory() {
        initMemoryGame();
        document.getElementById("memoryScore").textContent = "0";
        document.getElementById("memoryMoves").textContent = "0";
      }

      // Quiz Game
      function initQuizGame() {
        const quizWords = vocabulary.slice(0, 30);
        const questions = [];

        quizWords.forEach((word) => {
          const wrongAnswers = vocabulary
            .filter((w) => w.vietnamese !== word.vietnamese)
            .sort(() => Math.random() - 0.5)
            .slice(0, 3)
            .map((w) => w.vietnamese);

          const options = [word.vietnamese, ...wrongAnswers].sort(
            () => Math.random() - 0.5
          );

          questions.push({
            question: `T·ª´ "${word.german}" c√≥ nghƒ©a l√† g√¨?`,
            options: options,
            correct: word.vietnamese,
          });
        });

        currentGameData.quiz = {
          questions: questions,
          currentIndex: 0,
          score: 0,
          answered: false,
        };

        document.getElementById("totalQuestions").textContent =
          questions.length;
        showQuizQuestion();
      }

      function showQuizQuestion() {
        const data = currentGameData.quiz;
        const question = data.questions[data.currentIndex];

        document.getElementById("currentQuestion").textContent =
          data.currentIndex + 1;
        document.getElementById("questionText").textContent = question.question;

        const optionsContainer = document.getElementById("quizOptions");
        optionsContainer.innerHTML = "";

        question.options.forEach((option) => {
          const optionElement = document.createElement("div");
          optionElement.className = "quiz-option";
          optionElement.textContent = option;
          optionElement.onclick = () =>
            selectQuizOption(option, question.correct);
          optionsContainer.appendChild(optionElement);
        });

        data.answered = false;
        document.getElementById("nextBtn").style.display = "none";
      }

      function selectQuizOption(selected, correct) {
        if (currentGameData.quiz.answered) return;

        currentGameData.quiz.answered = true;

        document.querySelectorAll(".quiz-option").forEach((option) => {
          if (option.textContent === correct) {
            option.classList.add("correct");
          } else if (option.textContent === selected && selected !== correct) {
            option.classList.add("wrong");
          }
        });

        if (selected === correct) {
          currentGameData.quiz.score++;
        }

        setTimeout(() => {
          document.getElementById("nextBtn").style.display = "inline-block";
        }, 1000);
      }

      function nextQuestion() {
        const data = currentGameData.quiz;

        if (data.currentIndex < data.questions.length - 1) {
          data.currentIndex++;
          showQuizQuestion();
        } else {
          // Show final score
          document.getElementById("quizQuestion").style.display = "none";
          document.getElementById("nextBtn").style.display = "none";
          document.getElementById("quizScore").style.display = "block";
          document.getElementById("finalScore").textContent = data.score;
        }
      }

      // Listening Game - Enhanced for Mobile
      function initListeningGame() {
        const listeningWords = vocabulary.slice(0, 25);

        currentGameData.listening = {
          words: listeningWords,
          currentIndex: 0,
          score: 0,
          answered: false,
        };

        document.getElementById("totalListening").textContent =
          listeningWords.length;
        showListeningQuestion();
      }

      function showListeningQuestion() {
        const data = currentGameData.listening;
        const word = data.words[data.currentIndex];

        document.getElementById("currentListening").textContent =
          data.currentIndex + 1;

        // Create wrong answers
        const wrongAnswers = vocabulary
          .filter((w) => w.vietnamese !== word.vietnamese)
          .sort(() => Math.random() - 0.5)
          .slice(0, 3)
          .map((w) => w.vietnamese);

        const options = [word.vietnamese, ...wrongAnswers].sort(
          () => Math.random() - 0.5
        );

        const optionsContainer = document.getElementById("listeningOptions");
        optionsContainer.innerHTML = "";

        options.forEach((option) => {
          const optionElement = document.createElement("div");
          optionElement.className = "quiz-option";
          optionElement.textContent = option;
          optionElement.onclick = () =>
            selectListeningOption(option, word.vietnamese);
          optionsContainer.appendChild(optionElement);
        });

        data.answered = false;
        document.getElementById("nextListeningBtn").style.display = "none";

        // Always show pronunciation immediately
        const fallbackElement = document.getElementById("audioFallback");
        const wordData = vocabulary.find((w) => w.german === word.german);
        if (wordData && fallbackElement) {
          fallbackElement.style.display = "block";
          const displayElement = fallbackElement.querySelector(
            ".pronunciation-display"
          );
          if (displayElement) {
            displayElement.textContent = `${wordData.german} ${wordData.pronunciation}`;
          }
        }
      }

      function playAudio() {
        userHasInteracted = true; // Ensure interaction is tracked

        const data = currentGameData.listening;
        const word = data.words[data.currentIndex];
        const fallbackElement = document.getElementById("audioFallback");
        const buttonElement = document.getElementById("playBtn");

        speakGerman(word.german, fallbackElement, buttonElement);
      }

      function selectListeningOption(selected, correct) {
        if (currentGameData.listening.answered) return;

        currentGameData.listening.answered = true;

        document
          .querySelectorAll("#listeningOptions .quiz-option")
          .forEach((option) => {
            if (option.textContent === correct) {
              option.classList.add("correct");
            } else if (
              option.textContent === selected &&
              selected !== correct
            ) {
              option.classList.add("wrong");
            }
          });

        if (selected === correct) {
          currentGameData.listening.score++;
        }

        setTimeout(() => {
          document.getElementById("nextListeningBtn").style.display =
            "inline-block";
        }, 1000);
      }

      function nextListening() {
        const data = currentGameData.listening;

        if (data.currentIndex < data.words.length - 1) {
          data.currentIndex++;
          showListeningQuestion();
        } else {
          // Show final score
          document.querySelector(
            "#listeningGame .quiz-question"
          ).style.display = "none";
          document.getElementById("nextListeningBtn").style.display = "none";
          document.getElementById("listeningScore").style.display = "block";
          document.getElementById("finalListeningScore").textContent =
            data.score;
        }
      }

      // Category Game
      function initCategoryGame() {
        const categories = [
          "Si√™u quan tr·ªçng",
          "Quan tr·ªçng",
          "Gia ƒë√¨nh",
          "S·ªë ƒë·∫øm",
          "C·∫£m th√°n",
        ];
        const wordsToUse = vocabulary.filter((word) =>
          categories.includes(word.category)
        );

        currentGameData.category = {
          categories: categories,
          words: wordsToUse.sort(() => Math.random() - 0.5),
          score: 0,
          completed: [],
        };

        document.getElementById("remainingWords").textContent =
          wordsToUse.length;
        renderCategoryGame();
      }

      function renderCategoryGame() {
        const container = document.getElementById("categoryContainer");
        container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    ${currentGameData.category.categories
                      .map(
                        (cat) => `
                        <div class="category-box" data-category="${cat}">
                            <h4>${cat}</h4>
                            <div class="category-content"></div>
                        </div>
                    `
                      )
                      .join("")}
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                    ${currentGameData.category.words
                      .map(
                        (word) => `
                        <div class="draggable-word" draggable="true" data-category="${word.category}">
                            ${word.german}
                        </div>
                    `
                      )
                      .join("")}
                </div>
            `;

        // Add drag and drop functionality
        addDragDropListeners();
      }

      function addDragDropListeners() {
        const draggableWords = document.querySelectorAll(".draggable-word");
        const categoryBoxes = document.querySelectorAll(".category-box");

        draggableWords.forEach((word) => {
          word.addEventListener("dragstart", (e) => {
            e.dataTransfer.setData("text/plain", word.textContent);
            e.dataTransfer.setData("category", word.dataset.category);
          });
        });

        categoryBoxes.forEach((box) => {
          box.addEventListener("dragover", (e) => {
            e.preventDefault();
            box.style.background = "#e3f2fd";
          });

          box.addEventListener("dragleave", () => {
            box.style.background = "#f9f9f9";
          });

          box.addEventListener("drop", (e) => {
            e.preventDefault();
            const word = e.dataTransfer.getData("text/plain");
            const wordCategory = e.dataTransfer.getData("category");
            const boxCategory = box.dataset.category;

            if (wordCategory === boxCategory) {
              // Correct!
              box.querySelector(
                ".category-content"
              ).innerHTML += `<span class="category-word">${word}</span>`;
              const wordElement = Array.from(
                document.querySelectorAll(".draggable-word")
              ).find((el) => el.textContent === word);
              if (wordElement) wordElement.remove();

              currentGameData.category.score += 10;
              document.getElementById("categoryScore").textContent =
                currentGameData.category.score;
              document.getElementById("remainingWords").textContent =
                document.querySelectorAll(".draggable-word").length;

              if (document.querySelectorAll(".draggable-word").length === 0) {
                setTimeout(
                  () =>
                    alert(
                      "üéâ Ch√∫c m·ª´ng! B·∫°n ƒë√£ ph√¢n lo·∫°i ƒë√∫ng t·∫•t c·∫£ t·ª´ v·ª±ng!"
                    ),
                  500
                );
              }
            } else {
              // Wrong!
              box.style.background = "#ffebee";
              setTimeout(() => {
                box.style.background = "#f9f9f9";
              }, 1000);
            }
          });
        });
      }

      function resetCategory() {
        initCategoryGame();
        document.getElementById("categoryScore").textContent = "0";
      }

      // Typing Game - Enhanced for Mobile
      function initTypingGame() {
        const typingWords = vocabulary
          .filter(
            (word) => word.german.length <= 15 && !word.german.includes(" ")
          )
          .slice(0, 20);

        currentGameData.typing = {
          words: typingWords,
          currentIndex: 0,
          score: 0,
          answered: false,
        };

        document.getElementById("totalTyping").textContent = typingWords.length;
        showTypingQuestion();
      }

      function showTypingQuestion() {
        const data = currentGameData.typing;
        const word = data.words[data.currentIndex];

        document.getElementById("currentTyping").textContent =
          data.currentIndex + 1;
        document.getElementById("typingInput").value = "";
        document.getElementById("typingFeedback").innerHTML = "";
        document.getElementById("nextTypingBtn").style.display = "none";

        data.answered = false;

        // Always show pronunciation immediately
        const fallbackElement = document.getElementById("typingAudioFallback");
        const wordData = vocabulary.find((w) => w.german === word.german);
        if (wordData && fallbackElement) {
          fallbackElement.style.display = "block";
          const displayElement = fallbackElement.querySelector(
            ".pronunciation-display"
          );
          if (displayElement) {
            displayElement.textContent = `${wordData.german} ${wordData.pronunciation}`;
          }
        }
      }

      function playTypingAudio() {
        userHasInteracted = true; // Ensure interaction is tracked

        const data = currentGameData.typing;
        const word = data.words[data.currentIndex];
        const fallbackElement = document.getElementById("typingAudioFallback");
        const buttonElement = document.getElementById("playTypingBtn");

        speakGerman(word.german, fallbackElement, buttonElement);
      }

      function checkTyping() {
        if (currentGameData.typing.answered) return;

        const data = currentGameData.typing;
        const word = data.words[data.currentIndex];
        const userInput = document
          .getElementById("typingInput")
          .value.trim()
          .toLowerCase();
        const correctAnswer = word.german.toLowerCase();

        data.answered = true;

        const feedback = document.getElementById("typingFeedback");

        if (userInput === correctAnswer) {
          feedback.innerHTML = `<span style="color: #4CAF50;">‚úÖ ƒê√∫ng r·ªìi! "${word.german}" = ${word.vietnamese}</span>`;
          feedback.style.background = "#e8f5e8";
          data.score++;
        } else {
          feedback.innerHTML = `<span style="color: #f44336;">‚ùå Sai r·ªìi! ƒê√°p √°n ƒë√∫ng: "${word.german}" = ${word.vietnamese}</span>`;
          feedback.style.background = "#ffebee";
        }

        setTimeout(() => {
          document.getElementById("nextTypingBtn").style.display =
            "inline-block";
        }, 2000);
      }

      function nextTyping() {
        const data = currentGameData.typing;

        if (data.currentIndex < data.words.length - 1) {
          data.currentIndex++;
          showTypingQuestion();
        } else {
          // Show final score
          document.querySelector("#typingGame .quiz-question").style.display =
            "none";
          document.getElementById("nextTypingBtn").style.display = "none";
          document.getElementById("typingScore").style.display = "block";
          document.getElementById("finalTypingScore").textContent = data.score;
        }
      }

      // Page Visibility and Mobile Optimization
      function handleVisibilityChange() {
        if (document.visibilityState === "visible") {
          // Re-initialize audio when page becomes visible
          setTimeout(() => {
            initializeAudioSystem();
          }, 500);
        } else {
          // Stop speech when page is hidden
          if ("speechSynthesis" in window) {
            speechSynthesis.cancel();
          }
        }
      }

      // Initialize everything when page loads
      window.addEventListener("load", () => {
        console.log("üöÄ Page loaded - Starting initialization...");

        // Initialize audio system
        initializeAudioSystem();

        // Setup user interaction tracking
        setupUserInteractionTracking();

        // Handle page visibility changes
        document.addEventListener("visibilitychange", handleVisibilityChange);

        // Show back to index button after a delay
        setTimeout(() => {
          backToIndexBtn.classList.add("visible");
        }, 1000);

        // Additional mobile-specific initialization
        if (isMobile) {
          console.log(
            "üì± Mobile device detected - applying mobile optimizations"
          );

          // Prevent zoom on input focus
          const typingInput = document.getElementById("typingInput");
          if (typingInput) {
            typingInput.addEventListener("focus", function () {
              this.style.fontSize = "16px"; // Prevent zoom on iOS
            });
          }

          // Handle orientation changes
          window.addEventListener("orientationchange", () => {
            setTimeout(() => {
              initializeAudioSystem();
            }, 500);
          });
        }
      });

      // Allow Enter key for typing game
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(() => {
          const typingInput = document.getElementById("typingInput");
          if (typingInput) {
            typingInput.addEventListener("keypress", function (e) {
              if (e.key === "Enter") {
                checkTyping();
              }
            });
          }
        }, 100);
      });

      // Global error handling for speech synthesis
      window.addEventListener("error", (e) => {
        if (e.message && e.message.includes("speech")) {
          console.log("üîä Speech synthesis error caught:", e.message);
        }
      });

      // Handle unhandled promise rejections (common with speech synthesis)
      window.addEventListener("unhandledrejection", (e) => {
        if (e.reason && e.reason.toString().includes("speech")) {
          console.log("üîä Speech synthesis promise rejection:", e.reason);
          e.preventDefault(); // Prevent console error
        }
      });
    </script>
  </body>
</html>
