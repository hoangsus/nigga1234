<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>German Audio Transcription</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 40px;
        max-width: 800px;
        width: 100%;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
        font-size: 2.5em;
        background: linear-gradient(45deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .upload-area {
        border: 3px dashed #667eea;
        border-radius: 15px;
        padding: 40px;
        text-align: center;
        margin-bottom: 30px;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .upload-area:hover {
        border-color: #764ba2;
        background: rgba(102, 126, 234, 0.05);
        transform: translateY(-2px);
      }

      .upload-area.dragover {
        border-color: #764ba2;
        background: rgba(102, 126, 234, 0.1);
        transform: scale(1.02);
      }

      .upload-icon {
        font-size: 3em;
        margin-bottom: 15px;
        color: #667eea;
      }

      .upload-text {
        font-size: 1.2em;
        color: #666;
        margin-bottom: 15px;
      }

      .file-input {
        display: none;
      }

      .btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-size: 1em;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 10px;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .controls {
        text-align: center;
        margin: 20px 0;
      }

      .audio-player {
        width: 100%;
        margin: 20px 0;
        border-radius: 10px;
      }

      .status {
        text-align: center;
        margin: 20px 0;
        padding: 15px;
        border-radius: 10px;
        font-weight: bold;
      }

      .status.processing {
        background: linear-gradient(45deg, #ffeaa7, #fdcb6e);
        color: #2d3436;
        animation: pulse 2s infinite;
      }

      .status.success {
        background: linear-gradient(45deg, #00b894, #00cec9);
        color: white;
      }

      .status.error {
        background: linear-gradient(45deg, #e17055, #d63031);
        color: white;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .transcript-area {
        background: rgba(248, 249, 250, 0.8);
        border: 1px solid #e9ecef;
        border-radius: 15px;
        padding: 25px;
        margin-top: 20px;
        min-height: 200px;
        font-family: "Courier New", monospace;
        font-size: 1.1em;
        line-height: 1.6;
        color: #333;
        white-space: pre-wrap;
        box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .transcript-area:empty::before {
        content: "Der Transcript wird hier angezeigt...";
        color: #999;
        font-style: italic;
      }

      .language-select {
        margin: 10px;
        padding: 8px 15px;
        border: 2px solid #667eea;
        border-radius: 10px;
        font-size: 1em;
        background: white;
      }

      .progress-bar {
        width: 100%;
        height: 6px;
        background: #e9ecef;
        border-radius: 3px;
        overflow: hidden;
        margin: 20px 0;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(45deg, #667eea, #764ba2);
        width: 0%;
        transition: width 0.3s ease;
        border-radius: 3px;
      }

      .file-info {
        background: rgba(102, 126, 234, 0.1);
        padding: 15px;
        border-radius: 10px;
        margin: 15px 0;
        color: #333;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üé§ German Audio Transcription</h1>

      <div class="upload-area" id="uploadArea">
        <div class="upload-icon">üéµ</div>
        <div class="upload-text">
          Ziehen Sie eine Audiodatei hierher oder klicken Sie zum Ausw√§hlen
        </div>
        <div style="color: #999; font-size: 0.9em">
          Unterst√ºtzte Formate: MP3, WAV, M4A, OGG
        </div>
        <input type="file" id="fileInput" class="file-input" accept="audio/*" />
      </div>

      <div class="controls">
        <select id="languageSelect" class="language-select">
          <option value="de-DE">Deutsch (Deutschland)</option>
          <option value="de-AT">Deutsch (√ñsterreich)</option>
          <option value="de-CH">Deutsch (Schweiz)</option>
          <option value="en-US">English (US)</option>
          <option value="fr-FR">Fran√ßais</option>
          <option value="es-ES">Espa√±ol</option>
        </select>
        <button id="transcribeBtn" class="btn" disabled>
          Transkription starten
        </button>
        <button id="clearBtn" class="btn">Alles l√∂schen</button>
      </div>

      <audio
        id="audioPlayer"
        class="audio-player"
        controls
        style="display: none"
      ></audio>

      <div class="file-info" id="fileInfo" style="display: none"></div>

      <div class="progress-bar" id="progressBar" style="display: none">
        <div class="progress-fill" id="progressFill"></div>
      </div>

      <div id="status" class="status" style="display: none"></div>

      <div id="transcript" class="transcript-area"></div>
    </div>

    <script>
      let selectedFile = null;
      let recognition = null;

      // DOM Elements
      const uploadArea = document.getElementById("uploadArea");
      const fileInput = document.getElementById("fileInput");
      const audioPlayer = document.getElementById("audioPlayer");
      const transcribeBtn = document.getElementById("transcribeBtn");
      const clearBtn = document.getElementById("clearBtn");
      const languageSelect = document.getElementById("languageSelect");
      const status = document.getElementById("status");
      const transcript = document.getElementById("transcript");
      const fileInfo = document.getElementById("fileInfo");
      const progressBar = document.getElementById("progressBar");
      const progressFill = document.getElementById("progressFill");

      // Check for Speech Recognition support
      if (
        !("webkitSpeechRecognition" in window) &&
        !("SpeechRecognition" in window)
      ) {
        showStatus(
          "Ihr Browser unterst√ºtzt keine Spracherkennung. Bitte verwenden Sie Chrome oder Edge.",
          "error"
        );
      }

      // File upload handlers
      uploadArea.addEventListener("click", () => fileInput.click());
      uploadArea.addEventListener("dragover", handleDragOver);
      uploadArea.addEventListener("dragleave", handleDragLeave);
      uploadArea.addEventListener("drop", handleDrop);
      fileInput.addEventListener("change", handleFileSelect);

      // Button handlers
      transcribeBtn.addEventListener("click", startTranscription);
      clearBtn.addEventListener("click", clearAll);

      function handleDragOver(e) {
        e.preventDefault();
        uploadArea.classList.add("dragover");
      }

      function handleDragLeave(e) {
        e.preventDefault();
        uploadArea.classList.remove("dragover");
      }

      function handleDrop(e) {
        e.preventDefault();
        uploadArea.classList.remove("dragover");
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleFile(files[0]);
        }
      }

      function handleFileSelect(e) {
        const file = e.target.files[0];
        if (file) {
          handleFile(file);
        }
      }

      function handleFile(file) {
        if (!file.type.startsWith("audio/")) {
          showStatus("Bitte w√§hlen Sie eine g√ºltige Audiodatei aus.", "error");
          return;
        }

        selectedFile = file;

        // Show file info
        const fileSize = (file.size / 1024 / 1024).toFixed(2);
        fileInfo.innerHTML = `
                <strong>Datei:</strong> ${file.name}<br>
                <strong>Gr√∂√üe:</strong> ${fileSize} MB<br>
                <strong>Typ:</strong> ${file.type}
            `;
        fileInfo.style.display = "block";

        // Create audio URL and show player
        const audioURL = URL.createObjectURL(file);
        audioPlayer.src = audioURL;
        audioPlayer.style.display = "block";

        transcribeBtn.disabled = false;
        showStatus(
          "Datei erfolgreich geladen. Bereit zur Transkription.",
          "success"
        );
      }

      function startTranscription() {
        if (!selectedFile) return;

        // Initialize speech recognition
        const SpeechRecognition =
          window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();

        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = languageSelect.value;

        let finalTranscript = "";
        let interimTranscript = "";

        recognition.onstart = () => {
          showStatus(
            "Transkription l√§uft... Spielen Sie die Audiodatei ab.",
            "processing"
          );
          progressBar.style.display = "block";
          transcribeBtn.disabled = true;
          startProgressAnimation();
        };

        recognition.onresult = (event) => {
          interimTranscript = "";

          for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript_part = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
              finalTranscript += transcript_part + " ";
            } else {
              interimTranscript += transcript_part;
            }
          }

          transcript.textContent = finalTranscript + interimTranscript;
        };

        recognition.onerror = (event) => {
          showStatus(`Fehler bei der Transkription: ${event.error}`, "error");
          transcribeBtn.disabled = false;
          progressBar.style.display = "none";
        };

        recognition.onend = () => {
          showStatus("Transkription abgeschlossen!", "success");
          transcribeBtn.disabled = false;
          progressBar.style.display = "none";

          if (finalTranscript.trim() === "") {
            transcript.textContent =
              "Keine Sprache erkannt. Bitte stellen Sie sicher, dass die Audiodatei abgespielt wird und deutlich h√∂rbare Sprache enth√§lt.";
          }
        };

        // Start recognition and play audio
        recognition.start();
        audioPlayer.play();

        // Auto-stop recognition when audio ends
        audioPlayer.onended = () => {
          setTimeout(() => {
            if (recognition) {
              recognition.stop();
            }
          }, 1000);
        };
      }

      function startProgressAnimation() {
        let progress = 0;
        const interval = setInterval(() => {
          progress += Math.random() * 2;
          if (progress >= 100) {
            progress = 100;
            clearInterval(interval);
          }
          progressFill.style.width = progress + "%";
        }, 100);

        // Clear interval when recognition ends
        if (recognition) {
          recognition.onend = ((originalOnEnd) => {
            return function () {
              clearInterval(interval);
              progressFill.style.width = "100%";
              if (originalOnEnd) originalOnEnd.apply(this, arguments);
            };
          })(recognition.onend);
        }
      }

      function clearAll() {
        selectedFile = null;
        transcript.textContent = "";
        audioPlayer.style.display = "none";
        fileInfo.style.display = "none";
        progressBar.style.display = "none";
        status.style.display = "none";
        transcribeBtn.disabled = true;
        fileInput.value = "";

        if (recognition) {
          recognition.stop();
          recognition = null;
        }

        if (audioPlayer.src) {
          URL.revokeObjectURL(audioPlayer.src);
          audioPlayer.src = "";
        }
      }

      function showStatus(message, type) {
        status.textContent = message;
        status.className = `status ${type}`;
        status.style.display = "block";
      }

      // Add copy transcript functionality
      transcript.addEventListener("click", () => {
        if (transcript.textContent.trim()) {
          navigator.clipboard.writeText(transcript.textContent).then(() => {
            showStatus(
              "Transcript wurde in die Zwischenablage kopiert!",
              "success"
            );
            setTimeout(() => {
              status.style.display = "none";
            }, 2000);
          });
        }
      });
    </script>
  </body>
</html>
